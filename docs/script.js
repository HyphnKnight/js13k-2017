!function(){"use strict";function e(e,t){let n=-1;for(;++n<e.length;)t(e[n],n,e);return e}function t(e,t,n){let o=-1;for(;++o<e.length;)n=t(n,e[o],o,e);return n}function n(e,t=8){const n=Math.pow(10,t);return Math.round(e*n)/n}function o(e,t){const o=Math.sin(t),i=Math.cos(t);return[n(e[0]*i-e[1]*o),n(e[0]*o+e[1]*i)]}function i(e,t){const o=Math.sin(t),i=Math.cos(t),a=e[0];return e[0]=n(e[0]*i-e[1]*o),e[1]=n(a*o+e[1]*i),e}function a(e,t,n){return e[0]=t,e[1]=n,e}function s(e){const t=[Math.round(e[0]),Math.round(e[1]),Math.round(e[2])],n=[Math.abs(t[0]-e[0]),Math.abs(t[1]-e[1]),Math.abs(t[2]-e[2])];return n[0]>n[1]&&n[0]>n[2]?t[0]=-t[1]-t[2]:n[1]>n[2]?t[1]=-t[0]-t[2]:t[2]=-t[0]-t[1],t}function r(e,t){if(e.length<2)return e;const n=Math.floor(e.length/2);return rn(r(e.slice(0,n),t),r(e.slice(n),t),t)}function*l(e,t){let n=-1;for(;++n<t.length;){const o=bn(t[n]),i=Bn(e,o,500);for(;!i();)a(_t,...q(un,e)),yield}}function*c(e){let t=null;for(st.target=null,T(gn),gn.push(...e);!t;){Vt();const{click:n,mousePosition:o}=Ge;1===n&&(st.target=Mn(o),L(e,st.target)&&(t=st.target)),yield}return T(gn),t}function*h(e){const t=Bn(_t,q(un,e),2e3);for(;!t();)yield}function*d(e,t,n){const o=e(t,n);if(!o.length)return null;const i=yield*c(o);return Hn(i)}function*u([{abilities:{attack:{damage:e,range:t}}},,n]){const o=yield*d(En(Cn),n,t);if(!o)return yield*m(arguments[0]);Jn(o,e),yield*h(o[2])}function*f([{abilities:{defend:{range:e,duration:t,percentage:n}}},,o]){An(o,e).forEach(([,,,e])=>e.push({type:`shield`,duration:t,percentage:n})),yield}function*g([{type:e,abilities:{magic:{effect:t,range:n}}},,o]){const i=yield*d(En(Dn(null)),o,n);if(!i)return yield*m(arguments[0]);const[{type:a},,s,r]=i;r.push({type:e===a?`heal`:`damage`,effect:t}),yield*h(s)}function*p(e){const[{abilities:{attack:t,defend:n,magic:o}}]=e;let i=null;const a=[t.count&&[`Abuse (${t.count})`,()=>{--t.count,i=u}],n.count&&[`Pretend (${n.count})`,()=>{--n.count,i=f}],o.count&&[`Critique (${o.count})`,()=>{--o.count,i=g}]].filter(e=>e),s=jt.push(Qt(a))-1;for(;!i;)yield;jt.splice(s,1),yield*i(e)}function*m([{abilities:{move:{range:e}}},,t]){const n=wn(t),o=yield*c(xn(n,e));yield*h(t),yield*l(t,vn(n,o))}function*y(e,t){const[{abilities:{aiAttack:{damage:n}}}]=e,o=r(t,([,e])=>e)[0];Jn(o,n),yield*h(o[2]),yield}function*w(e,t){const[{abilities:{aiDefend:{duration:n,percentage:o}}}]=e,i=r(t,([,e])=>-e)[0],[,,a,s]=i;yield*h(a),s.push({type:`shield`,duration:n,percentage:o}),yield*h(i[2]),yield}function*M(e,t){const[{type:n,abilities:{aiMagic:{effect:o}}}]=e,i=r(t,([,e])=>-e)[0],[a,,s,l]=i;yield*h(s),l.push({type:n===a.type?`heal`:`damage`,effect:o}),yield*h(i[2]),yield}function*b([{abilities:{aiMove:{range:e,type:t}}},,n]){yield*h(n);const o=r(An(n,100),([,,e])=>t?Cn(e,1).length:An(e,1).length);o[0]&&(yield*l(n,Qn(n,o[0][2],e)))}function*v(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t);o.length?yield*y(e,o):yield*b(e),yield}function*k(e){const[{abilities:{aiMagic:{range:t}}},,n]=e,o=An(n,t);o.length?yield*M(e,o):yield*b(e),yield}function*x(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t),i=Cn(n,t);0===o.length?yield*b(e):i.length>o.length?yield*w(e,i):yield*y(e,o),yield}function*D(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t),i=Cn(n,t);0===o.length?yield*b(e):yield*y(e,[...i,...o]),yield}function*E(e){const[{abilities:{aiAttack:{range:t},aiMagic:{range:n}}},,o]=e,i=An(o,t),a=Cn(o,t),s=[...An(o,n),...Cn(o,n)];i.length>1?yield*y(e,i):a.length>1?yield*w(e,a):s.length?yield*M(e,[...i,...a]):yield*b(e),yield}function*A(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t).filter(([,,,e])=>e.find(({type:e})=>e===`damage`));o.length&&(yield*y(e,o)),yield}function*C(e){let t=0;for(;;){const n=e[t%e.length];++t;const[,o]=n;o>0&&(yield n)}}function H(e,t,n,o){function*i(){const{value:e}=c.next(),[t,,n]=e;st.target=wn(n);const o=Bn(_t,q(Zn,n),2e3);for(;!o();)yield;if(r=null,t.type){let e;switch(t.name){case`Persecutor`:e=[l.move,l.item];break;default:e=Object.keys(t.abilities).map(e=>l[e])}const n=jt.push(Qt(e));for(;!r;)yield;jt.splice(n-1,1)}else r=l[t.name.toLowerCase()];yield*r(e),Nn(e);return 0}const a=oo(e,t,n,o);mn(a);let s=null,r=null;const l={move:[`Move`,()=>r=m],attack:[`Avenge`,()=>r=u],defend:[`Protect`,()=>r=f],magic:[`Forget`,()=>r=g],item:[`Use`,()=>r=p],swarmer:v,vamp:k,skeli:x,resentment:D,doubt:A,deceit:E,*harm(){yield*[A,D,E][++eo%9/3|0]}},c=C(pn);return{init:()=>{_t[2]=340,jt.push(Vn,Pn),s=i(),st.logic=(()=>{const{value:a,done:r}=s.next();if(r&&0===a)s=i();else if(r&&1===a)Ot(Ko);else if(r&&2===a){const i=oo(e,t,n,o);mn(i)}})},dismiss:()=>{}}}const B=(e,n)=>t(e,(e,t,o,i)=>F(e,n(t,o,i)),[]),P=(e,n=(e=>!!e))=>t(e,(e,t,o,i)=>n(t,o,i)?F(e,t):e,[]),L=(e,t)=>-1!==e.indexOf(t),j=e=>e.slice(0),T=e=>{for(;e.length;)e.pop();return e},F=(e,t,n=0)=>{const o=j(e);return o.splice(n,0,t),o},I=e=>e>0?1:e<0?-1:0,O=e=>e*e,S=e=>e&&"number"==typeof e,R=e=>e&&S(e[0])&&S(e[1]),q=(e,t)=>[e[0]+t[0],e[1]+t[1]],z=(e,t)=>(e[0]+=t[0],e[1]+=t[1],e),Y=(e,t)=>[e[0]-t[0],e[1]-t[1]],$=(e,t)=>(e[0]-=t[0],e[1]-=t[1],e),_=(e,t)=>[e[0]*t,e[1]*t],W=(e,t)=>(e[0]*=t,e[1]*=t,e),U=e=>O(e[0])+O(e[1]),X=e=>Math.sqrt(U(e)),G=e=>0===e[0]&&0===e[1]?[0,0]:W(e,1/X(e)),V=(e,t)=>W(G(e),t),J=e=>{const t=[0,0];for(let n=e.length-1;n>=0;--n)z(t,e[n]);return t},K=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]+t[0],n[o+1]=e[o+1]+t[1];return n},N=(e,t)=>{for(let n=0,o=e.length;n<o;n+=2)e[n]+=t[0],e[n+1]+=t[1];return e},Q=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]-t[0],n[o+1]=e[o+1]-t[1];return n},Z=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]*t,n[o+1]=e[o+1]*t;return n},ee=(e,t)=>{const o=[],i=Math.sin(t),a=Math.cos(t);for(let t=0,s=e.length;t<s;t+=2)o[t]=n(e[t]*a-e[t+1]*i),o[t+1]=n(e[t]*i+e[t+1]*a);return o},te=(e,t,n)=>K(ee(Q(e,t),n),t),ne=(e,t)=>{for(let n=0;n<e.length;n+=2)t([e[n],e[n+1]],n/2,e)},oe=(e,t)=>{const n=[];for(let o=0;o<e.length;o+=2)n.push(...t([e[o],e[o+1]],o/2,e));return n},ie=(e,t)=>{for(let n=0;n<e.length;n+=2)e.splice(n,2,...t([e[n],e[n+1]],n/2));return e},ae=(e=(e=>!!e))=>t=>e(t),se=(ae(e=>"Point"===e.shape),ae(e=>"Circle"===e.shape),ae(e=>"Rectangle"===e.shape),ae(e=>"Polygon"===e.shape),(e,t)=>[-e/2,+t/2,-e/2,-t/2,+e/2,-t/2,+e/2,+t/2]),re=(e,t=0,n=1,o=1,i="")=>({shape:"Rectangle",label:i,position:e,rotation:t,width:n,height:o,points:se(n,o)});let le=document.createElement("canvas"),ce=le.getContext("2d");const he=(e,t)=>{le=e;const n=e.getContext("2d",t);n&&(ce=n)},de=[0,0],ue=e=>ce.translate(n(e[0],0),n(e[1],0)),fe=e=>ce.rotate(e),ge=(e,t,o)=>ce.clearRect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),pe=()=>ge(de,le.width,le.height),me=e=>ce.moveTo(n(e[0],0),n(e[1],0)),ye=e=>ce.lineTo(n(e[0],0),n(e[1],0)),we=(e,t)=>ce.quadraticCurveTo(n(t[0],0),n(t[1],0),n(e[0],0),n(e[1],0)),Me=(e,t,o,i,a)=>ce.arc(n(e[0],0),n(e[1],0),t,o,i,a),be=(e,t,o)=>ce.rect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),ve=(e,t=0)=>{const n=[e[0],e[1]],o=Q(e,n);ce.save(),ue(n),fe(t),me(de),ne(o,ye),ce.restore()},ke=(e,t,n=0)=>{const o=[t[t.length-2],t[t.length-1]];ce.save(),ue(e),fe(n),me(o),ne(t,ye),ce.restore()},xe=(e,t,n=0)=>{const o=oe(t,(e,t,n)=>W(z(n[2*t-2]?[n[2*t-2],n[2*t-1]]:[n[n.length-2],n[n.length-1]],e),.5));ce.save(),ue(e),fe(n),me([o[0],o[1]]);let i=0;for(;(i+=2)<=9;)we(o[i]?[o[i],o[i+1]]:[o[0],o[1]],[t[i-2],t[i-1]]);ce.restore()},De=(e,t,o,i=0)=>{ce.save(),ue(e),fe(i),be([-t/2,-o/2],n(t,0),n(o,0)),ce.restore()},Ee=(e,t=100,n=0,o=0,i=2*Math.PI,a=!1)=>{ce.save(),ue(e),fe(n),Me(de,t,o,i,a),ce.restore()},Ae=e=>(t,...n)=>{ce.save(),ce.beginPath(),ce.fillStyle=t,e(...n),ce.fill(),ce.restore()},Ce=e=>(t,...n)=>{ce.save(),ce.beginPath(),ce.strokeStyle=t.style||"",ce.lineWidth=t.thickness||1,e(...n),ce.stroke(),ce.restore()},He=Ae(ke),Be=Ae(xe),Pe=Ae(De),Le=(Ae(ve),Ae(Ee),Ce(ke),Ce(xe)),je=Ce(De),Te=(Ce(ve),Ce(Ee),(e,t,o,i=0)=>{if(ce.save(),ce.fillStyle=e.style||"",ce.font=e.font||ce.font,ce.textAlign=e.textAlign||ce.textAlign,ce.textBaseline=e.textBaseline||ce.textBaseline,fe(i),e.horizontalAlign){const{width:e}=ce.measureText(o);ue([-e/2,0])}ce.fillText(o,n(t[0],0),n(t[1],0),e.maxWidth),ce.restore()}),Fe=document.querySelector(`canvas`);he(Fe,{alpha:!1}),ce.imageSmoothingEnabled=!1;const Ie=160,Oe=192;let Se=Fe.offsetWidth,Re=Fe.offsetHeight,qe=1,ze=1;Fe.width=Ie,Fe.height=Oe;const Ye=()=>{const{top:e,left:t,width:n,height:o}=Fe.getBoundingClientRect();Se=t,Re=e,qe=Ie/n,ze=Oe/o};Ye(),document.addEventListener(`DOMContentLoaded`,Ye),window.addEventListener(`resize`,Ye);`ðŸ‘©ðŸ¼â€ðŸŒ¾`,`ðŸ‘®ðŸ¿â€`,`ðŸ•µðŸ½`,`ðŸ‘¨ðŸ»â€ðŸŽ¤`,`ðŸ‘º`,`ðŸŒ¬ï¸`,`ðŸŽ­`,`ðŸ‰`,`ðŸ¦‚`,`ðŸ¦‡`,`ðŸ‘»`,`â˜ ï¸`,`ðŸŒ²`,`ðŸŒ³`,`â˜ï¸`,`â›°ï¸`,`ðŸŒ·`;const $e=`ðŸ‘‰ðŸ»`,_e=(`ðŸµ`,`ðŸ’Ž`),We=`ðŸ–¤`,Ue=`ðŸ’—`,Xe=(`ðŸŒ±`,{38:`up`,40:`down`,37:`left`,39:`right`,87:`w`,65:`a`,83:`s`,68:`d`,32:`space`,13:`return`}),Ge={up:0,down:0,left:0,right:0,w:0,a:0,s:0,d:0,space:0,return:0,mousePosition:null,click:null},Ve=(e,t=1)=>{const n=Xe[e];return!n||0!==t&&2===Ge[n]||(Ge[n]=t),Ge[n]};document.body.onkeyup=(({keyCode:e})=>Ve(e,0)),document.body.onkeydown=(({keyCode:e})=>Ve(e,1));const Je=()=>{const e=Object.keys(Ge);let t=-1;for(;++t<e.length;)1===Ge[e[t]]?Ge[e[t]]=2:Ge[e[t]]=Ge[e[t]]};document.body.onmousedown=(()=>Ge.click=1),document.body.onmouseup=(()=>Ge.click=0);const Ke=({clientX:e,clientY:t,touches:n})=>n?[n[0].clientX,n[0].clientY]:[e,t];document.body.onmousemove=(e=>{const t=$(Ke(e),[Se,Re]);t[0]*=qe,t[1]*=ze,Ge.mousePosition=t});const Ne=e=>()=>{const t=[0,0];return(Ge.up||Ge.w)&&++t[1],(Ge.down||Ge.s)&&--t[1],(Ge.left||Ge.a)&&--t[0],(Ge.right||Ge.d)&&++t[0],V(t,e)},Qe=`#fff`,Ze=(`#00f`,`Arial Black, Gadget, sans-serif`,`"Lucida Console", Monaco, monospace`,`24px Arial Black, Gadget, sans-serif`,`12px "Lucida Console", Monaco, monospace`),et={font:`6px mono`},tt={style:Qe,font:`10px mono`},nt={style:Qe},ot={style:Qe,thickness:2},it=[0,-1],at=(e,t,n,o=0)=>{Pe("#00f",q(e,it),t,n*(12*1.1)+o),je(ot,q(e,it),t,n*(12*1.1)+o)},st={dialog:[],position:[-545,700],target:null,logic:null,miasma:-550},rt=e=>e&&"number"==typeof e,lt=[0,0];class ct{constructor(){this.apply=(e=>Object.assign(Object.create(null),e,{position:[...this.position],rotation:this.rotation})),this.position=lt,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(this.saved_positions.length>0){const e=this.saved_positions.pop();R(e)&&(this.position[0]=e[0],this.position[1]=e[1]);const t=this.saved_rotations.pop();rt(t)&&(this.rotation=t)}}}const ht=(e,t)=>I((t[2]-t[0])*(e[1]-t[1])-(t[3]-t[1])*(e[0]-t[0])),dt=(e,t,n)=>U(Y(e,t))<=O(n),ut=(e,t,n,o)=>Math.abs(e[0]-t[0])<=n/2&&Math.abs(e[1]-t[1])<=o/2,ft=(e,t)=>{let n=0,o=t.length,i=0,a=0;for(;;){if(i=n===o-2?0:n+2,-1===(a=ht(e,[t[n],t[n+1],t[i],t[i+1]])))return!1;if((n+=2)>o-2)break}return!0},gt=(e,t,n,o,i)=>ut(e,n,o,i)||dt(n,e,t)||O(e[0]-Math.max(n[0],Math.min(e[0],n[0]+o)))+O(e[1]-Math.max(n[1],Math.min(e[1],n[1]+i)))<O(t),pt=(e,t,n,o,i,a)=>!(Math.abs(o[0]-e[0])>t/2+i/2||Math.abs(o[1]-e[1])>n/2+a/2),mt=(e,t,n,o)=>{if(ft(e,o)||ft(n,t))return!0;const i=Math.max(t.length,o.length);for(let e=0;e<i;e+=2)if(e<t.length&&ft([t[e],t[e+1]],o)||e<o.length&&ft([o[e],o[e+1]],t))return!0;return!1},yt=new Map,wt=new Map,Mt=new Map;let bt=re([0,0],0,window.innerWidth,window.innerHeight,"window");window.onresize=(()=>Object.assign(bt,re([0,0],0,window.innerWidth,window.innerHeight,"window")));const vt=((e=bt)=>t=>{const{geometry:n={shape:null}}=t;switch(n.shape){case"Circle":return gt(n.position,n.radius,e.position,e.width,e.height);case"Rectangle":return pt(n.position,n.width,n.height,e.position,e.width,e.height);case"Polygon":return mt(n.position,N(te(n.points,[0,0],n.rotation),n.position),e.position,N(te(e.points,[0,0],e.rotation),e.position));default:return!0}})(bt),kt=t=>n=>{const{geometry:i,children:a,render:s,interact:r}=n;ce.save(),t.save(),i&&(ue(i.position),z(t.position,o(i.position,t.rotation)),fe(i.rotation),t.rotation+=i.rotation),ce.save(),s&&(!i||vt(t.apply(i)))&&s(n),ce.restore(),a&&e(a,kt(t)),r&&(r.onMouseDown?yt.set(n,[n,i&&t.apply(i),r.onMouseDown]):yt.delete(n),r.onMouseMove?wt.set(n,[n,i&&t.apply(i),r.onMouseMove]):wt.delete(n),r.onMouseUp?Mt.set(n,[n,i&&t.apply(i),r.onMouseUp]):Mt.delete(n)),ce.restore(),t.restore()},xt="ontouchstart"in window,Dt=e=>ae(e=>!!e.clientX)(e)?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],Et=e=>t=>{switch(t.shape){case"Circle":return dt(e,t.position,t.radius);case"Rectangle":return ut(e,t.position,t.width,t.height);case"Polygon":return ft(e,N(te(t.points,[0,0],t.rotation),t.position));default:return!1}};let At=0,Ct=0,Ht=1,Bt=1;const Pt=()=>{const{top:e,left:t,width:n,height:o}=le.getBoundingClientRect();At=t,Ct=e,Ht=le.width/n,Bt=le.height/o};Pt(),document.addEventListener("DOMContentLoaded",Pt),window.addEventListener("resize",Pt);const Lt=t=>n=>{if(t.size){const o=$(Dt(n),[At,Ct]);o[0]*=Ht,o[1]*=Bt;const i=Et(o);e(P([...t.values()],([e,t])=>i(t)),([e,t,n])=>n(e,o))}},jt=[],Tt=()=>{for(;jt.length;)jt.pop()},Ft=((e,t)=>(he(e),e.addEventListener(xt?"ontouchstart":"mousedown",Lt(yt)),e.addEventListener(xt?"ontouchmove":"mousemove",Lt(wt)),e.addEventListener(xt?"ontouchend":"mouseup",Lt(Mt)),()=>{yt.clear(),wt.clear(),Mt.clear(),kt(new ct)(t)}))(Fe,{geometry:re([Fe.width/2,Fe.height/2],0,Fe.width,Fe.height),children:jt,render({geometry:e}){e.position[0]=Fe.width/2,e.position[1]=Fe.height/2,e.width=Fe.width,e.height=Fe.height,e.points=se(e.width,e.height)}});let It;const Ot=e=>{Tt(),e.init(),It&&It.dismiss(),It=e};let St=null,Rt=0;const qt=Ie-2,zt=qt-8,Yt=(e,t,n)=>{const o=[];t=t.toUpperCase(),e.textBaseline=`top`,e.font=`12px monospace`;const i=t.split(` `);let a=``,s=0,r=0;for(const[t,l]of i.entries()){const i=`${a+l} `,c=e.measureText(i).width;if(r+i.length>n)return c>zt?(o.push([-zt/2,-29+s,a]),r+=a.length,o.push([-zt/2,-29+s+12*1.1,l.substr(0,n-r)])):o.push([-zt/2,-29+s,i.substr(0,n-r)]),o;c>zt&&t>0?(o.push([-zt/2,-29+s,a]),r+=a.length,a=`${l} `,s+=12*1.1):a=i}return o.push([-zt/2,-29+s,a]),o},$t={geometry:re([0,Oe/2-33],0,qt,66),render:({geometry:e})=>{const[t]=st.dialog;if(!t)return;if(typeof t==`function`)return st.dialog.shift()();St||(St=Date.now()),Rt=(Date.now()-St)/50|0,at([0,0],e.width,0,e.height);const[n,o]=t,i=Yt(ce,n,Rt);let a=0;if(o){const[e,t]=o,{width:n}=ce.measureText(t),i=n+16+8,s=-qt/2+n;at([s,-37],i,1,8),ce.font=`12px monospace`,Te(nt,[s-6+8-i/2,-45.6],e),Te(nt,[s-6+8-i/2+16,-45.6],t),a=12*1.1*.33}i.forEach(([e,t,n])=>{Te(nt,[e,t+a],n)}),1!==Ge.space&&1!==Ge.click||(Rt<n.length?St=1:(st.dialog.shift(),St=null))}},_t=[0,0,240],Wt=e=>{const[t,n]=Y(e,_t),o=_t[2],i=n+500;let a,s=t+n*-t/(n+500)+Ie/2;return i<0?(a=Oe+o*n/i,s=t):i>0?a=Oe-o*n/i:(a=Oe,s=t),[s,a,Math.pow(500+n,2)+Math.pow(-t,2)]},Ut=e=>Wt(e).slice(0,2),Xt=([e,t])=>{const n=500/(-_t[2]/(t-Oe)-1);return z([-(Ie*n+500*Ie+-2*e*n+-2*e*500)/1e3,n],_t)},Gt=Ne(3),Vt=()=>z(_t,Gt()),Jt=[];let Kt=-1,Nt=-1;for(;++Kt<9;){const e=Math.abs(Kt-4),t=9-e;for(;++Nt<t;)((e,t)=>{const n=se(2*t,2*t),o=K(n,e);Jt.push({position:e,radius:t,getBase:()=>oe(o,Ut),getShoreLine:t=>ie(N(Z(n,t),e),Ut),collision:(n,o=1)=>dt(n,e,t*o)})})([100*(Kt-5),1e3+100*(e/2+Nt-5)],75+50*Math.random());Nt=0}const Qt=e=>{let t=Ie/3;const n=12*1.1*e.length+4;let o=Ie/2-t/2-1;const i=Oe/2-n/2;let a=0;const s=[];for(const[o,[i,r]]of e.entries()){const e=i.toUpperCase(),{width:l}=ce.measureText(e);t=Math.max(t,l+8),s.push({geometry:re([-t/2+4,-n/2+12*1.1+o*(12*1.1)-2],0,t,12*1.1),render(){Te(nt,[0,0],e),a===o&&Te({},[-13,0],$e)},interact:{onMouseDown:r,onMouseMove(){a=o}}})}for(const e of s)e.geometry.position[0]=-t/2+4;return o=Ie/2-t/2-1,{geometry:re([o,i],0,t,n),children:s,render(){at([0,0],t,0,n),1===Ge.down&&a<e.length-1?a++:1===Ge.up&&a>0&&a--,1!==Ge.space&&1!==Ge.return||e[a][1]()}}},Zt=[[0,1,-1],[1,0,-1],[1,-1,0],[-1,1,0],[0,-1,1],[-1,0,1]],en=e=>([t,n])=>{const o=(e.length-1)/2,i=n+o,a=t+o+Math.min(0,i-o);return e[i]?e[i][a]:null},tn=e=>[Math.sqrt(3)*(e[0]+e[1]/2),1.5*e[1]],nn=e=>{const[t,n]=e,o=[0,0,0];return o[0]=t*Math.sqrt(3)/3-n/3,o[1]=2*n/3,o[2]=-(o[0]+o[1]),s(o)},on=e=>[e[0],e[1],-e[0]-e[1]],an=(e,t)=>(Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])+Math.abs(e[2]-t[2]))/2,sn=e=>t=>n=>en(e)([t[0]+n[0],t[1]+n[1]]),rn=(e,t,n)=>{const o=[];for(;e.length&&t.length;)(n(e[0])||0)<=(n(t[0])||0)?o.push(e.shift()||e[0]):o.push(t.shift()||t[0]);for(;e.length;)o.push(e.shift()||e[0]);for(;t.length;)o.push(t.shift()||t[0]);return o},ln=(e,t=Date.now()%e)=>()=>Math.min((Date.now()+t)%e/e,1),cn=(e,t)=>{const n=Date.now();let o=0;const i=ln(e,t);return()=>Date.now()-n<e?o=Math.max(o,i()):1},hn=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e;var dn={child:{name:`Child`,emoji:"ðŸ‘©ðŸ¼â€ðŸŒ¾",type:!0,maxHealth:40,abilities:{move:{range:3},magic:{range:4,effect:10,duration:5}}},avenger:{name:`Avenger`,emoji:"ðŸ‘¨ðŸ»â€ðŸŽ¤",type:!0,maxHealth:80,abilities:{move:{range:3},attack:{name:`Avenge`,range:1,damage:25}}},protector:{name:`Protector`,emoji:"ðŸ‘®ðŸ¿â€",type:!0,maxHealth:100,abilities:{move:{range:2},defend:{range:1,duration:1,percentage:1}}},persecutor:{name:`Persecutor`,emoji:"ðŸ•µðŸ½",type:!0,maxHealth:60,abilities:{move:{range:5},attack:{count:10,range:4,damage:30},defend:{count:10,range:3,percentage:.5,duration:3},magic:{count:10,range:1,effect:50,duration:1},reset:{count:3}}},swarmer:{name:`Swarmer`,emoji:"ðŸ¦‚",type:!1,maxHealth:30,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:1,damage:10}}},vamp:{name:`Vamp`,emoji:"ðŸ¦‡",type:!1,maxHealth:40,abilities:{aiMove:{type:!1,range:5},aiMagic:{range:1,duration:1,effect:5}}},skeli:{name:`Skeli`,emoji:"â˜ ï¸",type:!1,maxHealth:40,abilities:{aiMove:{type:!1,range:5},aiAttack:{range:1,damage:20},aiDefend:{range:1,duration:1,percentage:.25}}},resentment:{name:`Resentment`,emoji:"ðŸ‘º",isBoss:!0,type:!1,maxHealth:60,abilities:{aiMove:{type:!1,range:5},aiAttack:{range:1,damage:40}}},doubt:{name:`Doubt`,emoji:"ðŸŒ¬ï¸",isBoss:!0,type:!1,maxHealth:120,abilities:{aiAttack:{range:10,damage:30}}},deceit:{name:`Deceit`,emoji:"ðŸŽ­",isBoss:!0,type:!1,maxHealth:120,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:1,damage:20},aiMagic:{range:3,effect:10,duration:3},aiDefend:{range:2,duration:2,percentage:.25}}},harm:{name:`Harm`,emoji:"ðŸ‰",isBoss:!0,type:!1,maxHealth:120,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:3,damage:20},aiMagic:{range:3,effect:10,duration:3},aiDefend:{range:2,duration:2,percentage:.25}}}};const un=[0,-150],fn=(e=>{let t=2*e+1;const n=[];for(let o=0;o<t;++o){const t=o<=e?e+1+o:3*e+1-o;for(let i=0;i<t;++i)n[o]||(n[o]=[]),n[o][i]=on([-e-Math.min(0,o-e)+i,o-e])}return n})(5),gn=[],pn=[],mn=e=>{T(pn),pn.push(...e.map(([e,t])=>[dn[e],dn[e].maxHealth,W(tn(t),20),[]]))},yn=(e=>t=>en(e)(nn(t)))(fn),wn=e=>yn(_(e,.05)),Mn=e=>wn(Xt(e)),bn=e=>W(tn(e),20),vn=((t,n,o,i=1/0)=>(a,s)=>{let l=[[a,o(s,a)]];const c=new Map,h=new Map;c.set(a,null),h.set(a,0);let d=a;for(;l.length;){const[a]=l.shift(),d=h.get(a);if(a===s)break;if(d>=i)return null;e(t(a),e=>{const t=d+n(a,e),i=h.get(e);if(!i||t<i){h.set(e,t);const n=t+o(s,e);l.push([e,n]),c.set(e,a)}}),l=r(l,([,e])=>e)}const u=[];for(d=s;d!==a;)u.unshift(d),d=c.get(d);return u})((e=>t=>P(B(Zt,sn(e)(t))))(fn),(e,t)=>Hn(t)?40:1,(e,t)=>an(e,t),1e3),kn=(e=>(t,n)=>{const o=[];for(let i=-n;i<=n;++i){const a=Math.min(n,-i+n);for(let s=Math.max(-n,-i-n);s<=a;++s)o.push(en(e)([i+t[0],-i-s+t[1]]))}return P(o)})(fn),xn=(e,t)=>kn(e,t).filter(e=>!pn.find(([,t,n])=>wn(n)===e&&t>0)),Dn=e=>(t,n)=>pn.filter(([o,i,a])=>(null===e||o.type===e)&&i>0&&an(wn(t),wn(a))<=n),En=e=>(t,n)=>e(t,n).map(([,,e])=>wn(e)),An=Dn(!0),Cn=Dn(!1),Hn=e=>pn.find(([,t,n])=>wn(n)===e&&t>0),Bn=(e,t,n)=>{const o=[...e],i=$([...t],o),s=cn(n);return()=>{const t=hn(s());return a(e,...z(_(i,t),o)),1===t}},Pn={geometry:re([0,-Oe/2+12*1.2/2],0,Ie,12*1.2),render(){const e=Hn(st.target);if(!e)return;const[t,n]=e,{maxHealth:o,name:i}=t;let a=Math.ceil(o/10)+1,s=Math.ceil(n/10)+1;for(;--a>=0;)Te(et,[Ie/2-11-8*a,2],We);for(;--s>=0;)Te(et,[Ie/2-11-8*s,2],Ue);Te(tt,[-Ie/2,2],i)}},Ln=(e,t)=>(n,o,i,a=!0)=>{const s=500*Math.random()|0,r=1800+(1e3*Math.random()|0),l=12*n,c=se(2*n,2*n),h=K(c,o);let d;const u={display:a},f=e=>t=>U(Y(t,o))<=e*e;return{propCollision:f(2*n),collision:f(.5*n),test:e=>{u.display&&i&&f(n)(e)&&(i(),i=null)},render:()=>{if(d=oe(h,Ut),!u.display)return;Be(e,[0,0],d);const n=(Date.now()+s)%r/l;Le({style:t,thickness:1},[0,0],oe(N(Z(c,n>1?0:n),o),Ut)),Le({style:t,thickness:2},[0,0],d)},toggle:u}},jn=Ln(`#F9CDAD`,`#FE4365`),Tn=Ln(`#EDE574`,`#F9D423`),Fn=Ln(`#69D2E7`,`#E0E4CC`),In=Ln(`#CFF09E`,`#3B8686`),On=Ln(`#EDEDF2`,`#CFD5E1`),Sn=Ln(`#4F364C`,`#8F9E6F`),Rn=(`#8f9e6f`,se(15,15)),qn=(e,t=1)=>ie(K(1===t?Rn:se(15*t,15*t),W(tn(e),20)),Ut),zn=e=>{e&&(st.target===e?Le({style:"#8f9e6f"},[0,0],qn(e,Math.min(Date.now()%2e3/1e3))):Le({style:"#8f9e6f"},[0,0],qn(e)))},Yn=({name:e,isBoss:t})=>({horizontalAlign:!0,font:`${t?e===`Harm`?30:20:12}px mono`}),$n=(e,t)=>!!e.find(({type:e})=>e===t),_n=(e,t,n,o)=>(i,a)=>$n(a,e)?Te({style:t,font:`6px mono`},[i[0]+o,i[1]+5],n):null,Wn=[_n(`shield`,`#0064fa`,`S`,-5),_n(`heal`,`#32fa00`,`H`,0),_n(`damage`,`#fa3200`,`D`,5)],Un=([e,t,n,o])=>{if(t>0){const t=Ut(n);Te(Yn(e),t,e.emoji),Wn.forEach(e=>e(t,o))}else e.type},Xn=ce.createLinearGradient(0,0,100,100);Xn.addColorStop(0,`#F07241`),Xn.addColorStop(1,`#601848`);const Gn=Sn(200,[0,0]);var Vn={geometry:re([-Ie/2,-Oe/2],0,Ie,Oe),render(){Pe(Xn,[0,0],2*Ie,2*Oe,0),Gn.render(),[...gn,st.target].forEach(zn),r([...pn],([,,[,e]])=>-e).forEach(Un)}};const Jn=(e,t)=>{const[,,,n]=e,o=n.find(({type:e})=>e===`shield`);o&&(t*=1-o.effect),e[1]-=t},Kn=(e,t)=>e[1]=Math.min(e[1]+t,e[0].maxHealth),Nn=e=>{const[,,,t]=e;e[3]=t.map(e=>!(--e.duration<0)&&e).filter(e=>e),t.forEach(t=>{switch(t.type){case`damage`:Jn(e,t.effect);break;case`heal`:Kn(e,t.effect)}})},Qn=(e,t,n)=>{const o=vn(wn(e),wn(t)).splice(0,n);return o.pop(),o},Zn=[0,-150];let eo=0;const to=[[`avenger`,[0,0,0]],[`child`,[1,0,-1]],[`protector`,[-1,1,0]],[`persecutor`,[-1,0,1]]],no=()=>wn(i(W([0,1],60+100*Math.random()),Math.random()*Math.PI)),oo=(e,t,n,o)=>{const i=[...to];let a=-1;const s=Math.max(e,t,n);for(;++a<s;)a<e&&i.push([`swarmer`,no()]),a<t&&i.push([`vamp`,no()]),a<n&&i.push([`skeli`,no()]);return o&&i.push([o,no()]),i},io=(e,t=1)=>([n,o],i=0)=>[n,o,i,e,t],ao=io("ðŸŒ²",2),so=io("ðŸŒ³",2),ro=io("ðŸ‘©ðŸ¼â€ðŸŒ¾"),lo=io("ðŸ‘®ðŸ¿â€"),co=io("ðŸ•µðŸ½"),ho=io("ðŸ‘¨ðŸ»â€ðŸŽ¤"),uo=(io("â˜ï¸"),io("â›°ï¸",4)),fo=io("ðŸŒ·",.5),go=io("ðŸŒ±",.25),po=(io("ðŸ‘»"),io("ðŸµ"),io(_e)),mo=(e,t,n,o,i,a)=>{const s=Math.max(...i.map(e=>e[1][e[1].length-1][0])),r=(e,t)=>{const{width:n,height:o}=ce.measureText(e);return{geometry:re([0,0],0,n,o),render(){Te(t,[0,0],e)}}},l=i.map(e=>{let t=e[0];const{fontOptions:n={},x:o,y:i,rotation:a}=e[1][0][1];return typeof t==`string`&&(t=r(t,n)),t.geometry.position=[o,i],t.geometry.rotation=a,t});let c=!1;const h=Date.now();return{geometry:re([e,t],0,n,o),children:l.map((e,t)=>0!==i[t][1][0][0]?{}:e).reverse(),render({children:e}){const t=Date.now()-h;if(t>s)a&&!c&&(a(),c=!0);else for(const[a,s]of i.entries()){const i=s[1];let c={};for(const[s,[h,d]]of i.entries()){if(t>h){if(0===s&&(e[e.length-1-a]=l[a]),d.remove){e[e.length-1-a]={};break}c={time:h,keyframe:d};continue}if(0===s)break;0===s&&(c={time:h,keyframe:d});let i=(t-c.time)/(h-c.time);i>.995&&(i=1);for(const e in c.keyframe){const t=c.keyframe[e];typeof t==`function`&&(c.keyframe[e]=t(1))}d.symbol?(typeof d.symbol==`string`&&(d.symbol=r(d.symbol,d.fontOptions)),e[e.length-1-a]=d.symbol):e[e.length-1-a]=l[a];const u=d.symbol?Object.assign({},l[a],d.symbol):l[a],{x:f,y:g,rotation:p}=c.keyframe,{x:m,y:y,rotation:w}=d,{geometry:M}=u,{position:b}=M;typeof m==`function`?b[0]=m(i,f,g,p,n,o):void 0!==m&&(b[0]=f+(m-f)*i),typeof y==`function`?b[1]=y(i,f,g,p,n,o):void 0!==y&&(b[1]=g+(y-g)*i),typeof w==`function`?M.rotation=w(i,f,g,p,n,o):void 0!==w&&(M.rotation=p+(w-p)*i);break}}}}},yo=["ðŸ‘¨ðŸ»â€ðŸŽ¤","ðŸ‘®ðŸ¿â€","ðŸ•µðŸ½","ðŸ‘©ðŸ¼â€ðŸŒ¾",_e].map((e,t)=>[e,[[2e3+800*t,{x:Ie/4,y:Oe/2}],[2e3+800*t+2e3,{x:0,y:0}],[2e3+800*t+2800,{x:0,y:0}],[2e3+800*t+3800,{x:0,y:-Oe}]]]),wo=[...yo,[`~ fin  RL, BB`,[[14e3,{fontOptions:{style:`#000`},x:-Ie/2+2,y:Oe/2-4}],[6e3+800*yo.length+4900,{}]]],[{geometry:re([0,0],0,Ie,Oe),render(){Pe(`#fff`,[0,0],Ie,Oe,0)}},[[0,{x:0,y:0,rotation:0}]]]];var Mo={init:()=>{jt.push(mo(0,0,Ie,Oe,wo))},dismiss:()=>{}};let bo=[];const vo=ie(N(se(1e4,1600),[0,800]),Ut),ko=(e=>W(J(e),1/e.length))(Jt.map(({position:e})=>e)),xo=Math.max(...Jt.map(({position:e})=>X(Y(e,ko))))+200,Do=ho([...st.position],0),Eo=lo(z([0,10],st.position),0),Ao=ro(z([-10,0],st.position),0),Co=co(z([10,0],st.position),0),Ho=po(z([0,-10],st.position),0);bo.push(Do,Eo,Ao,Co,Ho);const Bo=e=>{st.miasma+=60*e,bo=bo.filter(([e,,,t])=>"ðŸŒ·"!==t||e>st.miasma)};let Po=!1,Lo=0;const jo=[Do[3],`Avenger`],To=[Co[3],`Persecutor`],Fo=[Eo[3],`Protector`],Io=[Ao[3],`Child`],Oo=[Ho[3],`Origin`],So=[],Ro=[[jn,[[`I hate them, and everything they created.`,jo]]],[In,[[`It couldn't hurt to try, right? Once - only once.`,To]]],[Tn,[[`I have a new coat, with stars!`,Io]]],[Fn,[[`It takes so much effort at times, but we're worth all of it.`,Fo]]],[Sn,[[`You take out groceries, and stack them in the pantry.`,Oo],[`At least three of your things were already in there.`,Oo],()=>{Bo(4),Ot(H(8,0,0,`resentment`))}]],[Tn,[[`I made a lot of new friends.`,Io]]],[Fn,[[`Two years and we're beginning to take a turn.`,Fo]]],[In,[[`Liars can never get close to me.  I'm a liar too.`,To]]],[Sn,[[`Some of your friends only know one of you.`,Oo],()=>{Bo(3),Ot(H(6,6,0,`doubt`))}]],[In,[[`That little piss hung up on me.`,To]]],[Tn,[[`He said he doesn't like me anymore.`,Io]]],[Sn,[[`You went to his house for dinner.`,Oo],[`There were confused.`,Oo],[`You were afraid.`,Oo],()=>{Bo(2),Ot(H(0,8,2,`deceit`))}]],[Tn,[[`I stayed close behind the older kids.`,Io],[`They threw cupcake and candy wrappers right on the sidewalk.`,Io],[`I picked them up.`,Io],[`The one watching wasn't someone I knew.`,Io]]],[Sn,[[`When he kissed you, it wasn't the same.`,Oo],()=>{Bo(100),Ot(H(6,6,3,`harm`))}]],[On,[()=>{bo=[],So.splice(0,So.length-1),Lo=Date.now(),Po=!0}]]];{const e=Ro.length+4;let t=-1;for(;++t<e;){const[e,n]=Ro.shift();So.push(((e,t,n)=>e(25,n,()=>st.dialog.push(...t)))(e,n,[60*t-550,700+300*Math.random()|0])),e===Sn&&++t}}const qo=[[ao,50],[so,50],[uo,10],[fo,500],[go,300]],zo=()=>z(W(i([0,1],2*Math.random()*Math.PI),xo*Math.random()),ko),Yo=e=>dt(e,ko,xo)&&!!Jt.find(({collision:t})=>t(e)),$o=e=>Yo(e)&&!So.find(({propCollision:t})=>t(e)),_o=Math.max(...qo.map(([,e])=>e));let Wo=-1;for(;++Wo<_o;)for(const[e,t]of qo)Wo<t&&bo.push(e((()=>{let e=zo();for(;!$o(e);)e=zo();return e})(),0));`#69D2E7`,`#fff`,`#90b4ec`;Bo(5);const Uo=()=>{Pe("#90b4ec",[0,0],2*Ie,2*Oe,0),He("#69D2E7",[0,0],vo);const e=1.2-Math.abs(Date.now()%7200/3600-1)/10;if(Jt.forEach(({getShoreLine:t})=>Le({style:"#fff",thickness:4},[0,0],t(e))),Jt.forEach(({getShoreLine:t})=>Be(`#fafac8`,[0,0],t(e))),Jt.forEach(({getBase:e})=>Be(`#00c864`,[0,0],e())),Po){const e=Date.now()-Lo;if(e>3e3)return void Ot(Mo);So.push(On(25+e/3e3*175,[350,900]))}for(const e of So)e.render(),e.test(st.position);bo.map(e=>[...Wt(e),e[2],e[3],e[4]]).sort((e,t)=>t[2]-e[2]).forEach(([e,t,n,o,i,a])=>Te({font:`${12*a*(1-2*(n-10994)/8248748)|0}px monospace`},[e,t-o],i))},Xo=()=>Ge.space?6:3,Go=(e,t)=>{const n=Y(st.position,e);X(n)>t&&z(e,V(n,Xo()))},Vo=Ne(1);var Jo=()=>{let e;const t=Xo(),n=Vo();if(U(n)>.5&&(st.target=null),null!==st.target){const n=Y(st.target,st.position);U(n)<3&&(st.target=null),e=V(n,t)}else e=V(n,t);const o=q(st.position,e);Yo(o)&&o[0]<st.miasma&&!st.dialog.length&&a(st.position,...o),a(Do,...st.position),Go(Eo,20+Date.now()%300/30),Go(Ao,45+Date.now()%300/30),Go(Co,70+Date.now()%300/30),Go(Ho,90+Date.now()%300/30);const i=st.position[0]-_t[0];Math.abs(i)>.2*Ie&&(_t[0]+=i-I(i)*Ie*.2),a(_t,...q(st.position,[0,-100]))},Ko={init:()=>{jt.push($t),st.logic=(e=>{Jo(),Uo(),Ge.click&&!st.dialog.length&&(st.target=Xt(Ge.mousePosition))})},dismiss:()=>{}};const No=()=>{Ot(Ko)},Qo={textBaseline:`middle`,style:Qe,font:"24px Arial Black, Gadget, sans-serif",horizontalAlign:!0},Zo={geometry:re([0,0],0,Ie,Oe),render(){1!==Ge.space&&1!==Ge.return||No(),Pe(`#00f`,[0,0],Ie,Oe,0),Te(Qo,[0,0],`A L T E R`),Te(Qo,[0,-24],_e),Te({style:Qe,font:Ze},[-28,51],`new game`),Date.now()%600>400&&He(`white`,[-42,48],[-5,3,5,0,-5,-3])},interact:{onMouseDown:No}};let ei=0,ti=0;const ni=()=>{const e=ce.getImageData(0,0,Ie,Oe),t=e.data;let n=-1;for(;++n<t.length;)t[n]=75*(t[n]/75|0);ce.putImageData(e,0,0)};Ot({init:()=>{jt.push(Zo),st.logic=null},dismiss:()=>{}}),(e=>{let t=!0;requestAnimationFrame(function n(){ei=Math.min(16,Date.now()-ti),t&&e(ei),ti=Date.now(),requestAnimationFrame(n)})})(e=>{pe(),st.logic&&st.logic(),Ft(e),Je(),ni()})}();

!function(){"use strict";function e(e,t){let n=-1;for(;++n<e.length;)t(e[n],n,e);return e}function t(e,t,n){let o=-1;for(;++o<e.length;)n=t(n,e[o],o,e);return n}function n(e,t=8){const n=Math.pow(10,t);return Math.round(e*n)/n}function o(e,t){const o=Math.sin(t),i=Math.cos(t);return[n(e[0]*i-e[1]*o),n(e[0]*o+e[1]*i)]}function i(e,t){const o=Math.sin(t),i=Math.cos(t),a=e[0];return e[0]=n(e[0]*i-e[1]*o),e[1]=n(a*o+e[1]*i),e}function a(e,t,n){return e[0]=t,e[1]=n,e}function s(e){const t=[Math.round(e[0]),Math.round(e[1]),Math.round(e[2])],n=[Math.abs(t[0]-e[0]),Math.abs(t[1]-e[1]),Math.abs(t[2]-e[2])];return n[0]>n[1]&&n[0]>n[2]?t[0]=-t[1]-t[2]:n[1]>n[2]?t[1]=-t[0]-t[2]:t[2]=-t[0]-t[1],t}function r(e,t){if(e.length<2)return e;const n=Math.floor(e.length/2);return rn(r(e.slice(0,n),t),r(e.slice(n),t),t)}function*l(e,t){let n=-1;for(;++n<t.length;){const o=bn(t[n]),i=Pn(e,o,500);for(;!i();)a(Wt,...q(un,e)),yield}}function*c(e){let t=null;for(st.target=null,L(gn),gn.push(...e);!t;){Nt();const{click:n,mousePosition:o}=Ge;1===n&&(st.target=Mn(o),j(e,st.target)&&(t=st.target)),yield}return L(gn),t}function*h(e){const t=Pn(Wt,q(un,e),2e3);for(;!t();)yield}function*d(e,t,n){const o=e(t,n);if(!o.length)return null;const i=yield*c(o);return Hn(i)}function*u([{abilities:{attack:{damage:e,range:t}}},,n]){const o=yield*d(En(Cn),n,t);if(!o)return yield*m(arguments[0]);Vn(o,e),yield*h(o[2])}function*f([{abilities:{defend:{range:e,duration:t,percentage:n}}},,o]){An(o,e).forEach(([,,,e])=>e.push({type:`shield`,duration:t,percentage:n})),yield}function*g([{type:e,abilities:{magic:{effect:t,range:n}}},,o]){const i=yield*d(En(Dn(null)),o,n);if(!i)return yield*m(arguments[0]);const[{type:a},,s,r]=i;r.push({type:e===a?`heal`:`damage`,effect:t}),yield*h(s)}function*p(e){const[{abilities:{attack:t,defend:n,magic:o}}]=e;let i=null;const a=[t.count&&[`Abuse (${t.count})`,()=>{--t.count,i=u}],n.count&&[`Pretend (${n.count})`,()=>{--n.count,i=f}],o.count&&[`Critique (${o.count})`,()=>{--o.count,i=g}]].filter(e=>e),s=It.push(Qt(a))-1;for(;!i;)yield;It.splice(s,1),yield*i(e)}function*m([{abilities:{move:{range:e}}},,t]){const n=wn(t),o=yield*c(xn(n,e));yield*h(t),yield*l(t,vn(n,o))}function*y(e,t){const[{abilities:{aiAttack:{damage:n}}}]=e,o=r(t,([,e])=>e)[0];Vn(o,n),yield*h(o[2]),yield}function*w(e,t){const[{abilities:{aiDefend:{duration:n,percentage:o}}}]=e,i=r(t,([,e])=>-e)[0],[,,a,s]=i;yield*h(a),s.push({type:`shield`,duration:n,percentage:o}),yield*h(i[2]),yield}function*M(e,t){const[{type:n,abilities:{aiMagic:{effect:o}}}]=e,i=r(t,([,e])=>-e)[0],[a,,s,l]=i;yield*h(s),l.push({type:n===a.type?`heal`:`damage`,effect:o}),yield*h(i[2]),yield}function*b([{abilities:{aiMove:{range:e,type:t}}},,n]){yield*h(n);const o=r(An(n,100),([,,e])=>t?Cn(e,1).length:An(e,1).length);o[0]&&(yield*l(n,Qn(n,o[0][2],e)))}function*v(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t);o.length?yield*y(e,o):yield*b(e),yield}function*k(e){const[{abilities:{aiMagic:{range:t}}},,n]=e,o=An(n,t);o.length?yield*M(e,o):yield*b(e),yield}function*x(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t),i=Cn(n,t);0===o.length?yield*b(e):i.length>o.length?yield*w(e,i):yield*y(e,o),yield}function*D(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t);0===o.length?yield*b(e):yield*y(e,o),yield}function*E(e){const[{abilities:{aiAttack:{range:t},aiMagic:{range:n}}},,o]=e,i=An(o,t),a=Cn(o,t),s=[...An(o,n),...Cn(o,n)];i.length>1?yield*y(e,i):a.length>1?yield*w(e,a):s.length?yield*M(e,[...i,...a]):yield*b(e),yield}function*A(e){const[{abilities:{aiAttack:{range:t}}},,n]=e,o=An(n,t).filter(([,,,e])=>e.find(({type:e})=>e===`damage`));o.length&&(yield*y(e,o)),yield}function*C(e){let t=0;for(;;){const n=e[t%e.length];++t;const[,o]=n;o>0&&(yield n)}}function H(e,t,n,o){function*i(){const{value:e}=c.next(),[t,,n]=e;st.target=wn(n);const o=Pn(Wt,q(Zn,n),2e3);for(;!o();)yield;if(r=null,t.type){let e;switch(t.name){case`Persecutor`:e=[l.move,l.item];break;default:e=Object.keys(t.abilities).map(e=>l[e])}const n=It.push(Qt(e));for(;!r;)yield;It.splice(n-1,1)}else r=l[t.name.toLowerCase()];yield*r(e),Kn(e);pn.find(([e,t])=>e.type&&t>0);return 1}const a=oo(e,t,n,o);mn(a);let s=null,r=null;const l={move:[`Move`,()=>r=m],attack:[`Avenge`,()=>r=u],defend:[`Protect`,()=>r=f],magic:[`Forget`,()=>r=g],item:[`Use`,()=>r=p],swarmer:v,vamp:k,skeli:x,resentment:D,doubt:A,deceit:E,*harm(){yield*[A,D,E][++eo%9/3|0]}},c=C(pn);return{init:()=>{Wt[2]=340,It.push(Nn,Bn),s=i(),st.logic=(()=>{const{value:a,done:r}=s.next();r&&0===a?s=i():r&&1===a?Ot(Jo):r&&2===a&&Ot(H(e,t,n,o))})},dismiss:()=>{}}}const P=(e,n)=>t(e,(e,t,o,i)=>S(e,n(t,o,i)),[]),B=(e,n=(e=>!!e))=>t(e,(e,t,o,i)=>n(t,o,i)?S(e,t):e,[]),j=(e,t)=>-1!==e.indexOf(t),I=e=>e.slice(0),L=e=>{for(;e.length;)e.pop();return e},S=(e,t,n=0)=>{const o=I(e);return o.splice(n,0,t),o},F=e=>e>0?1:e<0?-1:0,O=e=>e*e,T=e=>e&&"number"==typeof e,R=e=>e&&T(e[0])&&T(e[1]),q=(e,t)=>[e[0]+t[0],e[1]+t[1]],z=(e,t)=>(e[0]+=t[0],e[1]+=t[1],e),$=(e,t)=>[e[0]-t[0],e[1]-t[1]],_=(e,t)=>(e[0]-=t[0],e[1]-=t[1],e),W=(e,t)=>[e[0]*t,e[1]*t],U=(e,t)=>(e[0]*=t,e[1]*=t,e),X=e=>O(e[0])+O(e[1]),Y=e=>Math.sqrt(X(e)),G=e=>0===e[0]&&0===e[1]?[0,0]:U(e,1/Y(e)),N=(e,t)=>U(G(e),t),V=e=>{const t=[0,0];for(let n=e.length-1;n>=0;--n)z(t,e[n]);return t},J=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]+t[0],n[o+1]=e[o+1]+t[1];return n},K=(e,t)=>{for(let n=0,o=e.length;n<o;n+=2)e[n]+=t[0],e[n+1]+=t[1];return e},Q=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]-t[0],n[o+1]=e[o+1]-t[1];return n},Z=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]*t,n[o+1]=e[o+1]*t;return n},ee=(e,t)=>{const o=[],i=Math.sin(t),a=Math.cos(t);for(let t=0,s=e.length;t<s;t+=2)o[t]=n(e[t]*a-e[t+1]*i),o[t+1]=n(e[t]*i+e[t+1]*a);return o},te=(e,t,n)=>J(ee(Q(e,t),n),t),ne=(e,t)=>{for(let n=0;n<e.length;n+=2)t([e[n],e[n+1]],n/2,e)},oe=(e,t)=>{const n=[];for(let o=0;o<e.length;o+=2)n.push(...t([e[o],e[o+1]],o/2,e));return n},ie=(e,t)=>{for(let n=0;n<e.length;n+=2)e.splice(n,2,...t([e[n],e[n+1]],n/2));return e},ae=(e=(e=>!!e))=>t=>e(t),se=(ae(e=>"Point"===e.shape),ae(e=>"Circle"===e.shape),ae(e=>"Rectangle"===e.shape),ae(e=>"Polygon"===e.shape),(e,t)=>[-e/2,+t/2,-e/2,-t/2,+e/2,-t/2,+e/2,+t/2]),re=(e,t=0,n=1,o=1,i="")=>({shape:"Rectangle",label:i,position:e,rotation:t,width:n,height:o,points:se(n,o)});let le=document.createElement("canvas"),ce=le.getContext("2d");const he=(e,t)=>{le=e;const n=e.getContext("2d",t);n&&(ce=n)},de=[0,0],ue=e=>ce.translate(n(e[0],0),n(e[1],0)),fe=e=>ce.rotate(e),ge=(e,t,o)=>ce.clearRect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),pe=()=>ge(de,le.width,le.height),me=e=>ce.moveTo(n(e[0],0),n(e[1],0)),ye=e=>ce.lineTo(n(e[0],0),n(e[1],0)),we=(e,t)=>ce.quadraticCurveTo(n(t[0],0),n(t[1],0),n(e[0],0),n(e[1],0)),Me=(e,t,o,i,a)=>ce.arc(n(e[0],0),n(e[1],0),t,o,i,a),be=(e,t,o)=>ce.rect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),ve=(e,t=0)=>{const n=[e[0],e[1]],o=Q(e,n);ce.save(),ue(n),fe(t),me(de),ne(o,ye),ce.restore()},ke=(e,t,n=0)=>{const o=[t[t.length-2],t[t.length-1]];ce.save(),ue(e),fe(n),me(o),ne(t,ye),ce.restore()},xe=(e,t,n=0)=>{const o=oe(t,(e,t,n)=>U(z(n[2*t-2]?[n[2*t-2],n[2*t-1]]:[n[n.length-2],n[n.length-1]],e),.5));ce.save(),ue(e),fe(n),me([o[0],o[1]]);let i=0;for(;(i+=2)<=9;)we(o[i]?[o[i],o[i+1]]:[o[0],o[1]],[t[i-2],t[i-1]]);ce.restore()},De=(e,t,o,i=0)=>{ce.save(),ue(e),fe(i),be([-t/2,-o/2],n(t,0),n(o,0)),ce.restore()},Ee=(e,t=100,n=0,o=0,i=2*Math.PI,a=!1)=>{ce.save(),ue(e),fe(n),Me(de,t,o,i,a),ce.restore()},Ae=e=>(t,...n)=>{ce.save(),ce.beginPath(),ce.fillStyle=t,e(...n),ce.fill(),ce.restore()},Ce=e=>(t,...n)=>{ce.save(),ce.beginPath(),ce.strokeStyle=t.style||"",ce.lineWidth=t.thickness||1,e(...n),ce.stroke(),ce.restore()},He=Ae(ke),Pe=Ae(xe),Be=Ae(De),je=(Ae(ve),Ae(Ee),Ce(ke),Ce(xe)),Ie=Ce(De),Le=(Ce(ve),Ce(Ee),(e,t,o,i=0)=>{if(ce.save(),ce.fillStyle=e.style||"",ce.font=e.font||ce.font,ce.textAlign=e.textAlign||ce.textAlign,ce.textBaseline=e.textBaseline||ce.textBaseline,fe(i),e.horizontalAlign){const{width:e}=ce.measureText(o);ue([-e/2,0])}ce.fillText(o,n(t[0],0),n(t[1],0),e.maxWidth),ce.restore()}),Se=document.querySelector(`canvas`);he(Se,{alpha:!1}),ce.imageSmoothingEnabled=!1;const Fe=160,Oe=192;let Te=Se.offsetWidth,Re=Se.offsetHeight,qe=1,ze=1;Se.width=Fe,Se.height=Oe;const $e=()=>{const{top:e,left:t,width:n,height:o}=Se.getBoundingClientRect();Te=t,Re=e,qe=Fe/n,ze=Oe/o};$e(),document.addEventListener(`DOMContentLoaded`,$e),window.addEventListener(`resize`,$e);`👩🏼‍🌾`,`👮🏿‍`,`🕵🏽`,`👨🏻‍🎤`,`👺`,`🌬️`,`🎭`,`🐉`,`🦂`,`🦇`,`👻`,`☠️`,`🌲`,`🌳`,`☁️`,`⛰️`,`🌷`;const _e=`👉🏻`,We=(`🍵`,`💎`),Ue=`🖤`,Xe=`💗`,Ye=(`🌱`,{38:`up`,40:`down`,37:`left`,39:`right`,87:`w`,65:`a`,83:`s`,68:`d`,32:`space`,13:`return`}),Ge={up:0,down:0,left:0,right:0,w:0,a:0,s:0,d:0,space:0,return:0,mousePosition:null,click:null},Ne=(e,t=1)=>{const n=Ye[e];return!n||0!==t&&2===Ge[n]||(Ge[n]=t),Ge[n]};document.body.onkeyup=(({keyCode:e})=>Ne(e,0)),document.body.onkeydown=(({keyCode:e})=>Ne(e,1));const Ve=()=>{const e=Object.keys(Ge);let t=-1;for(;++t<e.length;)1===Ge[e[t]]?Ge[e[t]]=2:Ge[e[t]]=Ge[e[t]]};document.body.onmousedown=(()=>Ge.click=1),document.body.onmouseup=(()=>Ge.click=0);const Je=({clientX:e,clientY:t,touches:n})=>n?[n[0].clientX,n[0].clientY]:[e,t];document.body.onmousemove=(e=>{const t=_(Je(e),[Te,Re]);t[0]*=qe,t[1]*=ze,Ge.mousePosition=t});const Ke=e=>()=>{const t=[0,0];return(Ge.up||Ge.w)&&++t[1],(Ge.down||Ge.s)&&--t[1],(Ge.left||Ge.a)&&--t[0],(Ge.right||Ge.d)&&++t[0],N(t,e)},Qe=`#fff`,Ze=(`#00f`,`Arial Black, Gadget, sans-serif`,`"Lucida Console", Monaco, monospace`,`24px Arial Black, Gadget, sans-serif`,`12px "Lucida Console", Monaco, monospace`),et={font:`6px mono`},tt={style:Qe,font:`10px mono`},nt={style:Qe},ot={style:Qe,thickness:2},it=[0,-1],at=(e,t,n,o=0)=>{Be("#00f",q(e,it),t,n*(12*1.1)+o),Ie(ot,q(e,it),t,n*(12*1.1)+o)},st={dialog:[],position:[-545,700],target:null,logic:null,miasma:-550},rt=e=>e&&"number"==typeof e,lt=[0,0];class ct{constructor(){this.apply=(e=>Object.assign(Object.create(null),e,{position:[...this.position],rotation:this.rotation})),this.position=lt,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(this.saved_positions.length>0){const e=this.saved_positions.pop();R(e)&&(this.position[0]=e[0],this.position[1]=e[1]);const t=this.saved_rotations.pop();rt(t)&&(this.rotation=t)}}}const ht=(e,t)=>F((t[2]-t[0])*(e[1]-t[1])-(t[3]-t[1])*(e[0]-t[0])),dt=(e,t,n)=>X($(e,t))<=O(n),ut=(e,t,n,o)=>Math.abs(e[0]-t[0])<=n/2&&Math.abs(e[1]-t[1])<=o/2,ft=(e,t)=>{let n=0,o=t.length,i=0,a=0;for(;;){if(i=n===o-2?0:n+2,-1===(a=ht(e,[t[n],t[n+1],t[i],t[i+1]])))return!1;if((n+=2)>o-2)break}return!0},gt=(e,t,n,o,i)=>ut(e,n,o,i)||dt(n,e,t)||O(e[0]-Math.max(n[0],Math.min(e[0],n[0]+o)))+O(e[1]-Math.max(n[1],Math.min(e[1],n[1]+i)))<O(t),pt=(e,t,n,o,i,a)=>!(Math.abs(o[0]-e[0])>t/2+i/2||Math.abs(o[1]-e[1])>n/2+a/2),mt=(e,t,n,o)=>{if(ft(e,o)||ft(n,t))return!0;const i=Math.max(t.length,o.length);for(let e=0;e<i;e+=2)if(e<t.length&&ft([t[e],t[e+1]],o)||e<o.length&&ft([o[e],o[e+1]],t))return!0;return!1},yt=new Map,wt=new Map,Mt=new Map;let bt=re([0,0],0,window.innerWidth,window.innerHeight,"window");window.onresize=(()=>Object.assign(bt,re([0,0],0,window.innerWidth,window.innerHeight,"window")));const vt=((e=bt)=>t=>{const{geometry:n={shape:null}}=t;switch(n.shape){case"Circle":return gt(n.position,n.radius,e.position,e.width,e.height);case"Rectangle":return pt(n.position,n.width,n.height,e.position,e.width,e.height);case"Polygon":return mt(n.position,K(te(n.points,[0,0],n.rotation),n.position),e.position,K(te(e.points,[0,0],e.rotation),e.position));default:return!0}})(bt),kt=t=>n=>{const{geometry:i,children:a,render:s,interact:r}=n;ce.save(),t.save(),i&&(ue(i.position),z(t.position,o(i.position,t.rotation)),fe(i.rotation),t.rotation+=i.rotation),ce.save(),s&&(!i||vt(t.apply(i)))&&s(n),ce.restore(),a&&e(a,kt(t)),r&&(r.onMouseDown?yt.set(n,[n,i&&t.apply(i),r.onMouseDown]):yt.delete(n),r.onMouseMove?wt.set(n,[n,i&&t.apply(i),r.onMouseMove]):wt.delete(n),r.onMouseUp?Mt.set(n,[n,i&&t.apply(i),r.onMouseUp]):Mt.delete(n)),ce.restore(),t.restore()},xt="ontouchstart"in window,Dt=e=>ae(e=>!!e.clientX)(e)?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],Et=e=>t=>{switch(t.shape){case"Circle":return dt(e,t.position,t.radius);case"Rectangle":return ut(e,t.position,t.width,t.height);case"Polygon":return ft(e,K(te(t.points,[0,0],t.rotation),t.position));default:return!1}};let At=0,Ct=0,Ht=1,Pt=1;const Bt=()=>{const{top:e,left:t,width:n,height:o}=le.getBoundingClientRect();At=t,Ct=e,Ht=le.width/n,Pt=le.height/o};Bt(),window.addEventListener("resize",Bt);const jt=t=>n=>{if(t.size){const o=_(Dt(n),[At,Ct]);o[0]*=Ht,o[1]*=Pt;const i=Et(o);e(B([...t.values()],([e,t])=>i(t)),([e,t,n])=>n(e,o))}},It=[],Lt=()=>{for(;It.length;)It.pop()},St=((e,t)=>(he(e),e.addEventListener(xt?"ontouchstart":"mousedown",jt(yt)),e.addEventListener(xt?"ontouchmove":"mousemove",jt(wt)),e.addEventListener(xt?"ontouchend":"mouseup",jt(Mt)),()=>{yt.clear(),wt.clear(),Mt.clear(),kt(new ct)(t)}))(Se,{geometry:re([Se.width/2,Se.height/2],0,Se.width,Se.height),children:It,render({geometry:e}){e.position[0]=Se.width/2,e.position[1]=Se.height/2,e.width=Se.width,e.height=Se.height,e.points=se(e.width,e.height)}});let Ft;const Ot=e=>{Lt(),e.init(),Ft&&Ft.dismiss(),Ft=e};let Tt=null,Rt=0;const qt=Fe-2,zt=qt-8,$t=(e,t,n)=>{const o=[];t=t.toUpperCase(),e.textBaseline=`top`,e.font=`12px monospace`;const i=t.split(` `);let a=``,s=0,r=0;for(const[t,l]of i.entries()){const i=`${a+l} `,c=e.measureText(i).width;if(r+i.length>n)return c>zt?(o.push([-zt/2,-29+s,a]),r+=a.length,o.push([-zt/2,-29+s+12*1.1,l.substr(0,n-r)])):o.push([-zt/2,-29+s,i.substr(0,n-r)]),o;c>zt&&t>0?(o.push([-zt/2,-29+s,a]),r+=a.length,a=`${l} `,s+=12*1.1):a=i}return o.push([-zt/2,-29+s,a]),o},_t={geometry:re([0,Oe/2-33],0,qt,66),render:({geometry:e})=>{const[t]=st.dialog;if(!t)return;if(typeof t==`function`)return st.dialog.shift()();Tt||(Tt=Date.now()),Rt=(Date.now()-Tt)/50|0,at([0,0],e.width,0,e.height);const[n,o]=t,i=$t(ce,n,Rt);let a=0;if(o){const[e,t]=o,{width:n}=ce.measureText(t),i=n+16+8,s=-qt/2+n;at([s,-37],i,1,8),ce.font=`12px monospace`,Le(nt,[s-6+8-i/2,-45.6],e),Le(nt,[s-6+8-i/2+16,-45.6],t),a=12*1.1*.33}i.forEach(([e,t,n])=>{Le(nt,[e,t+a],n)}),1!==Ge.space&&1!==Ge.click||(Rt<n.length?Tt=1:(st.dialog.shift(),Tt=null))}},Wt=[0,0,240],Ut=e=>{const[t,n]=$(e,Wt),o=Wt[2],i=n+500;let a,s=t+n*-t/(n+500)+Fe/2;return i<0?(a=Oe+o*n/i,s=t):i>0?a=Oe-o*n/i:(a=Oe,s=t),[s,a,Math.pow(500+n,2)+Math.pow(-t,2)]},Xt=e=>Ut(e).slice(0,2),Yt=([e,t])=>{const n=500/(-Wt[2]/(t-Oe)-1);return z([-(Fe*n+500*Fe+-2*e*n+-2*e*500)/1e3,n],Wt)},Gt=Ke(3),Nt=()=>z(Wt,Gt()),Vt=[];let Jt=-1,Kt=-1;for(;++Jt<9;){const e=Math.abs(Jt-4),t=9-e;for(;++Kt<t;)((e,t)=>{const n=se(2*t,2*t),o=J(n,e);Vt.push({position:e,radius:t,getBase:()=>oe(o,Xt),getShoreLine:t=>ie(K(Z(n,t),e),Xt),collision:(n,o=1)=>dt(n,e,t*o)})})([100*(Jt-5),1e3+100*(e/2+Kt-5)],75+50*Math.random());Kt=0}const Qt=e=>{let t=Fe/3;const n=12*1.1*e.length+4;let o=Fe/2-t/2-1;const i=Oe/2-n/2;let a=0;const s=[];for(const[o,[i,r]]of e.entries()){const e=i.toUpperCase(),{width:l}=ce.measureText(e);t=Math.max(t,l+8),s.push({geometry:re([-t/2+4,-n/2+12*1.1+o*(12*1.1)-2],0,t,12*1.1),render(){Le(nt,[0,0],e),a===o&&Le({},[-13,0],_e)},interact:{onMouseDown:r,onMouseMove(){a=o}}})}for(const e of s)e.geometry.position[0]=-t/2+4;return o=Fe/2-t/2-1,{geometry:re([o,i],0,t,n),children:s,render(){at([0,0],t,0,n),1===Ge.down&&a<e.length-1?a++:1===Ge.up&&a>0&&a--,1!==Ge.space&&1!==Ge.return||e[a][1]()}}},Zt=[[0,1,-1],[1,0,-1],[1,-1,0],[-1,1,0],[0,-1,1],[-1,0,1]],en=e=>([t,n])=>{const o=(e.length-1)/2,i=n+o,a=t+o+Math.min(0,i-o);return e[i]?e[i][a]:null},tn=e=>[Math.sqrt(3)*(e[0]+e[1]/2),1.5*e[1]],nn=e=>{const[t,n]=e,o=[0,0,0];return o[0]=t*Math.sqrt(3)/3-n/3,o[1]=2*n/3,o[2]=-(o[0]+o[1]),s(o)},on=e=>[e[0],e[1],-e[0]-e[1]],an=(e,t)=>(Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])+Math.abs(e[2]-t[2]))/2,sn=e=>t=>n=>en(e)([t[0]+n[0],t[1]+n[1]]),rn=(e,t,n)=>{const o=[];for(;e.length&&t.length;)(n(e[0])||0)<=(n(t[0])||0)?o.push(e.shift()||e[0]):o.push(t.shift()||t[0]);for(;e.length;)o.push(e.shift()||e[0]);for(;t.length;)o.push(t.shift()||t[0]);return o},ln=(e,t=Date.now()%e)=>()=>Math.min((Date.now()+t)%e/e,1),cn=(e,t)=>{const n=Date.now();let o=0;const i=ln(e,t);return()=>Date.now()-n<e?o=Math.max(o,i()):1},hn=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e;var dn={child:{name:`Child`,emoji:"👩🏼‍🌾",type:!0,maxHealth:40,abilities:{move:{range:3},magic:{range:4,effect:20,duration:3}}},avenger:{name:`Avenger`,emoji:"👨🏻‍🎤",type:!0,maxHealth:80,abilities:{move:{range:3},attack:{name:`Avenge`,range:1,damage:25}}},protector:{name:`Protector`,emoji:"👮🏿‍",type:!0,maxHealth:100,abilities:{move:{range:2},defend:{range:1,duration:1,percentage:.8}}},persecutor:{name:`Persecutor`,emoji:"🕵🏽",type:!0,maxHealth:60,abilities:{move:{range:5},attack:{count:10,range:4,damage:30},defend:{count:10,range:3,percentage:.5,duration:3},magic:{count:10,range:1,effect:50,duration:1},reset:{count:3}}},swarmer:{name:`Swarmer`,emoji:"🦂",type:!1,maxHealth:20,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:1,damage:5}}},vamp:{name:`Vamp`,emoji:"🦇",type:!1,maxHealth:20,abilities:{aiMove:{type:!1,range:5},aiMagic:{range:1,duration:1,effect:5}}},skeli:{name:`Skeli`,emoji:"☠️",type:!1,maxHealth:30,abilities:{aiMove:{type:!1,range:5},aiAttack:{range:1,damage:10},aiDefend:{range:1,duration:1,percentage:.25}}},resentment:{name:`Resentment`,emoji:"👺",isBoss:!0,type:!1,maxHealth:60,abilities:{aiMove:{type:!1,range:5},aiAttack:{range:1,damage:40}}},doubt:{name:`Doubt`,emoji:"🌬️",isBoss:!0,type:!1,maxHealth:60,abilities:{aiAttack:{range:10,damage:10}}},deceit:{name:`Deceit`,emoji:"🎭",isBoss:!0,type:!1,maxHealth:60,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:1,damage:10},aiMagic:{range:3,effect:10,duration:3},aiDefend:{range:2,duration:2,percentage:.25}}},harm:{name:`Harm`,emoji:"🐉",isBoss:!0,type:!1,maxHealth:60,abilities:{aiMove:{type:!0,range:3},aiAttack:{range:3,damage:10},aiMagic:{range:3,effect:10,duration:3},aiDefend:{range:2,duration:2,percentage:.25}}}};const un=[0,-150],fn=(e=>{let t=2*e+1;const n=[];for(let o=0;o<t;++o){const t=o<=e?e+1+o:3*e+1-o;for(let i=0;i<t;++i)n[o]||(n[o]=[]),n[o][i]=on([-e-Math.min(0,o-e)+i,o-e])}return n})(5),gn=[],pn=[],mn=e=>{L(pn),pn.push(...e.map(([e,t])=>[dn[e],dn[e].maxHealth,U(tn(t),20),[]]))},yn=(e=>t=>en(e)(nn(t)))(fn),wn=e=>yn(W(e,.05)),Mn=e=>wn(Yt(e)),bn=e=>U(tn(e),20),vn=((t,n,o,i=1/0)=>(a,s)=>{let l=[[a,o(s,a)]];const c=new Map,h=new Map;c.set(a,null),h.set(a,0);let d=a;for(;l.length;){const[a]=l.shift(),d=h.get(a);if(a===s)break;if(d>=i)return null;e(t(a),e=>{const t=d+n(a,e),i=h.get(e);if(!i||t<i){h.set(e,t);const n=t+o(s,e);l.push([e,n]),c.set(e,a)}}),l=r(l,([,e])=>e)}const u=[];for(d=s;d!==a;)u.unshift(d),d=c.get(d);return u})((e=>t=>B(P(Zt,sn(e)(t))))(fn),(e,t)=>Hn(t)?40:1,(e,t)=>an(e,t),1e3),kn=(e=>(t,n)=>{const o=[];for(let i=-n;i<=n;++i){const a=Math.min(n,-i+n);for(let s=Math.max(-n,-i-n);s<=a;++s)o.push(en(e)([i+t[0],-i-s+t[1]]))}return B(o)})(fn),xn=(e,t)=>kn(e,t).filter(e=>!pn.find(([,t,n])=>wn(n)===e&&t>0)),Dn=e=>(t,n)=>pn.filter(([o,i,a])=>(null===e||o.type===e)&&i>0&&an(wn(t),wn(a))<=n),En=e=>(t,n)=>e(t,n).map(([,,e])=>wn(e)),An=Dn(!0),Cn=Dn(!1),Hn=e=>pn.find(([,t,n])=>wn(n)===e&&t>0),Pn=(e,t,n)=>{const o=[...e],i=_([...t],o),s=cn(n);return()=>{const t=hn(s());return a(e,...z(W(i,t),o)),1===t}},Bn={geometry:re([0,-Oe/2+12*1.2/2],0,Fe,12*1.2),render(){const e=Hn(st.target);if(!e)return;const[t,n]=e,{maxHealth:o,name:i}=t;let a=Math.ceil(o/10)+1,s=Math.ceil(n/10)+1;for(;--a>=0;)Le(et,[Fe/2-11-8*a,2],Ue);for(;--s>=0;)Le(et,[Fe/2-11-8*s,2],Xe);Le(tt,[-Fe/2,2],i)}},jn=(e,t)=>(n,o,i,a=!0)=>{const s=500*Math.random()|0,r=1800+(1e3*Math.random()|0),l=12*n,c=se(2*n,2*n),h=J(c,o);let d;const u={display:a},f=e=>t=>X($(t,o))<=e*e;return{propCollision:f(2*n),collision:f(.5*n),test:e=>{u.display&&i&&f(n)(e)&&(i(),i=null)},render:()=>{if(d=oe(h,Xt),!u.display)return;Pe(e,[0,0],d);const n=(Date.now()+s)%r/l;je({style:t,thickness:1},[0,0],oe(K(Z(c,n>1?0:n),o),Xt)),je({style:t,thickness:2},[0,0],d)},toggle:u}},In=jn(`#F9CDAD`,`#FE4365`),Ln=jn(`#EDE574`,`#F9D423`),Sn=jn(`#69D2E7`,`#E0E4CC`),Fn=jn(`#CFF09E`,`#3B8686`),On=jn(`#EDEDF2`,`#CFD5E1`),Tn=jn(`#4F364C`,`#8F9E6F`),Rn=(`#8f9e6f`,se(15,15)),qn=(e,t=1)=>ie(J(1===t?Rn:se(15*t,15*t),U(tn(e),20)),Xt),zn=e=>{e&&(st.target===e?je({style:"#8f9e6f"},[0,0],qn(e,Math.min(Date.now()%2e3/1e3))):je({style:"#8f9e6f"},[0,0],qn(e)))},$n=({name:e,isBoss:t})=>({horizontalAlign:!0,font:`${t?e===`Harm`?30:20:12}px mono`}),_n=(e,t)=>!!e.find(({type:e})=>e===t),Wn=(e,t,n,o)=>(i,a)=>_n(a,e)?Le({style:t,font:`6px mono`},[i[0]+o,i[1]+5],n):null,Un=[Wn(`shield`,`#0064fa`,`S`,-5),Wn(`heal`,`#32fa00`,`H`,0),Wn(`damage`,`#fa3200`,`D`,5)],Xn=([e,t,n,o])=>{if(t>0){const t=Xt(n);Le($n(e),t,e.emoji),Un.forEach(e=>e(t,o))}},Yn=ce.createLinearGradient(0,0,100,100);Yn.addColorStop(0,`#F07241`),Yn.addColorStop(1,`#601848`);const Gn=Tn(200,[0,0]);var Nn={geometry:re([-Fe/2,-Oe/2],0,Fe,Oe),render(){Be(Yn,[0,0],2*Fe,2*Oe,0),Gn.render(),[...gn,st.target].forEach(zn),r([...pn],([,,[,e]])=>-e).forEach(Xn)}};const Vn=(e,t)=>{const[,,,n]=e,o=n.find(({type:e})=>e===`shield`);o&&(t*=1-o.percentage),e[1]-=t},Jn=(e,t)=>e[1]=Math.min(e[1]+t,e[0].maxHealth),Kn=e=>{const[,,,t]=e;e[3]=t.map(e=>!(--e.duration<0)&&e).filter(e=>e),t.forEach(t=>{switch(t.type){case`damage`:Vn(e,t.effect);break;case`heal`:Jn(e,t.effect)}})},Qn=(e,t,n)=>{const o=vn(wn(e),wn(t)).splice(0,n);return o.pop(),o},Zn=[0,-150];let eo=0;const to=[[`avenger`,[0,0,0]],[`child`,[1,0,-1]],[`protector`,[-1,1,0]],[`persecutor`,[-1,0,1]]],no=()=>wn(i(U([0,1],60+100*Math.random()),Math.random()*Math.PI)),oo=(e,t,n,o)=>{const i=[...to];let a=-1;const s=Math.max(e,t,n);for(;++a<s;)a<e&&i.push([`swarmer`,no()]),a<t&&i.push([`vamp`,no()]),a<n&&i.push([`skeli`,no()]);return o&&i.push([o,no()]),i},io=(e,t=1)=>([n,o],i=0)=>[n,o,i,e,t],ao=io("🌲",2),so=io("🌳",2),ro=io("👩🏼‍🌾"),lo=io("👮🏿‍"),co=io("🕵🏽"),ho=io("👨🏻‍🎤"),uo=(io("☁️"),io("⛰️",4)),fo=io("🌷",.5),go=io("🌱",.25),po=(io("👻"),io("🍵"),io(We)),mo=(e,t,n,o,i,a)=>{const s=Math.max(...i.map(e=>e[1][e[1].length-1][0])),r=(e,t)=>{const{width:n,height:o}=ce.measureText(e);return{geometry:re([0,0],0,n,o),render(){Le(t,[0,0],e)}}},l=i.map(e=>{let t=e[0];const{fontOptions:n={},x:o,y:i,rotation:a}=e[1][0][1];return typeof t==`string`&&(t=r(t,n)),t.geometry.position=[o,i],t.geometry.rotation=a,t});let c=!1;const h=Date.now();return{geometry:re([e,t],0,n,o),children:l.map((e,t)=>0!==i[t][1][0][0]?{}:e).reverse(),render({children:e}){const t=Date.now()-h;if(t>s)a&&!c&&(a(),c=!0);else for(const[a,s]of i.entries()){const i=s[1];let c={};for(const[s,[h,d]]of i.entries()){if(t>h){if(0===s&&(e[e.length-1-a]=l[a]),d.remove){e[e.length-1-a]={};break}c={time:h,keyframe:d};continue}if(0===s)break;0===s&&(c={time:h,keyframe:d});let i=(t-c.time)/(h-c.time);i>.995&&(i=1);for(const e in c.keyframe){const t=c.keyframe[e];typeof t==`function`&&(c.keyframe[e]=t(1))}d.symbol?(typeof d.symbol==`string`&&(d.symbol=r(d.symbol,d.fontOptions)),e[e.length-1-a]=d.symbol):e[e.length-1-a]=l[a];const u=d.symbol?Object.assign({},l[a],d.symbol):l[a],{x:f,y:g,rotation:p}=c.keyframe,{x:m,y:y,rotation:w}=d,{geometry:M}=u,{position:b}=M;typeof m==`function`?b[0]=m(i,f,g,p,n,o):void 0!==m&&(b[0]=f+(m-f)*i),typeof y==`function`?b[1]=y(i,f,g,p,n,o):void 0!==y&&(b[1]=g+(y-g)*i),typeof w==`function`?M.rotation=w(i,f,g,p,n,o):void 0!==w&&(M.rotation=p+(w-p)*i);break}}}}},yo=["👨🏻‍🎤","👮🏿‍","🕵🏽","👩🏼‍🌾",We].map((e,t)=>[e,[[2e3+800*t,{x:Fe/4,y:Oe/2}],[2e3+800*t+2e3,{x:0,y:0}],[2e3+800*t+2800,{x:0,y:0}],[2e3+800*t+3800,{x:0,y:-Oe}]]]),wo=[...yo,[`~ fin  RL, BB`,[[14e3,{fontOptions:{style:`#000`},x:-Fe/2+2,y:Oe/2-4}],[6e3+800*yo.length+4900,{}]]],[{geometry:re([0,0],0,Fe,Oe),render(){Be(`#fff`,[0,0],Fe,Oe,0)}},[[0,{x:0,y:0,rotation:0}]]]];var Mo={init:()=>{It.push(mo(0,0,Fe,Oe,wo))},dismiss:()=>{}};let bo=[];const vo=ie(K(se(1e4,1600),[0,800]),Xt),ko=(e=>U(V(e),1/e.length))(Vt.map(({position:e})=>e)),xo=Math.max(...Vt.map(({position:e})=>Y($(e,ko))))+200,Do=ho([...st.position],0),Eo=lo(z([0,10],st.position),0),Ao=ro(z([-10,0],st.position),0),Co=co(z([10,0],st.position),0),Ho=po(z([0,-10],st.position),0);bo.push(Do,Eo,Ao,Co,Ho);const Po=e=>{st.miasma+=50*e,bo=bo.filter(([e,,,t])=>"🌷"!==t||e>st.miasma)};let Bo=!1,jo=0;const Io=[Do[3],`Avenger`],Lo=[Co[3],`Persecutor`],So=[Eo[3],`Protector`],Fo=[Ao[3],`Child`],Oo=[Ho[3],`Origin`],To=[],Ro=[[In,[[`No more running, I'm coming for him`,Io]]],[Ln,[[`Why isn't she returning my calls, this is not like her.`,Fo]]],[Fn,[[`She broke up with me, of course she did.`,Lo]]],[Sn,[[`It takes so much effort at times, but we're worth all of it.`,So]]],[Tn,[[`I saw him again, after all these years.`,Oo],[`He greeted me like we were old friends.`,Oo],()=>{Po(5),Ot(H(8,0,0,`deceit`))}]],[Ln,[[`I can't believe it she said YES!`,Fo]]],[Sn,[[`One or two bar fights later,`,So],[`people didn't mess with me anymore.`,So]]],[Fn,[[`She will never say yes to someone like us.`,Lo]]],[Tn,[[`People pushed me around in college,`,Oo],[`until I couldn't take it anymore.`,Oo],()=>{Po(4),Ot(H(6,6,0,`resentment`))}]],[Fn,[[`It hurt, but its worth it.`,Lo]]],[Ln,[[`My daddy yelled at me, for playing with my toys.`,Fo]]],[Tn,[[`I think it was at highschool graduation.`,Oo],[`Thats when I realized,`,Oo],[`it was all my fault.`,Oo],()=>{Po(2),Ot(H(0,8,2,`doubt`))}]],[Ln,[[`I stayed close behind the older kids.`,Fo],[`They threw cupcake and candy wrappers right on the sidewalk.`,Fo],[`He didn't talk to me, when I was with them.`,Fo]]],[Tn,[[`It hurt he told you is wasn't meant to, but it did.`,Oo],()=>{Po(100),Ot(H(6,6,3,`harm`))}]],[On,[()=>{bo=[],To.splice(0,To.length-1),jo=Date.now(),Bo=!0}]]];{const e=Ro.length+4;let t=-1;for(;++t<e;){const[e,n]=Ro.shift();To.push(((e,t,n)=>e(25,n,()=>st.dialog.push(...t)))(e,n,[50*t-550,650+400*Math.random()|0])),e===Tn&&++t}}const qo=[[ao,50],[so,50],[uo,10],[fo,500],[go,300]],zo=()=>z(U(i([0,1],2*Math.random()*Math.PI),xo*Math.random()),ko),$o=e=>dt(e,ko,xo)&&!!Vt.find(({collision:t})=>t(e)),_o=e=>$o(e)&&!To.find(({propCollision:t})=>t(e)),Wo=Math.max(...qo.map(([,e])=>e));let Uo=-1;for(;++Uo<Wo;)for(const[e,t]of qo)Uo<t&&bo.push(e((()=>{let e=zo();for(;!_o(e);)e=zo();return e})(),0));`#69D2E7`,`#fff`,`#90b4ec`;Po(5);const Xo=()=>{Be("#90b4ec",[0,0],2*Fe,2*Oe,0),He("#69D2E7",[0,0],vo);const e=1.2-Math.abs(Date.now()%7200/3600-1)/10;if(Vt.forEach(({getShoreLine:t})=>je({style:"#fff",thickness:4},[0,0],t(e))),Vt.forEach(({getShoreLine:t})=>Pe(`#fafac8`,[0,0],t(e))),Vt.forEach(({getBase:e})=>Pe(`#00c864`,[0,0],e())),Bo){const e=Date.now()-jo;if(e>3e3)return void Ot(Mo);To.push(On(25+e/3e3*175,[350,900]))}for(const e of To)e.render(),e.test(st.position);bo.map(e=>[...Ut(e),e[2],e[3],e[4]]).sort((e,t)=>t[2]-e[2]).forEach(([e,t,n,o,i,a])=>Le({font:`${12*a*(1-2*(n-10994)/8248748)|0}px monospace`},[e,t-o],i))},Yo=()=>Ge.space?6:3,Go=(e,t)=>{const n=$(st.position,e);Y(n)>t&&z(e,N(n,Yo()))},No=Ke(1);var Vo=()=>{let e;const t=Yo(),n=No();if(X(n)>.5&&(st.target=null),null!==st.target){const n=$(st.target,st.position);X(n)<3&&(st.target=null),e=N(n,t)}else e=N(n,t);const o=q(st.position,e);$o(o)&&o[0]<st.miasma&&!st.dialog.length&&a(st.position,...o),a(Do,...st.position),Go(Eo,20+Date.now()%300/30),Go(Ao,45+Date.now()%300/30),Go(Co,70+Date.now()%300/30),Go(Ho,90+Date.now()%300/30);const i=st.position[0]-Wt[0];Math.abs(i)>.2*Fe&&(Wt[0]+=i-F(i)*Fe*.2),a(Wt,...q(st.position,[0,-100]))},Jo={init:()=>{It.push(_t),st.logic=(e=>{Vo(),Xo(),Ge.click&&!st.dialog.length&&(st.target=Yt(Ge.mousePosition))})},dismiss:()=>{}};const Ko=()=>{Ot(Jo)},Qo={textBaseline:`middle`,style:Qe,font:"24px Arial Black, Gadget, sans-serif",horizontalAlign:!0},Zo={geometry:re([0,0],0,Fe,Oe),render(){1!==Ge.space&&1!==Ge.return||Ko(),Be(`#00f`,[0,0],Fe,Oe,0),Le(Qo,[0,0],`A L T E R`),Le(Qo,[0,-24],We),Le({style:Qe,font:Ze},[-28,51],`new game`),Date.now()%600>400&&He(`white`,[-42,48],[-5,3,5,0,-5,-3])},interact:{onMouseDown:Ko}};let ei=0,ti=0;const ni=()=>{const e=ce.getImageData(0,0,Fe,Oe),t=e.data;let n=-1;for(;++n<t.length;)t[n]=75*(t[n]/75|0);ce.putImageData(e,0,0)};Ot({init:()=>{It.push(Zo),st.logic=null},dismiss:()=>{}}),(e=>{let t=!0;requestAnimationFrame(function n(){ei=Math.min(16,Date.now()-ti),t&&e(ei),ti=Date.now(),requestAnimationFrame(n)})})(e=>{pe(),st.logic&&st.logic(),St(e),Ve(),ni()})}();

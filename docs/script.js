!function(){"use strict";function e(e,t){let n=-1;for(;++n<e.length;)t(e[n],n,e);return e}function t(e,t,n){let o=-1;for(;++o<e.length;)n=t(n,e[o],o,e);return n}function n(e,t=8){const n=Math.pow(10,t);return Math.round(e*n)/n}function o(e,t){const o=Math.sin(t),i=Math.cos(t);return[n(e[0]*i-e[1]*o),n(e[0]*o+e[1]*i)]}function i(e,t){const o=Math.sin(t),i=Math.cos(t),a=e[0];return e[0]=n(e[0]*i-e[1]*o),e[1]=n(a*o+e[1]*i),e}function a(e,t,n){return e[0]=t,e[1]=n,e}function r(e){const t=[Math.round(e[0]),Math.round(e[1]),Math.round(e[2])],n=[Math.abs(t[0]-e[0]),Math.abs(t[1]-e[1]),Math.abs(t[2]-e[2])];return n[0]>n[1]&&n[0]>n[2]?t[0]=-t[1]-t[2]:n[1]>n[2]?t[1]=-t[0]-t[2]:t[2]=-t[0]-t[1],t}function s(e,t){if(e.length<2)return e;const n=Math.floor(e.length/2);return sn(s(e.slice(0,n),t),s(e.slice(n),t),t)}function*c(e,t){let n=-1;for(;++n<t.length;){const o=kn(t[n]),i=En(e,o,500);for(;!i();)a(Gt,...T(dn,e)),yield}}function*l(e){let t=null;for(rt.target=null,P(yn),yn.push(...e);!t;){Jt();const{click:n,t:o}=Xe;1===n&&(rt.target=wn(o),B(e,rt.target)&&(t=rt.target)),yield}return P(yn),t}function*f(e){const t=En(Gt,T(dn,e),2e3);for(;!t();)yield}function*u(e,t,n){const o=e(t,n);if(!o.length)return null;const i=yield*l(o);return Hn(i)}function*d([{o:{attack:{i:e,range:t}}},,n]){const o=yield*u(An(jn),n,t);if(!o)return yield*g(arguments[0]);Kn(o,e),yield*f(o[2])}function*h([{o:{s:{range:e,duration:t,l:n}}},,o]){Cn(o,e).forEach(([,,,e])=>e.push({type:`shield`,duration:t,l:n})),yield}function*y([{type:e,o:{u:{h:t,range:n}}},,o]){const i=yield*u(An(xn(null)),o,n);if(!i)return yield*g(arguments[0]);const[{type:a},,r,s]=i;s.push({type:e===a?`heal`:`damage`,h:t}),yield*f(r)}function*m(e){const[{o:{attack:t,s:n,u:o}}]=e;let i=null;const a=[t.count&&[`Abuse (${t.count})`,()=>{--t.count,i=d}],n.count&&[`Pretend (${n.count})`,()=>{--n.count,i=h}],o.count&&[`Critique (${o.count})`,()=>{--o.count,i=y}]].filter(e=>e),r=Ft.push(Zt(a))-1;for(;!i;)yield;Ft.splice(r,1),yield*i(e)}function*g([{o:{move:{range:e}}},,t]){const n=Mn(t),o=yield*l(Dn(n,e));yield*f(t),yield*c(t,bn(n,o))}function*p(e,t){const[{o:{m:{i:n}}}]=e,o=s(t,([,e])=>e)[0];Kn(o,n),yield*f(o[2]),yield}function*M(e,t){const[{o:{g:{duration:n,l:o}}}]=e,i=s(t,([,e])=>-e)[0],[,,a,r]=i;yield*f(a),r.push({type:`shield`,duration:n,l:o}),yield*f(i[2]),yield}function*w(e,t){const[{type:n,o:{p:{h:o}}}]=e,i=s(t,([,e])=>-e)[0],[a,,r,c]=i;yield*f(r),c.push({type:n===a.type?`heal`:`damage`,h:o}),yield*f(i[2]),yield}function*k([{o:{M:{range:e,type:t}}},,n]){yield*f(n);const o=s(Cn(n,100),([,,e])=>t?jn(e,1).length:Cn(e,1).length);o[0]&&(yield*c(n,Zn(n,o[0][2],e)))}function*b(e){const[{o:{m:{range:t}}},,n]=e,o=Cn(n,t);o.length?yield*p(e,o):yield*k(e),yield}function*v(e){const[{o:{p:{range:t}}},,n]=e,o=Cn(n,t);o.length?yield*w(e,o):yield*k(e),yield}function*D(e){const[{o:{m:{range:t}}},,n]=e,o=Cn(n,t),i=jn(n,t);0===o.length?yield*k(e):i.length>o.length?yield*M(e,i):yield*p(e,o),yield}function*x(e){const[{o:{m:{range:t}}},,n]=e,o=Cn(n,t),i=jn(n,t);0===o.length?yield*k(e):yield*p(e,[...i,...o]),yield}function*A(e){const[{o:{m:{range:t},p:{range:n}}},,o]=e,i=Cn(o,t),a=jn(o,t),r=[...Cn(o,n),...jn(o,n)];i.length>1?yield*p(e,i):a.length>1?yield*M(e,a):r.length?yield*w(e,[...i,...a]):yield*k(e),yield}function*C(e){const[{o:{m:{range:t}}},,n]=e,o=Cn(n,t).filter(([,,,e])=>e.find(({type:e})=>e===`damage`));o.length&&(yield*p(e,o)),yield}function*j(e){let t=0;for(;;){const n=e[t%e.length];++t;const[,o]=n;o>0&&(yield n)}}function H(e,t,n,o){function*i(){const{value:e}=l.next(),[t,,n]=e;rt.target=Mn(n);const o=En(Gt,T(_n,n),2e3);for(;!o();)yield;if(s=null,t.type){let e;switch(t.name){case`Persecutor`:e=[c.move,c.item];break;default:e=Object.keys(t.o).map(e=>c[e])}const n=Ft.push(Zt(e));for(;!s;)yield;Ft.splice(n-1,1)}else s=c[t.name.toLowerCase()];yield*s(e),Qn(e);return 0}const a=oo(e,t,n,o);gn(a);let r=null,s=null;const c={move:[`Move`,()=>s=g],attack:[`Avenge`,()=>s=d],s:[`Protect`,()=>s=h],u:[`Forget`,()=>s=y],item:[`Use`,()=>s=m],k:b,v:v,D:D,A:x,C:C,j:A,*H(){yield*[C,x,A][++eo%9/3|0]}},l=j(mn);return{init:()=>{Gt[2]=340,Ft.push(Jn,In),r=i(),rt.I=(()=>{const{value:a,done:s}=r.next();if(s&&0===a)r=i();else if(s&&1===a)Rt(No);else if(s&&2===a){const i=oo(e,t,n,o);gn(i)}})},B:()=>{}}}const E=(e,n)=>t(e,(e,t,o,i)=>O(e,n(t,o,i)),[]),I=(e,n=(e=>!!e))=>t(e,(e,t,o,i)=>n(t,o,i)?O(e,t):e,[]),B=(e,t)=>-1!==e.indexOf(t),F=e=>e.slice(0),P=e=>{for(;e.length;)e.pop();return e},O=(e,t,n=0)=>{const o=F(e);return o.splice(n,0,t),o},L=e=>e>0?1:e<0?-1:0,R=e=>e*e,S=e=>e&&"number"==typeof e,$=e=>e&&S(e[0])&&S(e[1]),T=(e,t)=>[e[0]+t[0],e[1]+t[1]],z=(e,t)=>(e[0]+=t[0],e[1]+=t[1],e),Y=(e,t)=>[e[0]-t[0],e[1]-t[1]],q=(e,t)=>(e[0]-=t[0],e[1]-=t[1],e),G=(e,t)=>[e[0]*t,e[1]*t],U=(e,t)=>(e[0]*=t,e[1]*=t,e),V=e=>R(e[0])+R(e[1]),W=e=>Math.sqrt(V(e)),X=e=>0===e[0]&&0===e[1]?[0,0]:U(e,1/W(e)),J=(e,t)=>U(X(e),t),K=e=>{const t=[0,0];for(let n=e.length-1;n>=0;--n)z(t,e[n]);return t},N=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]+t[0],n[o+1]=e[o+1]+t[1];return n},Q=(e,t)=>{for(let n=0,o=e.length;n<o;n+=2)e[n]+=t[0],e[n+1]+=t[1];return e},Z=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]-t[0],n[o+1]=e[o+1]-t[1];return n},_=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]*t,n[o+1]=e[o+1]*t;return n},ee=(e,t)=>{const o=[],i=Math.sin(t),a=Math.cos(t);for(let t=0,r=e.length;t<r;t+=2)o[t]=n(e[t]*a-e[t+1]*i),o[t+1]=n(e[t]*i+e[t+1]*a);return o},te=(e,t,n)=>N(ee(Z(e,t),n),t),ne=(e,t)=>{for(let n=0;n<e.length;n+=2)t([e[n],e[n+1]],n/2,e)},oe=(e,t)=>{const n=[];for(let o=0;o<e.length;o+=2)n.push(...t([e[o],e[o+1]],o/2,e));return n},ie=(e,t)=>{for(let n=0;n<e.length;n+=2)e.splice(n,2,...t([e[n],e[n+1]],n/2));return e},ae=(e=(e=>!!e))=>t=>e(t),re=(ae(e=>"Point"===e.shape),ae(e=>"Circle"===e.shape),ae(e=>"Rectangle"===e.shape),ae(e=>"Polygon"===e.shape),(e,t)=>[-e/2,+t/2,-e/2,-t/2,+e/2,-t/2,+e/2,+t/2]),se=(e,t=0,n=1,o=1,i="")=>({shape:"Rectangle",label:i,position:e,rotation:t,width:n,height:o,points:re(n,o)});let ce=document.createElement("canvas"),le=ce.getContext("2d");const fe=(e,t)=>{ce=e;const n=e.getContext("2d",t);n&&(le=n)},ue=[0,0],de=e=>le.translate(n(e[0],0),n(e[1],0)),he=e=>le.rotate(e),ye=(e,t,o)=>le.clearRect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),me=()=>ye(ue,ce.width,ce.height),ge=e=>le.moveTo(n(e[0],0),n(e[1],0)),pe=e=>le.lineTo(n(e[0],0),n(e[1],0)),Me=(e,t)=>le.quadraticCurveTo(n(t[0],0),n(t[1],0),n(e[0],0),n(e[1],0)),we=(e,t,o,i,a)=>le.arc(n(e[0],0),n(e[1],0),t,o,i,a),ke=(e,t,o)=>le.rect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),be=(e,t=0)=>{const n=[e[0],e[1]],o=Z(e,n);le.save(),de(n),he(t),ge(ue),ne(o,pe),le.restore()},ve=(e,t,n=0)=>{const o=[t[t.length-2],t[t.length-1]];le.save(),de(e),he(n),ge(o),ne(t,pe),le.restore()},De=(e,t,n=0)=>{const o=oe(t,(e,t,n)=>U(z(n[2*t-2]?[n[2*t-2],n[2*t-1]]:[n[n.length-2],n[n.length-1]],e),.5));le.save(),de(e),he(n),ge([o[0],o[1]]);let i=0;for(;(i+=2)<=9;)Me(o[i]?[o[i],o[i+1]]:[o[0],o[1]],[t[i-2],t[i-1]]);le.restore()},xe=(e,t,o,i=0)=>{le.save(),de(e),he(i),ke([-t/2,-o/2],n(t,0),n(o,0)),le.restore()},Ae=(e,t=100,n=0,o=0,i=2*Math.PI,a=!1)=>{le.save(),de(e),he(n),we(ue,t,o,i,a),le.restore()},Ce=e=>(t,...n)=>{le.save(),le.beginPath(),le.fillStyle=t,e(...n),le.fill(),le.restore()},je=e=>(t,...n)=>{le.save(),le.beginPath(),le.strokeStyle=t.style||"",le.lineWidth=t.F||1,e(...n),le.stroke(),le.restore()},He=Ce(ve),Ee=Ce(De),Ie=Ce(xe),Be=(Ce(be),Ce(Ae),je(ve),je(De)),Fe=je(xe),Pe=(je(be),je(Ae),(e,t,o,i=0)=>{if(le.save(),le.fillStyle=e.style||"",le.font=e.font||le.font,le.textAlign=e.textAlign||le.textAlign,le.textBaseline=e.textBaseline||le.textBaseline,he(i),e.P){const{width:e}=le.measureText(o);de([-e/2,0])}le.fillText(o,n(t[0],0),n(t[1],0),e.maxWidth),le.restore()}),Oe=document.querySelector(`canvas`);fe(Oe,{alpha:!1}),le.O=!1;const Le=160,Re=192;let Se=Oe.offsetWidth,$e=Oe.offsetHeight,Te=1,ze=1;Oe.width=Le,Oe.height=Re;const Ye=()=>{const{top:e,left:t,width:n,height:o}=Oe.getBoundingClientRect();Se=t,$e=e,Te=Le/n,ze=Re/o};Ye(),document.addEventListener(`DOMContentLoaded`,Ye),window.addEventListener(`resize`,Ye);`👩🏼‍🌾`,`👮🏿‍`,`🕵🏽`,`👨🏻‍🎤`,`👺`,`🌬️`,`🎭`,`🐉`,`🦂`,`🦇`,`👻`,`☠️`,`🌲`,`🌳`,`☁️`,`⛰️`,`🌷`;const qe=`👉🏻`,Ge=(`🍵`,`💎`),Ue=`🖤`,Ve=`💗`,We=(`🌱`,{38:`up`,40:`down`,37:`left`,39:`right`,87:`w`,65:`a`,83:`s`,68:`d`,32:`space`,13:`return`}),Xe={L:0,R:0,left:0,right:0,w:0,a:0,S:0,d:0,$:0,T:0,t:null,click:null},Je=(e,t=1)=>{const n=We[e];return!n||0!==t&&2===Xe[n]||(Xe[n]=t),Xe[n]};document.body.onkeyup=(({keyCode:e})=>Je(e,0)),document.body.onkeydown=(({keyCode:e})=>Je(e,1));const Ke=()=>{const e=Object.keys(Xe);let t=-1;for(;++t<e.length;)1===Xe[e[t]]?Xe[e[t]]=2:Xe[e[t]]=Xe[e[t]]};document.body.onmousedown=(()=>Xe.click=1),document.body.onmouseup=(()=>Xe.click=0);const Ne=({clientX:e,clientY:t,touches:n})=>n?[n[0].clientX,n[0].clientY]:[e,t];document.body.onmousemove=(e=>{const t=q(Ne(e),[Se,$e]);t[0]*=Te,t[1]*=ze,Xe.t=t});const Qe=e=>()=>{const t=[0,0];return(Xe.L||Xe.w)&&++t[1],(Xe.R||Xe.S)&&--t[1],(Xe.left||Xe.a)&&--t[0],(Xe.right||Xe.d)&&++t[0],J(t,e)},Ze=`#fff`,_e=(`#00f`,`Arial Black, Gadget, sans-serif`,`"Lucida Console", Monaco, monospace`,`24px Arial Black, Gadget, sans-serif`,`12px "Lucida Console", Monaco, monospace`),et={font:`6px mono`},tt={style:Ze,font:`10px mono`},nt={style:Ze},ot={style:Ze,F:2},it=[0,-1],at=(e,t,n,o=0)=>{Ie("#00f",T(e,it),t,n*(12*1.1)+o),Fe(ot,T(e,it),t,n*(12*1.1)+o)},rt={Y:[],position:[-545,700],target:null,I:null,q:-550},st=e=>e&&"number"==typeof e,ct=[0,0];class lt{constructor(){this.apply=(e=>Object.assign(Object.create(null),e,{position:[...this.position],rotation:this.rotation})),this.position=ct,this.rotation=0,this.G=[],this.U=[]}save(){this.G.push([this.position[0],this.position[1]]),this.U.push(this.rotation)}restore(){if(this.G.length>0){const e=this.G.pop();$(e)&&(this.position[0]=e[0],this.position[1]=e[1]);const t=this.U.pop();st(t)&&(this.rotation=t)}}}const ft=(e,t)=>L((t[2]-t[0])*(e[1]-t[1])-(t[3]-t[1])*(e[0]-t[0])),ut=(e,t,n)=>V(Y(e,t))<=R(n),dt=(e,t,n,o)=>Math.abs(e[0]-t[0])<=n/2&&Math.abs(e[1]-t[1])<=o/2,ht=(e,t)=>{let n=0,o=t.length,i=0,a=0;for(;;){if(i=n===o-2?0:n+2,-1===(a=ft(e,[t[n],t[n+1],t[i],t[i+1]])))return!1;if((n+=2)>o-2)break}return!0},yt=(e,t,n,o,i)=>dt(e,n,o,i)||ut(n,e,t)||R(e[0]-Math.max(n[0],Math.min(e[0],n[0]+o)))+R(e[1]-Math.max(n[1],Math.min(e[1],n[1]+i)))<R(t),mt=(e,t,n,o,i,a)=>!(Math.abs(o[0]-e[0])>t/2+i/2||Math.abs(o[1]-e[1])>n/2+a/2),gt=(e,t,n,o)=>{if(ht(e,o)||ht(n,t))return!0;const i=Math.max(t.length,o.length);for(let e=0;e<i;e+=2)if(e<t.length&&ht([t[e],t[e+1]],o)||e<o.length&&ht([o[e],o[e+1]],t))return!0;return!1},pt=new Map,Mt=new Map,wt=new Map;let kt=se([0,0],0,window.innerWidth,window.innerHeight,"window");window.onresize=(()=>Object.assign(kt,se([0,0],0,window.innerWidth,window.innerHeight,"window")));const bt=((e=kt)=>t=>{const{V:n={shape:null}}=t;switch(n.shape){case"Circle":return yt(n.position,n.W,e.position,e.width,e.height);case"Rectangle":return mt(n.position,n.width,n.height,e.position,e.width,e.height);case"Polygon":return gt(n.position,Q(te(n.points,[0,0],n.rotation),n.position),e.position,Q(te(e.points,[0,0],e.rotation),e.position));default:return!0}})(kt),vt=t=>n=>{const{V:i,children:a,X:r,J:s}=n;le.save(),t.save(),i&&(de(i.position),z(t.position,o(i.position,t.rotation)),he(i.rotation),t.rotation+=i.rotation),le.save(),r&&(!i||bt(t.apply(i)))&&r(n),le.restore(),a&&e(a,vt(t)),s&&(s.K?pt.set(n,[n,i&&t.apply(i),s.K]):pt.delete(n),s.N?Mt.set(n,[n,i&&t.apply(i),s.N]):Mt.delete(n),s.Z?wt.set(n,[n,i&&t.apply(i),s.Z]):wt.delete(n)),le.restore(),t.restore()},Dt="ontouchstart"in window,xt=e=>ae(e=>!!e.clientX)(e)?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],At=e=>t=>{switch(t.shape){case"Circle":return ut(e,t.position,t.W);case"Rectangle":return dt(e,t.position,t.width,t.height);case"Polygon":return ht(e,Q(te(t.points,[0,0],t.rotation),t.position));default:return!1}};let Ct=0,jt=0,Ht=1,Et=1;const It=()=>{const{top:e,left:t,width:n,height:o}=ce.getBoundingClientRect();Ct=t,jt=e,Ht=ce.width/n,Et=ce.height/o};It(),document.addEventListener("DOMContentLoaded",It),window.addEventListener("resize",It);const Bt=t=>n=>{if(t.size){const o=q(xt(n),[Ct,jt]);o[0]*=Ht,o[1]*=Et;const i=At(o);e(I([...t.values()],([e,t])=>i(t)),([e,t,n])=>n(e,o))}},Ft=[],Pt=()=>{for(;Ft.length;)Ft.pop()},Ot=((e,t)=>(fe(e),e.addEventListener(Dt?"ontouchstart":"mousedown",Bt(pt)),e.addEventListener(Dt?"ontouchmove":"mousemove",Bt(Mt)),e.addEventListener(Dt?"ontouchend":"mouseup",Bt(wt)),()=>{pt.clear(),Mt.clear(),wt.clear(),vt(new lt)(t)}))(Oe,{V:se([Oe.width/2,Oe.height/2],0,Oe.width,Oe.height),children:Ft,X({V:e}){e.position[0]=Oe.width/2,e.position[1]=Oe.height/2,e.width=Oe.width,e.height=Oe.height,e.points=re(e.width,e.height)}});let Lt;const Rt=e=>{Pt(),e.init(),Lt&&Lt.B(),Lt=e};let St=null,$t=0;const Tt=Le-2,zt=Tt-8,Yt=(e,t,n)=>{const o=[];t=t.toUpperCase(),e.textBaseline=`top`,e.font=`12px monospace`;const i=t.split(` `);let a=``,r=0,s=0;for(const[t,c]of i.entries()){const i=`${a+c} `,l=e.measureText(i).width;if(s+i.length>n)return l>zt?(o.push([-zt/2,-29+r,a]),s+=a.length,o.push([-zt/2,-29+r+12*1.1,c.substr(0,n-s)])):o.push([-zt/2,-29+r,i.substr(0,n-s)]),o;l>zt&&t>0?(o.push([-zt/2,-29+r,a]),s+=a.length,a=`${c} `,r+=12*1.1):a=i}return o.push([-zt/2,-29+r,a]),o},qt={V:se([0,Re/2-33],0,Tt,66),X:({V:e})=>{const[t]=rt.Y;if(!t)return;if(typeof t==`function`)return rt.Y.shift()();St||(St=Date.now()),$t=(Date.now()-St)/50|0,at([0,0],e.width,0,e.height);const[n,o]=t,i=Yt(le,n,$t);let a=0;if(o){const[e,t]=o,{width:n}=le.measureText(t),i=n+16+8,r=-Tt/2+n;at([r,-37],i,1,8),le.font=`12px monospace`,Pe(nt,[r-6+8-i/2,-45.6],e),Pe(nt,[r-6+8-i/2+16,-45.6],t),a=12*1.1*.33}i.forEach(([e,t,n])=>{Pe(nt,[e,t+a],n)}),1!==Xe.$&&1!==Xe.click||($t<n.length?St=1:(rt.Y.shift(),St=null))}},Gt=[0,0,240],Ut=e=>{const[t,n]=Y(e,Gt),o=Gt[2],i=n+500;let a,r=t+n*-t/(n+500)+Le/2;return i<0?(a=Re+o*n/i,r=t):i>0?a=Re-o*n/i:(a=Re,r=t),[r,a,Math.pow(500+n,2)+Math.pow(-t,2)]},Vt=e=>Ut(e).slice(0,2),Wt=([e,t])=>{const n=500/(-Gt[2]/(t-Re)-1);return z([-(Le*n+500*Le+-2*e*n+-2*e*500)/1e3,n],Gt)},Xt=Qe(3),Jt=()=>z(Gt,Xt()),Kt=[];let Nt=-1,Qt=-1;for(;++Nt<9;){const e=Math.abs(Nt-4),t=9-e;for(;++Qt<t;)((e,t)=>{const n=re(2*t,2*t),o=N(n,e);Kt.push({position:e,W:t,_:()=>oe(o,Vt),ee:t=>ie(Q(_(n,t),e),Vt),te:(n,o=1)=>ut(n,e,t*o)})})([100*(Nt-5),1e3+100*(e/2+Qt-5)],75+50*Math.random());Qt=0}const Zt=e=>{let t=Le/3;const n=12*1.1*e.length+4;let o=Le/2-t/2-1;const i=Re/2-n/2;let a=0;const r=[];for(const[o,[i,s]]of e.entries()){const e=i.toUpperCase(),{width:c}=le.measureText(e);t=Math.max(t,c+8),r.push({V:se([-t/2+4,-n/2+12*1.1+o*(12*1.1)-2],0,t,12*1.1),X(){Pe(nt,[0,0],e),a===o&&Pe({},[-13,0],qe)},J:{K:s,N(){a=o}}})}for(const e of r)e.V.position[0]=-t/2+4;return o=Le/2-t/2-1,{V:se([o,i],0,t,n),children:r,X(){at([0,0],t,0,n),1===Xe.R&&a<e.length-1?a++:1===Xe.L&&a>0&&a--,1!==Xe.$&&1!==Xe.T||e[a][1]()}}},_t=[[0,1,-1],[1,0,-1],[1,-1,0],[-1,1,0],[0,-1,1],[-1,0,1]],en=e=>([t,n])=>{const o=(e.length-1)/2,i=n+o,a=t+o+Math.min(0,i-o);return e[i]?e[i][a]:null},tn=e=>[Math.sqrt(3)*(e[0]+e[1]/2),1.5*e[1]],nn=e=>{const[t,n]=e,o=[0,0,0];return o[0]=t*Math.sqrt(3)/3-n/3,o[1]=2*n/3,o[2]=-(o[0]+o[1]),r(o)},on=e=>[e[0],e[1],-e[0]-e[1]],an=(e,t)=>(Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])+Math.abs(e[2]-t[2]))/2,rn=e=>t=>n=>en(e)([t[0]+n[0],t[1]+n[1]]),sn=(e,t,n)=>{const o=[];for(;e.length&&t.length;)(n(e[0])||0)<=(n(t[0])||0)?o.push(e.shift()||e[0]):o.push(t.shift()||t[0]);for(;e.length;)o.push(e.shift()||e[0]);for(;t.length;)o.push(t.shift()||t[0]);return o},cn=(e,t=Date.now()%e)=>()=>Math.min((Date.now()+t)%e/e,1),ln=(e,t)=>{const n=Date.now();let o=0;const i=cn(e,t);return()=>Date.now()-n<e?o=Math.max(o,i()):1},fn=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e;var un={ne:{name:`Child`,oe:"👩🏼‍🌾",type:!0,ie:40,o:{move:{range:3},u:{range:4,h:10,duration:5}}},ae:{name:`Avenger`,oe:"👨🏻‍🎤",type:!0,ie:80,o:{move:{range:3},attack:{name:`Avenge`,range:1,i:25}}},re:{name:`Protector`,oe:"👮🏿‍",type:!0,ie:100,o:{move:{range:2},s:{range:1,duration:1,l:1}}},se:{name:`Persecutor`,oe:"🕵🏽",type:!0,ie:60,o:{move:{range:5},attack:{count:10,range:4,i:30},s:{count:10,range:3,l:.5,duration:3},u:{count:10,range:1,h:50,duration:1},reset:{count:3}}},k:{name:`Swarmer`,oe:"🦂",type:!1,ie:30,o:{M:{type:!0,range:3},m:{range:1,i:10}}},v:{name:`Vamp`,oe:"🦇",type:!1,ie:40,o:{M:{type:!1,range:5},p:{range:1,duration:1,h:5}}},D:{name:`Skeli`,oe:"☠️",type:!1,ie:40,o:{M:{type:!1,range:5},m:{range:1,i:20},g:{range:1,duration:1,l:.25}}},A:{name:`Resentment`,oe:"👺",ce:!0,type:!1,ie:60,o:{M:{type:!1,range:5},m:{range:1,i:40}}},C:{name:`Doubt`,oe:"🌬️",ce:!0,type:!1,ie:120,o:{m:{range:10,i:30}}},j:{name:`Deceit`,oe:"🎭",ce:!0,type:!1,ie:120,o:{M:{type:!0,range:3},m:{range:1,i:20},p:{range:3,h:10,duration:3},g:{range:2,duration:2,l:.25}}},H:{name:`Harm`,oe:"🐉",ce:!0,type:!1,ie:120,o:{M:{type:!0,range:3},m:{range:3,i:20},p:{range:3,h:10,duration:3},g:{range:2,duration:2,l:.25}}}};const dn=[0,-150],hn=(e=>{let t=2*e+1;const n=[];for(let o=0;o<t;++o){const t=o<=e?e+1+o:3*e+1-o;for(let i=0;i<t;++i)n[o]||(n[o]=[]),n[o][i]=on([-e-Math.min(0,o-e)+i,o-e])}return n})(5),yn=[],mn=[],gn=e=>{P(mn),mn.push(...e.map(([e,t])=>[un[e],un[e].ie,U(tn(t),20),[]]))},pn=(e=>t=>en(e)(nn(t)))(hn),Mn=e=>pn(G(e,.05)),wn=e=>Mn(Wt(e)),kn=e=>U(tn(e),20),bn=((t,n,o,i=1/0)=>(a,r)=>{let c=[[a,o(r,a)]];const l=new Map,f=new Map;l.set(a,null),f.set(a,0);let u=a;for(;c.length;){const[a]=c.shift(),u=f.get(a);if(a===r)break;if(u>=i)return null;e(t(a),e=>{const t=u+n(a,e),i=f.get(e);if(!i||t<i){f.set(e,t);const n=t+o(r,e);c.push([e,n]),l.set(e,a)}}),c=s(c,([,e])=>e)}const d=[];for(u=r;u!==a;)d.unshift(u),u=l.get(u);return d})((e=>t=>I(E(_t,rn(e)(t))))(hn),(e,t)=>Hn(t)?40:1,(e,t)=>an(e,t),1e3),vn=(e=>(t,n)=>{const o=[];for(let i=-n;i<=n;++i){const a=Math.min(n,-i+n);for(let r=Math.max(-n,-i-n);r<=a;++r)o.push(en(e)([i+t[0],-i-r+t[1]]))}return I(o)})(hn),Dn=(e,t)=>vn(e,t).filter(e=>!mn.find(([,t,n])=>Mn(n)===e&&t>0)),xn=e=>(t,n)=>mn.filter(([o,i,a])=>(null===e||o.type===e)&&i>0&&an(Mn(t),Mn(a))<=n),An=e=>(t,n)=>e(t,n).map(([,,e])=>Mn(e)),Cn=xn(!0),jn=xn(!1),Hn=e=>mn.find(([,t,n])=>Mn(n)===e&&t>0),En=(e,t,n)=>{const o=[...e],i=q([...t],o),r=ln(n);return()=>{const t=fn(r());return a(e,...z(G(i,t),o)),1===t}},In={V:se([0,-Re/2+12*1.2/2],0,Le,12*1.2),X(){const e=Hn(rt.target);if(!e)return;const[t,n]=e,{ie:o,name:i}=t;let a=Math.ceil(o/10)+1,r=Math.ceil(n/10)+1;for(;--a>=0;)Pe(et,[Le/2-11-8*a,2],Ue);for(;--r>=0;)Pe(et,[Le/2-11-8*r,2],Ve);Pe(tt,[-Le/2,2],i)}},Bn=(e,t)=>(n,o,i,a=!0)=>{const r=500*Math.random()|0,s=1800+(1e3*Math.random()|0),c=12*n,l=re(2*n,2*n),f=N(l,o);let u;const d={display:a},h=e=>t=>V(Y(t,o))<=e*e;return{le:h(2*n),te:h(.5*n),test:e=>{d.display&&i&&h(n)(e)&&(i(),i=null)},X:()=>{if(u=oe(f,Vt),!d.display)return;Ee(e,[0,0],u);const n=(Date.now()+r)%s/c;Be({style:t,F:1},[0,0],oe(Q(_(l,n>1?0:n),o),Vt)),Be({style:t,F:2},[0,0],u)},toggle:d}},Fn=Bn(`#F9CDAD`,`#FE4365`),Pn=Bn(`#EDE574`,`#F9D423`),On=Bn(`#69D2E7`,`#E0E4CC`),Ln=Bn(`#CFF09E`,`#3B8686`),Rn=Bn(`#EDEDF2`,`#CFD5E1`),Sn=Bn(`#4F364C`,`#8F9E6F`),$n=(`#8f9e6f`,re(15,15)),Tn=(e,t=1)=>ie(N(1===t?$n:re(15*t,15*t),U(tn(e),20)),Vt),zn=e=>{e&&(rt.target===e?Be({style:"#8f9e6f"},[0,0],Tn(e,Math.min(Date.now()%2e3/1e3))):Be({style:"#8f9e6f"},[0,0],Tn(e)))},Yn=({name:e,ce:t})=>({P:!0,font:`${t?e===`Harm`?30:20:12}px mono`}),qn=(e,t)=>!!e.find(({type:e})=>e===t),Gn=(e,t,n,o)=>(i,a)=>qn(a,e)?Pe({style:t,font:`6px mono`},[i[0]+o,i[1]+5],n):null,Un=[Gn(`shield`,`#0064fa`,`S`,-5),Gn(`heal`,`#32fa00`,`H`,0),Gn(`damage`,`#fa3200`,`D`,5)],Vn=([e,t,n,o])=>{if(t>0){const t=Vt(n);Pe(Yn(e),t,e.oe),Un.forEach(e=>e(t,o))}else e.type},Wn=le.createLinearGradient(0,0,100,100);Wn.addColorStop(0,`#F07241`),Wn.addColorStop(1,`#601848`);const Xn=Sn(200,[0,0]);var Jn={V:se([-Le/2,-Re/2],0,Le,Re),X(){Ie(Wn,[0,0],2*Le,2*Re,0),Xn.X(),[...yn,rt.target].forEach(zn),s([...mn],([,,[,e]])=>-e).forEach(Vn)}};const Kn=(e,t)=>{const[,,,n]=e,o=n.find(({type:e})=>e===`shield`);o&&(t*=1-o.h),e[1]-=t},Nn=(e,t)=>e[1]=Math.min(e[1]+t,e[0].ie),Qn=e=>{const[,,,t]=e;e[3]=t.map(e=>!(--e.duration<0)&&e).filter(e=>e),t.forEach(t=>{switch(t.type){case`damage`:Kn(e,t.h);break;case`heal`:Nn(e,t.h)}})},Zn=(e,t,n)=>{const o=bn(Mn(e),Mn(t)).splice(0,n);return o.pop(),o},_n=[0,-150];let eo=0;const to=[[`avenger`,[0,0,0]],[`child`,[1,0,-1]],[`protector`,[-1,1,0]],[`persecutor`,[-1,0,1]]],no=()=>Mn(i(U([0,1],60+100*Math.random()),Math.random()*Math.PI)),oo=(e,t,n,o)=>{const i=[...to];let a=-1;const r=Math.max(e,t,n);for(;++a<r;)a<e&&i.push([`swarmer`,no()]),a<t&&i.push([`vamp`,no()]),a<n&&i.push([`skeli`,no()]);return o&&i.push([o,no()]),i},io=(e,t=1)=>([n,o],i=0)=>[n,o,i,e,t],ao=io("🌲",2),ro=io("🌳",2),so=io("👩🏼‍🌾"),co=io("👮🏿‍"),lo=io("🕵🏽"),fo=io("👨🏻‍🎤"),uo=(io("☁️"),io("⛰️",4)),ho=io("🌷",.5),yo=io("🌱",.25),mo=(io("👻"),io("🍵"),io(Ge)),go=(e,t,n,o,i,a)=>{const r=Math.max(...i.map(e=>e[1][e[1].length-1][0])),s=(e,t)=>{const{width:n,height:o}=le.measureText(e);return{V:se([0,0],0,n,o),X(){Pe(t,[0,0],e)}}},c=i.map(e=>{let t=e[0];const{fe:n={},x:o,y:i,rotation:a}=e[1][0][1];return typeof t==`string`&&(t=s(t,n)),t.V.position=[o,i],t.V.rotation=a,t});let l=!1;const f=Date.now();return{V:se([e,t],0,n,o),children:c.map((e,t)=>0!==i[t][1][0][0]?{}:e).reverse(),X({children:e}){const t=Date.now()-f;if(t>r)a&&!l&&(a(),l=!0);else for(const[a,r]of i.entries()){const i=r[1];let l={};for(const[r,[f,u]]of i.entries()){if(t>f){if(0===r&&(e[e.length-1-a]=c[a]),u.remove){e[e.length-1-a]={};break}l={time:f,ue:u};continue}if(0===r)break;0===r&&(l={time:f,ue:u});let i=(t-l.time)/(f-l.time);i>.995&&(i=1);for(const e in l.ue){const t=l.ue[e];typeof t==`function`&&(l.ue[e]=t(1))}u.de?(typeof u.de==`string`&&(u.de=s(u.de,u.fe)),e[e.length-1-a]=u.de):e[e.length-1-a]=c[a];const d=u.de?Object.assign({},c[a],u.de):c[a],{x:h,y:y,rotation:m}=l.ue,{x:g,y:p,rotation:M}=u,{V:w}=d,{position:k}=w;typeof g==`function`?k[0]=g(i,h,y,m,n,o):void 0!==g&&(k[0]=h+(g-h)*i),typeof p==`function`?k[1]=p(i,h,y,m,n,o):void 0!==p&&(k[1]=y+(p-y)*i),typeof M==`function`?w.rotation=M(i,h,y,m,n,o):void 0!==M&&(w.rotation=m+(M-m)*i);break}}}}},po=["👨🏻‍🎤","👮🏿‍","🕵🏽","👩🏼‍🌾"].map((e,t)=>[e,[[2e3+800*t,{x:Le/4,y:Re/2}],[2e3+800*t+2e3,{x:0,y:0}],[2e3+800*t+2800,{x:0,y:0}],[2e3+800*t+3800,{x:0,y:-Re}]]]),Mo=[...po,[Ge,[[6e3+800*po.length,{x:Le/4,y:Re/2}],[6e3+800*po.length+2e3,{x:0,y:0}],[6e3+800*po.length+2800,{x:0,y:0}],[6e3+800*po.length+3800,{x:0,y:-Re}]]],[`~ fin    Rafe Lepre, Brian Blakely`,[[6e3+800*po.length+4800,{fe:{style:`#000`},x:-Le/2+2,y:Re/2-4}],[6e3+800*po.length+4900,{}]]],[{V:se([0,0],0,Le,Re),X(){Ie(`#fff`,[0,0],Le,Re,0)}},[[0,{x:0,y:0,rotation:0}]]]];var wo={init:()=>{Ft.push(go(0,0,Le,Re,Mo))},B:()=>{}};let ko=[];const bo=ie(Q(re(1e4,1600),[0,800]),Vt),vo=(e=>U(K(e),1/e.length))(Kt.map(({position:e})=>e)),Do=Math.max(...Kt.map(({position:e})=>W(Y(e,vo))))+200,xo=fo([...rt.position],0),Ao=co(z([0,10],rt.position),0),Co=so(z([-10,0],rt.position),0),jo=lo(z([10,0],rt.position),0),Ho=mo(z([0,-10],rt.position),0);ko.push(xo,Ao,Co,jo,Ho);const Eo=e=>{rt.q+=60*e,ko=ko.filter(([e,,,t])=>"🌷"!==t||e>rt.q)};let Io=!1,Bo=0;const Fo=[xo[3],`Avenger`],Po=[jo[3],`Persecutor`],Oo=[Ao[3],`Protector`],Lo=[Co[3],`Child`],Ro=[Ho[3],`Origin`],So=[],$o=[[Fn,[[`I hate them, and everything they created.`,Fo],[`I'll take them with me if I can.`,Fo]]],[Ln,[[`It couldn't hurt to try, right? Once - only once.`,Po]]],[Pn,[[`I have a new coat, with stars!`,Lo],[`I'm going to do all my favorite things today.`,Lo]]],[On,[[`It takes so much effort at times, but we're worth all of it.`,Oo]]],[Sn,[[`You take out groceries one-by-one, and stack them in the pantry.`,Ro],[`At least three of your things were already in there.`,Ro],()=>{Eo(4),Rt(H(8,0,0,`resentment`))}]],[Pn,[[`I made a lot of new friends.`,Lo]]],[On,[[`Two years and we're beginning to take a turn.`,Oo]]],[Ln,[[`Liars can never get close to me.  I'm a liar too.`,Po]]],[Sn,[[`Some of your friends only know one of you.`,Ro],()=>{Eo(3),Rt(H(6,6,0,`doubt`))}]],[Ln,[[`That little piss hung up on me.`,Po]]],[Pn,[[`He said he doesn't like me anymore.`,Lo],[`I was too hard to be around.`,Lo]]],[Sn,[[`You went to his house for dinner.`,Ro],[`Everyone was was confused when you arrived.`,Ro],[`You were afraid.`,Ro],()=>{Eo(2),Rt(H(0,8,2,`deceit`))}]],[Pn,[[`I walked to school and back home every day.`,Lo],[`I stayed close behind the older kids.`,Lo],[`They threw cupcake and candy wrappers right on the sidewalk.`,Lo],[`I picked them up.`,Lo],[`The one watching wasn't someone I knew.`,Lo],[`I listened to his stories.`,Lo]]],[Sn,[[`When he kissed you, it wasn't the same.`,Ro],()=>{Eo(100),Rt(H(6,6,3,`harm`))}]],[Rn,[()=>{ko=[],So.splice(0,So.length-1),Bo=Date.now(),Io=!0}]]];{const e=$o.length+4;let t=-1;for(;++t<e;){const[e,n]=$o.shift();So.push(((e,t,n)=>e(25,n,()=>rt.Y.push(...t)))(e,n,[60*t-550,700+300*Math.random()|0])),e===Sn&&++t}}const To=[[ao,50],[ro,50],[uo,10],[ho,500],[yo,300]],zo=()=>z(U(i([0,1],2*Math.random()*Math.PI),Do*Math.random()),vo),Yo=e=>ut(e,vo,Do)&&!!Kt.find(({te:t})=>t(e)),qo=e=>Yo(e)&&!So.find(({le:t})=>t(e)),Go=Math.max(...To.map(([,e])=>e));let Uo=-1;for(;++Uo<Go;)for(const[e,t]of To)Uo<t&&ko.push(e((()=>{let e=zo();for(;!qo(e);)e=zo();return e})(),0));`#69D2E7`,`#fff`,`#90b4ec`;Eo(5);const Vo=()=>{Ie("#90b4ec",[0,0],2*Le,2*Re,0),He("#69D2E7",[0,0],bo);const e=1.2-Math.abs(Date.now()%7200/3600-1)/10;if(Kt.forEach(({ee:t})=>Be({style:"#fff",F:4},[0,0],t(e))),Kt.forEach(({ee:t})=>Ee(`#fafac8`,[0,0],t(e))),Kt.forEach(({_:e})=>Ee(`#00c864`,[0,0],e())),Io){const e=Date.now()-Bo;if(e>3e3)return void Rt(wo);So.push(Rn(25+e/3e3*175,[350,900]))}for(const e of So)e.X(),e.test(rt.position);ko.map(e=>[...Ut(e),e[2],e[3],e[4]]).sort((e,t)=>t[2]-e[2]).forEach(([e,t,n,o,i,a])=>Pe({font:`${12*a*(1-2*(n-10994)/8248748)|0}px monospace`},[e,t-o],i))},Wo=()=>Xe.$?6:3,Xo=(e,t)=>{const n=Y(rt.position,e);W(n)>t&&z(e,J(n,Wo()))},Jo=Qe(1);var Ko=()=>{let e;const t=Wo(),n=Jo();if(V(n)>.5&&(rt.target=null),null!==rt.target){const n=Y(rt.target,rt.position);V(n)<3&&(rt.target=null),e=J(n,t)}else e=J(n,t);const o=T(rt.position,e);Yo(o)&&o[0]<rt.q&&!rt.Y.length&&a(rt.position,...o),a(xo,...rt.position),Xo(Ao,20+Date.now()%300/30),Xo(Co,45+Date.now()%300/30),Xo(jo,70+Date.now()%300/30),Xo(Ho,90+Date.now()%300/30);const i=rt.position[0]-Gt[0];Math.abs(i)>.2*Le&&(Gt[0]+=i-L(i)*Le*.2),a(Gt,...T(rt.position,[0,-100]))},No={init:()=>{Ft.push(qt),rt.I=(e=>{Ko(),Vo(),Xe.click&&!rt.Y.length&&(rt.target=Wt(Xe.t))})},B:()=>{}};const Qo=()=>{Rt(No)},Zo={textBaseline:`middle`,style:Ze,font:"24px Arial Black, Gadget, sans-serif",P:!0},_o={V:se([0,0],0,Le,Re),X(){1!==Xe.$&&1!==Xe.T||Qo(),Ie(`#00f`,[0,0],Le,Re,0),Pe(Zo,[0,0],`A L T E R`),Pe(Zo,[0,-24],Ge),Pe({style:Ze,font:_e},[-28,51],`new game`),Date.now()%600>400&&He(`white`,[-42,48],[-5,3,5,0,-5,-3])},J:{K:Qo}};let ei=0,ti=0;const ni=()=>{const e=le.getImageData(0,0,Le,Re),t=e.data;let n=-1;for(;++n<t.length;)t[n]=75*(t[n]/75|0);le.putImageData(e,0,0)};Rt({init:()=>{Ft.push(_o),rt.I=null},B:()=>{}}),(e=>{let t=!0;requestAnimationFrame(function n(){ei=Math.min(16,Date.now()-ti),t&&e(ei),ti=Date.now(),requestAnimationFrame(n)})})(e=>{me(),rt.I&&rt.I(),Ot(e),Ke(),ni()})}();

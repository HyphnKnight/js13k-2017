!function(){"use strict";function e(e,t){for(let n=-1;++n<e.length;)t(e[n],n,e);return e}function t(e,t,n){for(let o=-1;++o<e.length;)n=t(n,e[o],o,e);return n}function n(e,t=8){const n=R(10,t);return L(e*n)/n}function o(e,t){const o=O(t),i=P(t);return[n(e[0]*i-e[1]*o),n(e[0]*o+e[1]*i)]}function i(e,t){const o=O(t),i=P(t),a=e[0];return e[0]=n(e[0]*i-e[1]*o),e[1]=n(a*o+e[1]*i),e}function a(e,t,n){return e[0]=t,e[1]=n,e}function r(e){const t=[L(e[0]),L(e[1]),L(e[2])],n=[B(t[0]-e[0]),B(t[1]-e[1]),B(t[2]-e[2])];return n[0]>n[1]&&n[0]>n[2]?t[0]=-t[1]-t[2]:n[1]>n[2]?t[1]=-t[0]-t[2]:t[2]=-t[0]-t[1],t}function s(e,t){if(2>e.length)return e;const n=Math.floor(e.length/2);return wn(s(e.slice(0,n),t),s(e.slice(n),t),t)}function*c(e,t){for(let n=-1;++n<t.length;){const o=Bn(t[n]),i=zn(e,o,500);for(;!i();)a(nn,...X(Dn,e)),yield}}function*l(e){let t=null;for(kt.target=null,Y(An),An.push(...e);!t;){cn();const{click:n,t:o}=at;1===n&&(kt.target=In(o),T(e,kt.target)&&(t=kt.target)),yield}return Y(An),t}function*d(e){for(const t=zn(nn,X(Dn,e),2e3);!t();)yield}function*f(e,t,n){const o=e(t,n);if(!o.length)return null;const i=yield*l(o);return Tn(i)}function*u([{o:{attack:{i:e,range:t}}},,n]){const o=yield*f(Rn($n),n,t);return o?(so(o,e),void(yield*d(o[2]))):yield*g(arguments[0])}function*y([{o:{s:{range:e,duration:t,l:n}}},,o]){Sn(o,e).forEach(([,,,e])=>e.push({type:`shield`,duration:t,l:n})),yield}function*m([{type:e,o:{u:{m:t,range:n}}},,o]){const i=yield*f(Rn(Ln(null)),o,n);if(!i)return yield*g(arguments[0]);const[{type:a},,r,s]=i;s.push({type:e===a?`heal`:`damage`,m:t}),yield*d(r)}function*h(e){const[{o:{attack:t,s:n,u:o}}]=e;let i=null;const a=[t.count&&[`Abuse (${t.count})`,()=>{--t.count,i=u}],n.count&&[`Pretend (${n.count})`,()=>{--n.count,i=y}],o.count&&[`Critique (${o.count})`,()=>{--o.count,i=m}]].filter(e=>e),r=Vt.push(dn(a))-1;for(;!i;)yield;Vt.splice(r,1),yield*i(e)}function*g([{o:{move:{range:e}}},,t]){const n=En(t),o=yield*l(On(n,e));yield*d(t),yield*c(t,Fn(n,o))}function*p(e,t){const[{o:{h:{i:n}}}]=e,o=s(t,([,e])=>e)[0];so(o,n),yield*d(o[2]),yield}function*w(e,t){const[{o:{g:{duration:n,l:o}}}]=e,i=s(t,([,e])=>-e)[0],[,,a,r]=i;yield*d(a),r.push({type:`shield`,duration:n,l:o}),yield*d(i[2]),yield}function*k(e,t){const[{type:n,o:{p:{m:o}}}]=e,i=s(t,([,e])=>-e)[0],[a,,r,c]=i;yield*d(r),c.push({type:n===a.type?`heal`:`damage`,m:o}),yield*d(i[2]),yield}function*b([{o:{k:{range:e,type:t}}},,n]){yield*d(n);const o=s(Sn(n,100),([,,e])=>t?$n(e,1).length:Sn(e,1).length);o[0]&&(yield*c(n,fo(n,o[0][2],e)))}function*v(e){const[{o:{h:{range:t}}},,n]=e,o=Sn(n,t);o.length?yield*p(e,o):yield*b(e),yield}function*M(e){const[{o:{p:{range:t}}},,n]=e,o=Sn(n,t);o.length?yield*k(e,o):yield*b(e),yield}function*D(e){const[{o:{h:{range:t}}},,n]=e,o=Sn(n,t),i=$n(n,t);0===o.length?yield*b(e):i.length>o.length?yield*w(e,i):yield*p(e,o),yield}function*x(e){const[{o:{h:{range:t}}},,n]=e,o=Sn(n,t),i=$n(n,t);0===o.length?yield*b(e):yield*p(e,[...i,...o]),yield}function*A(e){const[{o:{h:{range:t},p:{range:n}}},,o]=e,i=Sn(o,t),a=$n(o,t),r=[...Sn(o,n),...$n(o,n)];1<i.length?yield*p(e,i):1<a.length?yield*w(e,a):r.length?yield*k(e,[...i,...a]):yield*b(e),yield}function*C(e){const[{o:{h:{range:t}}},,n]=e,o=Sn(n,t).filter(([,,,e])=>e.find(({type:e})=>`damage`===e));o.length&&(yield*p(e,o)),yield}function*j(e){for(let t=0;;){const n=e[t%e.length];++t;const[,o]=n;0<o&&(yield n)}}function H(e,t,n,o){function*i(){const{value:e}=l.next(),[t,,n]=e;kt.target=En(n);for(const e=zn(nn,X(uo,n),2e3);!e();)yield;if(s=null,t.type){let e;switch(t.name){case`Persecutor`:e=[c.move,c.item];break;default:e=Object.keys(t.o).map(e=>c[e])}const n=Vt.push(dn(e));for(;!s;)yield;Vt.splice(n-1,1)}else s=c[t.name.toLowerCase()];return yield*s(e),lo(e),0}const a=go(e,t,n,o);jn(a);let r=null,s=null;const c={move:[`Move`,()=>s=g],attack:[`Avenge`,()=>s=u],s:[`Protect`,()=>s=y],u:[`Forget`,()=>s=m],item:[`Use`,()=>s=h],v:v,M:M,D:D,A:x,C:C,j:A,*H(){yield*[C,x,A][0|++yo%9/3]}},l=j(Cn);return{init:()=>{nn[2]=340,Vt.push(ro,Yn),r=i(),kt.I=(()=>{const{value:a,done:s}=r.next();if(s&&0===a)r=i();else if(s&&1===a)Kt(si);else if(s&&2===a){const i=go(e,t,n,o);jn(i)}})},B:()=>{}}}var E=Math.max,I=Math.min,B=Math.abs,F=Math.PI,P=Math.cos,O=Math.sin,L=Math.round,R=Math.pow;const S=(e,n)=>t(e,(e,t,o,i)=>q(e,n(t,o,i)),[]),$=(e,n=(e=>!!e))=>t(e,(e,t,o,i)=>n(t,o,i)?q(e,t):e,[]),T=(e,t)=>-1!==e.indexOf(t),z=e=>e.slice(0),Y=e=>{for(;e.length;)e.pop();return e},q=(e,t,n=0)=>{const o=z(e);return o.splice(n,0,t),o},G=e=>0<e?1:0>e?-1:0,U=e=>e*e,V=e=>e&&"number"==typeof e,W=e=>e&&V(e[0])&&V(e[1]),X=(e,t)=>[e[0]+t[0],e[1]+t[1]],J=(e,t)=>(e[0]+=t[0],e[1]+=t[1],e),K=(e,t)=>[e[0]-t[0],e[1]-t[1]],N=(e,t)=>(e[0]-=t[0],e[1]-=t[1],e),Q=(e,t)=>[e[0]*t,e[1]*t],Z=(e,t)=>(e[0]*=t,e[1]*=t,e),_=e=>U(e[0])+U(e[1]),ee=e=>Math.sqrt(_(e)),te=e=>0===e[0]&&0===e[1]?[0,0]:Z(e,1/ee(e)),ne=(e,t)=>Z(te(e),t),oe=e=>{const t=[0,0];for(let n=e.length-1;0<=n;--n)J(t,e[n]);return t},ie=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]+t[0],n[o+1]=e[o+1]+t[1];return n},ae=(e,t)=>{for(let n=0,o=e.length;n<o;n+=2)e[n]+=t[0],e[n+1]+=t[1];return e},re=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]-t[0],n[o+1]=e[o+1]-t[1];return n},se=(e,t)=>{const n=[];for(let o=0,i=e.length;o<i;o+=2)n[o]=e[o]*t,n[o+1]=e[o+1]*t;return n},ce=(e,t)=>{const o=[],i=O(t),a=P(t);for(let t=0,r=e.length;t<r;t+=2)o[t]=n(e[t]*a-e[t+1]*i),o[t+1]=n(e[t]*i+e[t+1]*a);return o},le=(e,t,n)=>ie(ce(re(e,t),n),t),de=(e,t)=>{for(let n=0;n<e.length;n+=2)t([e[n],e[n+1]],n/2,e)},fe=(e,t)=>{const n=[];for(let o=0;o<e.length;o+=2)n.push(...t([e[o],e[o+1]],o/2,e));return n},ue=(e,t)=>{for(let n=0;n<e.length;n+=2)e.splice(n,2,...t([e[n],e[n+1]],n/2));return e},ye=(e=(e=>!!e))=>t=>e(t),me=(ye(e=>"Point"===e.shape),ye(e=>"Circle"===e.shape),ye(e=>"Rectangle"===e.shape),ye(e=>"Polygon"===e.shape),(e,t)=>[-e/2,+t/2,-e/2,-t/2,+e/2,-t/2,+e/2,+t/2]),he=(e,t=0,n=1,o=1,i="")=>({shape:"Rectangle",label:i,position:e,rotation:t,width:n,height:o,points:me(n,o)});let ge=document.createElement("canvas"),pe=ge.getContext("2d");const we=(e,t)=>{ge=e;const n=e.getContext("2d",t);n&&(pe=n)},ke=[0,0],be=e=>pe.translate(n(e[0],0),n(e[1],0)),ve=e=>pe.rotate(e),Me=(e,t,o)=>pe.clearRect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),De=()=>Me(ke,ge.width,ge.height),xe=e=>pe.moveTo(n(e[0],0),n(e[1],0)),Ae=e=>pe.lineTo(n(e[0],0),n(e[1],0)),Ce=(e,t)=>pe.quadraticCurveTo(n(t[0],0),n(t[1],0),n(e[0],0),n(e[1],0)),je=(e,t,o,i,a)=>pe.arc(n(e[0],0),n(e[1],0),t,o,i,a),He=(e,t,o)=>pe.rect(n(e[0],0),n(e[1],0),n(t,0),n(o,0)),Ee=(e,t=0)=>{const n=[e[0],e[1]],o=re(e,n);pe.save(),be(n),ve(t),xe(ke),de(o,Ae),pe.restore()},Ie=(e,t,n=0)=>{const o=[t[t.length-2],t[t.length-1]];pe.save(),be(e),ve(n),xe(o),de(t,Ae),pe.restore()},Be=(e,t,n=0)=>{const o=fe(t,(e,t,n)=>Z(J(n[2*t-2]?[n[2*t-2],n[2*t-1]]:[n[n.length-2],n[n.length-1]],e),.5));pe.save(),be(e),ve(n),xe([o[0],o[1]]);for(let e=0;9>=(e+=2);)Ce(o[e]?[o[e],o[e+1]]:[o[0],o[1]],[t[e-2],t[e-1]]);pe.restore()},Fe=(e,t,o,i=0)=>{pe.save(),be(e),ve(i),He([-t/2,-o/2],n(t,0),n(o,0)),pe.restore()},Pe=(e,t=100,n=0,o=0,i=2*F,a=!1)=>{pe.save(),be(e),ve(n),je(ke,t,o,i,a),pe.restore()},Oe=e=>(t,...n)=>{pe.save(),pe.beginPath(),pe.fillStyle=t,e(...n),pe.fill(),pe.restore()},Le=e=>(t,...n)=>{pe.save(),pe.beginPath(),pe.strokeStyle=t.style||"",pe.lineWidth=t.F||1,e(...n),pe.stroke(),pe.restore()},Re=Oe(Ie),Se=Oe(Be),$e=Oe(Fe),Te=(Oe(Ee),Oe(Pe),Le(Ie),Le(Be)),ze=Le(Fe),Ye=(Le(Ee),Le(Pe),(e,t,o,i=0)=>{if(pe.save(),pe.fillStyle=e.style||"",pe.font=e.font||pe.font,pe.textAlign=e.textAlign||pe.textAlign,pe.textBaseline=e.textBaseline||pe.textBaseline,ve(i),e.P){const{width:e}=pe.measureText(o);be([-e/2,0])}pe.fillText(o,n(t[0],0),n(t[1],0),e.maxWidth),pe.restore()}),qe=document.querySelector(`canvas`);we(qe,{alpha:!1}),pe.O=!1;const Ge=160,Ue=192;let Ve=qe.offsetWidth,We=qe.offsetHeight,Xe=1,Je=1;qe.width=Ge,qe.height=Ue;const Ke=()=>{const{top:e,left:t,width:n,height:o}=qe.getBoundingClientRect();Ve=t,We=e,Xe=Ge/n,Je=Ue/o};Ke(),document.addEventListener(`DOMContentLoaded`,Ke),window.addEventListener(`resize`,Ke);const Ne=`👩🏼‍🌾`,Qe=`👮🏿‍`,Ze=`🕵🏽`,_e=`👨🏻‍🎤`,et=(`👺`,`🌬️`,`🎭`,`🐉`,`🦂`,`🦇`,`👻`,`☠️`,`🌲`,`🌳`,`☁️`,`⛰️`,`🌷`,`👉🏻`),tt=(`🍵`,`💎`),nt=`🖤`,ot=`💗`,it=(`🌱`,{38:`up`,40:`down`,37:`left`,39:`right`,87:`w`,65:`a`,83:`s`,68:`d`,32:`space`,13:`return`}),at={L:0,R:0,left:0,right:0,w:0,a:0,S:0,d:0,$:0,T:0,t:null,click:null},rt=(e,t=1)=>{const n=it[e];return n&&(0===t||2!==at[n])&&(at[n]=t),at[n]};document.body.onkeyup=(({keyCode:e})=>rt(e,0)),document.body.onkeydown=(({keyCode:e})=>rt(e,1));const st=()=>{const e=Object.keys(at);for(let t=-1;++t<e.length;)at[e[t]]=1===at[e[t]]?2:at[e[t]]};document.body.onmousedown=(()=>at.click=1),document.body.onmouseup=(()=>at.click=0);const ct=({clientX:e,clientY:t,touches:n})=>n?[n[0].clientX,n[0].clientY]:[e,t];document.body.onmousemove=(e=>{const t=N(ct(e),[Ve,We]);t[0]*=Xe,t[1]*=Je,at.t=t});const lt=e=>()=>{const t=[0,0];return(at.L||at.w)&&++t[1],(at.R||at.S)&&--t[1],(at.left||at.a)&&--t[0],(at.right||at.d)&&++t[0],ne(t,e)},dt=`#fff`,ft=(`#00f`,`Arial Black, Gadget, sans-serif`,`"Lucida Console", Monaco, monospace`,1.1*12),ut=(`24px Arial Black, Gadget, sans-serif`,`12px "Lucida Console", Monaco, monospace`),yt={font:`6px mono`},mt={style:dt,font:`10px mono`},ht={style:dt},gt={style:dt,F:2},pt=[0,-1],wt=(e,t,n,o=0)=>{$e("#00f",X(e,pt),t,n*ft+o),ze(gt,X(e,pt),t,n*ft+o)},kt={Y:[],position:[-545,700],target:null,I:null,q:-550},bt=e=>e&&"number"==typeof e,vt=[0,0];class Mt{constructor(){this.apply=(e=>Object.assign(Object.create(null),e,{position:[...this.position],rotation:this.rotation})),this.position=vt,this.rotation=0,this.G=[],this.U=[]}save(){this.G.push([this.position[0],this.position[1]]),this.U.push(this.rotation)}restore(){if(0<this.G.length){const e=this.G.pop();W(e)&&(this.position[0]=e[0],this.position[1]=e[1]);const t=this.U.pop();bt(t)&&(this.rotation=t)}}}const Dt=(e,t)=>G((t[2]-t[0])*(e[1]-t[1])-(t[3]-t[1])*(e[0]-t[0])),xt=(e,t,n)=>_(K(e,t))<=U(n),At=(e,t,n,o)=>B(e[0]-t[0])<=n/2&&B(e[1]-t[1])<=o/2,Ct=(e,t)=>{for(let n=0,o=t.length,i=0,a=0;;){if(i=n==o-2?0:n+2,-1===(a=Dt(e,[t[n],t[n+1],t[i],t[i+1]])))return!1;if((n+=2)>o-2)break}return!0},jt=(e,t,n,o,i)=>At(e,n,o,i)||xt(n,e,t)||U(e[0]-E(n[0],I(e[0],n[0]+o)))+U(e[1]-E(n[1],I(e[1],n[1]+i)))<U(t),Ht=(e,t,n,o,i,a)=>!(B(o[0]-e[0])>t/2+i/2||B(o[1]-e[1])>n/2+a/2),Et=(e,t,n,o)=>{if(Ct(e,o)||Ct(n,t))return!0;const i=E(t.length,o.length);for(let e=0;e<i;e+=2)if(e<t.length&&Ct([t[e],t[e+1]],o)||e<o.length&&Ct([o[e],o[e+1]],t))return!0;return!1},It=new Map,Bt=new Map,Ft=new Map;let Pt=he([0,0],0,window.innerWidth,window.innerHeight,"window");window.onresize=(()=>Object.assign(Pt,he([0,0],0,window.innerWidth,window.innerHeight,"window")));const Ot=((e=Pt)=>t=>{const{V:n={shape:null}}=t;switch(n.shape){case"Circle":return jt(n.position,n.W,e.position,e.width,e.height);case"Rectangle":return Ht(n.position,n.width,n.height,e.position,e.width,e.height);case"Polygon":return Et(n.position,ae(le(n.points,[0,0],n.rotation),n.position),e.position,ae(le(e.points,[0,0],e.rotation),e.position));default:return!0}})(Pt),Lt=t=>n=>{const{V:i,children:a,X:r,J:s}=n;pe.save(),t.save(),!i||(be(i.position),J(t.position,o(i.position,t.rotation)),ve(i.rotation),t.rotation+=i.rotation),pe.save(),r&&(!i||Ot(t.apply(i)))&&r(n),pe.restore(),a&&e(a,Lt(t)),s&&(s.K?It.set(n,[n,i&&t.apply(i),s.K]):It.delete(n),s.N?Bt.set(n,[n,i&&t.apply(i),s.N]):Bt.delete(n),s.Z?Ft.set(n,[n,i&&t.apply(i),s.Z]):Ft.delete(n)),pe.restore(),t.restore()},Rt="ontouchstart"in window,St=e=>ye(e=>!!e.clientX)(e)?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],$t=e=>t=>{switch(t.shape){case"Circle":return xt(e,t.position,t.W);case"Rectangle":return At(e,t.position,t.width,t.height);case"Polygon":return Ct(e,ae(le(t.points,[0,0],t.rotation),t.position));default:return!1}};let Tt=0,zt=0,Yt=1,qt=1;const Gt=()=>{const{top:e,left:t,width:n,height:o}=ge.getBoundingClientRect();Tt=t,zt=e,Yt=ge.width/n,qt=ge.height/o};Gt(),document.addEventListener("DOMContentLoaded",Gt),window.addEventListener("resize",Gt);const Ut=t=>n=>{if(t.size){const o=N(St(n),[Tt,zt]);o[0]*=Yt,o[1]*=qt;const i=$t(o);e($([...t.values()],([e,t])=>i(t)),([e,t,n])=>n(e,o))}},Vt=[],Wt=()=>{for(;Vt.length;)Vt.pop()},Xt=((e,t)=>(we(e),e.addEventListener(Rt?"ontouchstart":"mousedown",Ut(It)),e.addEventListener(Rt?"ontouchmove":"mousemove",Ut(Bt)),e.addEventListener(Rt?"ontouchend":"mouseup",Ut(Ft)),()=>{It.clear(),Bt.clear(),Ft.clear(),Lt(new Mt)(t)}))(qe,{V:he([qe.width/2,qe.height/2],0,qe.width,qe.height),children:Vt,X({V:e}){e.position[0]=qe.width/2,e.position[1]=qe.height/2,e.width=qe.width,e.height=qe.height,e.points=me(e.width,e.height)}});let Jt;const Kt=e=>{Wt(),e.init(),Jt&&Jt.B(),Jt=e};let Nt=null,Qt=0;const Zt=Ge-2,_t=Zt-8,en=(e,t,n)=>{const o=[];t=t.toUpperCase(),e.textBaseline=`top`,e.font=`12px monospace`;const i=t.split(` `);let a=``,r=0,s=0;for(const[t,c]of i.entries()){const i=`${a+c} `,l=e.measureText(i).width;if(s+i.length>n)return l>_t?(o.push([-_t/2,-29+r,a]),s+=a.length,o.push([-_t/2,-29+r+ft,c.substr(0,n-s)])):o.push([-_t/2,-29+r,i.substr(0,n-s)]),o;l>_t&&0<t?(o.push([-_t/2,-29+r,a]),s+=a.length,a=`${c} `,r+=ft):a=i}return o.push([-_t/2,-29+r,a]),o},tn={V:he([0,Ue/2-33],0,Zt,66),X:({V:e})=>{const[t]=kt.Y;if(!t)return;if(`function`==typeof t)return kt.Y.shift()();Nt||(Nt=Date.now()),Qt=0|(Date.now()-Nt)/50,wt([0,0],e.width,0,e.height);const[n,o]=t,i=en(pe,n,Qt);let a=0;if(o){const[e,t]=o,{width:n}=pe.measureText(t),i=n+16+8,r=-Zt/2+n;wt([r,-37],i,1,8),pe.font=`12px monospace`,Ye(ht,[r-6+8-i/2,-45.6],e),Ye(ht,[r-6+8-i/2+16,-45.6],t),a=.33*ft}i.forEach(([e,t,n])=>{Ye(ht,[e,t+a],n)}),(1===at.$||1===at.click)&&(Qt<n.length?Nt=1:(kt.Y.shift(),Nt=null))}},nn=[0,0,240],on=e=>{const[t,n]=K(e,nn),o=nn[2],i=n+500;let a,r=t+n*-t/(n+500)+Ge/2;return 0>i?(a=Ue+o*n/i,r=t):0<i?a=Ue-o*n/i:(a=Ue,r=t),[r,a,R(500+n,2)+R(-t,2)]},an=e=>on(e).slice(0,2),rn=([e,t])=>{const n=500/(-nn[2]/(t-Ue)-1);return J([-(Ge*n+500*Ge+-2*e*n+-2*e*500)/1e3,n],nn)},sn=lt(3),cn=()=>J(nn,sn()),ln=[];for(let e=-1,t=-1;9>++e;){const n=B(e-4);for(;++t<9-n;)((e,t)=>{const n=me(2*t,2*t),o=ie(n,e);ln.push({position:e,W:t,_:()=>fe(o,an),ee:t=>ue(ae(se(n,t),e),an),te:(n,o=1)=>xt(n,e,t*o)})})([100*(e-5),1e3+100*(n/2+t-5)],75+50*Math.random());t=0}const dn=e=>{let t=Ge/3;const n=ft*e.length+4;let o=Ge/2-t/2-1,i=0;const a=[];for(const[o,[r,s]]of e.entries()){const e=r.toUpperCase(),{width:c}=pe.measureText(e);t=E(t,c+8),a.push({V:he([-t/2+4,-n/2+ft+o*ft-2],0,t,ft),X(){Ye(ht,[0,0],e),i===o&&Ye({},[-13,0],et)},J:{K:s,N(){i=o}}})}for(const e of a)e.V.position[0]=-t/2+4;return o=Ge/2-t/2-1,{V:he([o,Ue/2-n/2],0,t,n),children:a,X(){wt([0,0],t,0,n),1===at.R&&i<e.length-1?i++:1===at.L&&0<i&&i--,(1===at.$||1===at.T)&&e[i][1]()}}},fn=[[0,1,-1],[1,0,-1],[1,-1,0],[-1,1,0],[0,-1,1],[-1,0,1]],un=e=>([t,n])=>{const o=(e.length-1)/2,i=n+o,a=t+o+I(0,i-o);return e[i]?e[i][a]:null},yn=e=>[1.7320508075688772*(e[0]+e[1]/2),1.5*e[1]],mn=e=>{const[t,n]=e,o=[0,0,0];return o[0]=1.7320508075688772*t/3-n/3,o[1]=2*n/3,o[2]=-(o[0]+o[1]),r(o)},hn=e=>[e[0],e[1],-e[0]-e[1]],gn=(e,t)=>(B(e[0]-t[0])+B(e[1]-t[1])+B(e[2]-t[2]))/2,pn=e=>t=>n=>un(e)([t[0]+n[0],t[1]+n[1]]),wn=(e,t,n)=>{const o=[];for(;e.length&&t.length;)(n(e[0])||0)<=(n(t[0])||0)?o.push(e.shift()||e[0]):o.push(t.shift()||t[0]);for(;e.length;)o.push(e.shift()||e[0]);for(;t.length;)o.push(t.shift()||t[0]);return o},kn=(e,t=Date.now()%e)=>()=>I((Date.now()+t)%e/e,1),bn=(e,t)=>{const n=Date.now();let o=0;const i=kn(e,t);return()=>Date.now()-n<e?o=E(o,i()):1},vn=e=>.5>e?8*e*e*e*e:1-8*--e*e*e*e;var Mn={ne:{name:`Child`,oe:Ne,type:!0,ie:40,o:{move:{range:3},u:{range:4,m:10,duration:5}}},ae:{name:`Avenger`,oe:_e,type:!0,ie:80,o:{move:{range:3},attack:{name:`Avenge`,range:1,i:25}}},re:{name:`Protector`,oe:Qe,type:!0,ie:100,o:{move:{range:2},s:{range:1,duration:1,l:1}}},se:{name:`Persecutor`,oe:Ze,type:!0,ie:60,o:{move:{range:5},attack:{count:10,range:4,i:30},s:{count:10,range:3,l:.5,duration:3},u:{count:10,range:1,m:50,duration:1},reset:{count:3}}},v:{name:`Swarmer`,oe:"🦂",type:!1,ie:30,o:{k:{type:!0,range:3},h:{range:1,i:10}}},M:{name:`Vamp`,oe:"🦇",type:!1,ie:40,o:{k:{type:!1,range:5},p:{range:1,duration:1,m:5}}},D:{name:`Skeli`,oe:"☠️",type:!1,ie:40,o:{k:{type:!1,range:5},h:{range:1,i:20},g:{range:1,duration:1,l:.25}}},A:{name:`Resentment`,oe:"👺",ce:!0,type:!1,ie:60,o:{k:{type:!1,range:5},h:{range:1,i:40}}},C:{name:`Doubt`,oe:"🌬️",ce:!0,type:!1,ie:120,o:{h:{range:10,i:30}}},j:{name:`Deceit`,oe:"🎭",ce:!0,type:!1,ie:120,o:{k:{type:!0,range:3},h:{range:1,i:20},p:{range:3,m:10,duration:3},g:{range:2,duration:2,l:.25}}},H:{name:`Harm`,oe:"🐉",ce:!0,type:!1,ie:120,o:{k:{type:!0,range:3},h:{range:3,i:20},p:{range:3,m:10,duration:3},g:{range:2,duration:2,l:.25}}}};const Dn=[0,-150],xn=(e=>{const t=[];for(let e=0;e<11;++e){const n=e<=5?6+e:16-e;for(let o=0;o<n;++o)t[e]||(t[e]=[]),t[e][o]=hn([-5-I(0,e-5)+o,e-5])}return t})(),An=[],Cn=[],jn=e=>{Y(Cn),Cn.push(...e.map(([e,t])=>[Mn[e],Mn[e].ie,Z(yn(t),20),[]]))},Hn=(e=>t=>un(e)(mn(t)))(xn),En=e=>Hn(Q(e,.05)),In=e=>En(rn(e)),Bn=e=>Z(yn(e),20),Fn=((t,n,o,i=1/0)=>(a,r)=>{let c=[[a,o(r,a)]];const l=new Map,d=new Map;l.set(a,null),d.set(a,0);let f=a;for(;c.length;){const[a]=c.shift(),f=d.get(a);if(a===r)break;if(f>=i)return null;e(t(a),e=>{const t=f+n(a,e),i=d.get(e);if(!i||t<i){d.set(e,t);const n=t+o(r,e);c.push([e,n]),l.set(e,a)}}),c=s(c,([,e])=>e)}const u=[];for(f=r;f!==a;)u.unshift(f),f=l.get(f);return u})((e=>t=>$(S(fn,pn(e)(t))))(xn),(e,t)=>Tn(t)?40:1,(e,t)=>gn(e,t),1e3),Pn=(e=>(t,n)=>{const o=[];for(let i=-n;i<=n;++i){const a=I(n,-i+n);for(let r=E(-n,-i-n);r<=a;++r)o.push(un(e)([i+t[0],-i-r+t[1]]))}return $(o)})(xn),On=(e,t)=>Pn(e,t).filter(e=>!Cn.find(([,t,n])=>En(n)===e&&0<t)),Ln=e=>(t,n)=>Cn.filter(([o,i,a])=>(null===e||o.type===e)&&0<i&&gn(En(t),En(a))<=n),Rn=e=>(t,n)=>e(t,n).map(([,,e])=>En(e)),Sn=Ln(!0),$n=Ln(!1),Tn=e=>Cn.find(([,t,n])=>En(n)===e&&0<t),zn=(e,t,n)=>{const o=[...e],i=N([...t],o),r=bn(n);return()=>{const t=vn(r());return a(e,...J(Q(i,t),o)),1===t}},Yn={V:he([0,-Ue/2+1.2*12/2],0,Ge,1.2*12),X(){var e=Math.ceil;const t=Tn(kt.target);if(t){const[n,o]=t,{ie:i,name:a}=n;let r=e(i/10)+1,s=e(o/10)+1;for(;0<=--r;)Ye(yt,[Ge/2-11-8*r,2],nt);for(;0<=--s;)Ye(yt,[Ge/2-11-8*s,2],ot);Ye(mt,[-Ge/2,2],a)}}},qn=(e,t)=>(n,o,i,a=!0)=>{const r=0|500*Math.random(),s=1800+(0|1e3*Math.random()),c=me(2*n,2*n),l=ie(c,o);let d;const f={display:a},u=e=>t=>_(K(t,o))<=e*e;return{le:u(2*n),te:u(.5*n),test:e=>{f.display&&i&&u(n)(e)&&(i(),i=null)},X:()=>{if(d=fe(l,an),!!f.display){Se(e,[0,0],d);const i=(Date.now()+r)%s/(12*n);Te({style:t,F:1},[0,0],fe(ae(se(c,1<i?0:i),o),an)),Te({style:t,F:2},[0,0],d)}},toggle:f}},Gn=qn(`#F9CDAD`,`#FE4365`),Un=qn(`#EDE574`,`#F9D423`),Vn=qn(`#69D2E7`,`#E0E4CC`),Wn=qn(`#CFF09E`,`#3B8686`),Xn=qn(`#EDEDF2`,`#CFD5E1`),Jn=qn(`#4F364C`,`#8F9E6F`),Kn=`#8f9e6f`,Nn=me(15,15),Qn=(e,t=1)=>ue(ie(1===t?Nn:me(15*t,15*t),Z(yn(e),20)),an),Zn=e=>{e&&(kt.target===e?Te({style:Kn},[0,0],Qn(e,I(Date.now()%2e3/1e3))):Te({style:Kn},[0,0],Qn(e)))},_n=({name:e,ce:t})=>({P:!0,font:`${t?`Harm`===e?30:20:12}px mono`}),eo=(e,t)=>!!e.find(({type:e})=>e===t),to=(e,t,n,o)=>(i,a)=>eo(a,e)?Ye({style:t,font:`6px mono`},[i[0]+o,i[1]+5],n):null,no=[to(`shield`,`#0064fa`,`S`,-5),to(`heal`,`#32fa00`,`H`,0),to(`damage`,`#fa3200`,`D`,5)],oo=([e,t,n,o])=>{if(0<t){const t=an(n);Ye(_n(e),t,e.oe),no.forEach(e=>e(t,o))}else e.type},io=pe.createLinearGradient(0,0,100,100);io.addColorStop(0,`#F07241`),io.addColorStop(1,`#601848`);const ao=Jn(200,[0,0]);var ro={V:he([-Ge/2,-Ue/2],0,Ge,Ue),X(){$e(io,[0,0],2*Ge,2*Ue,0),ao.X(),[...An,kt.target].forEach(Zn),s([...Cn],([,,[,e]])=>-e).forEach(oo)}};const so=(e,t)=>{const[,,,n]=e,o=n.find(({type:e})=>`shield`===e);o&&(t*=1-o.m),e[1]-=t},co=(e,t)=>e[1]=I(e[1]+t,e[0].ie),lo=e=>{const[,,,t]=e;e[3]=t.map(e=>!(0>--e.duration)&&e).filter(e=>e),t.forEach(t=>{switch(t.type){case`damage`:so(e,t.m);break;case`heal`:co(e,t.m)}})},fo=(e,t,n)=>{const o=Fn(En(e),En(t)).splice(0,n);return o.pop(),o},uo=[0,-150];let yo=0;const mo=[[`avenger`,[0,0,0]],[`child`,[1,0,-1]],[`protector`,[-1,1,0]],[`persecutor`,[-1,0,1]]],ho=()=>En(i(Z([0,1],60+100*Math.random()),Math.random()*F)),go=(e,t,n,o)=>{const i=[...mo];let a=-1;for(const o=E(e,t,n);++a<o;)a<e&&i.push([`swarmer`,ho()]),a<t&&i.push([`vamp`,ho()]),a<n&&i.push([`skeli`,ho()]);return o&&i.push([o,ho()]),i},po=(e,t=1)=>([n,o],i=0)=>[n,o,i,e,t],wo=po("🌲",2),ko=po("🌳",2),bo=po(Ne),vo=po(Qe),Mo=po(Ze),Do=po(_e),xo=(po("☁️"),po("⛰️",4)),Ao=po("🌷",.5),Co=po("🌱",.25),jo=(po("👻"),po("🍵"),po(tt)),Ho=(e,t,n,o,i,a)=>{const r=E(...i.map(e=>e[1][e[1].length-1][0])),s=(e,t)=>{const{width:n,height:o}=pe.measureText(e);return{V:he([0,0],0,n,o),X(){Ye(t,[0,0],e)}}},c=i.map(e=>{let t=e[0];const{de:n={},x:o,y:i,rotation:a}=e[1][0][1];return`string`==typeof t&&(t=s(t,n)),t.V.position=[o,i],t.V.rotation=a,t});let l=!1;const d=Date.now();return{V:he([e,t],0,n,o),children:c.map((e,t)=>0===i[t][1][0][0]?e:{}).reverse(),X({children:e}){const t=Date.now()-d;if(t>r)a&&!l&&(a(),l=!0);else for(const[a,r]of i.entries()){const i=r[1];let l={};for(const[r,[d,f]]of i.entries()){if(t>d){if(0===r&&(e[e.length-1-a]=c[a]),f.remove){e[e.length-1-a]={};break}l={time:d,fe:f};continue}if(0===r)break;0===r&&(l={time:d,fe:f});let i=(t-l.time)/(d-l.time);for(const e in.995<i&&(i=1),l.fe){const t=l.fe[e];`function`==typeof t&&(l.fe[e]=t(1))}f.ue?(`string`==typeof f.ue&&(f.ue=s(f.ue,f.de)),e[e.length-1-a]=f.ue):e[e.length-1-a]=c[a];const u=f.ue?Object.assign({},c[a],f.ue):c[a],{x:y,y:m,rotation:h}=l.fe,{x:g,y:p,rotation:w}=f,{V:k}=u,{position:b}=k;`function`==typeof g?b[0]=g(i,y,m,h,n,o):void 0!==g&&(b[0]=y+(g-y)*i),`function`==typeof p?b[1]=p(i,y,m,h,n,o):void 0!==p&&(b[1]=m+(p-m)*i),`function`==typeof w?k.rotation=w(i,y,m,h,n,o):void 0!==w&&(k.rotation=h+(w-h)*i);break}}}}},Eo=[_e,Qe,Ze,Ne].map((e,t)=>[e,[[2e3+800*t,{x:Ge/4,y:Ue/2}],[2e3+800*t+2e3,{x:0,y:0}],[2e3+800*t+2800,{x:0,y:0}],[2e3+800*t+3800,{x:0,y:-Ue}]]]),Io=[...Eo,[tt,[[6e3+800*Eo.length,{x:Ge/4,y:Ue/2}],[6e3+800*Eo.length+2e3,{x:0,y:0}],[6e3+800*Eo.length+2800,{x:0,y:0}],[6e3+800*Eo.length+3800,{x:0,y:-Ue}]]],[`~ fin    Rafe Lepre, Brian Blakely`,[[6e3+800*Eo.length+4800,{de:{style:`#000`},x:-Ge/2+2,y:Ue/2-4}],[6e3+800*Eo.length+4900,{}]]],[{V:he([0,0],0,Ge,Ue),X(){$e(`#fff`,[0,0],Ge,Ue,0)}},[[0,{x:0,y:0,rotation:0}]]]];var Bo={init:()=>{Vt.push(Ho(0,0,Ge,Ue,Io))},B:()=>{}};let Fo=[];const Po=ue(ae(me(1e4,1600),[0,800]),an),Oo=(e=>Z(oe(e),1/e.length))(ln.map(({position:e})=>e)),Lo=E(...ln.map(({position:e})=>ee(K(e,Oo))))+200,Ro=Do([...kt.position],0),So=vo(J([0,10],kt.position),0),$o=bo(J([-10,0],kt.position),0),To=Mo(J([10,0],kt.position),0),zo=jo(J([0,-10],kt.position),0);Fo.push(Ro,So,$o,To,zo);const Yo=e=>{kt.q+=60*e,Fo=Fo.filter(([e,,,t])=>"🌷"!==t||e>kt.q)};let qo=!1,Go=0;const Uo=[Ro[3],`Avenger`],Vo=[To[3],`Persecutor`],Wo=[So[3],`Protector`],Xo=[$o[3],`Child`],Jo=[zo[3],`Origin`],Ko=[],No=[[Gn,[[`I hate them, and everything they created.`,Uo],[`I'll take them with me if I can.`,Uo]]],[Wn,[[`It couldn't hurt to try, right? Once - only once.`,Vo]]],[Un,[[`I have a new coat, with stars!`,Xo],[`I'm going to do all my favorite things today.`,Xo]]],[Vn,[[`It takes so much effort at times, but we're worth all of it.`,Wo]]],[Jn,[[`You take out groceries one-by-one, and stack them in the pantry.`,Jo],[`At least three of your things were already in there.`,Jo],()=>{Yo(4),Kt(H(8,0,0,`resentment`))}]],[Un,[[`I made a lot of new friends.`,Xo]]],[Vn,[[`Two years and we're beginning to take a turn.`,Wo]]],[Wn,[[`Liars can never get close to me.  I'm a liar too.`,Vo]]],[Jn,[[`Some of your friends only know one of you.`,Jo],()=>{Yo(3),Kt(H(6,6,0,`doubt`))}]],[Wn,[[`That little piss hung up on me.`,Vo]]],[Un,[[`He said he doesn't like me anymore.`,Xo],[`I was too hard to be around.`,Xo]]],[Jn,[[`You went to his house for dinner.`,Jo],[`Everyone was was confused when you arrived.`,Jo],[`You were afraid.`,Jo],()=>{Yo(2),Kt(H(0,8,2,`deceit`))}]],[Un,[[`I walked to school and back home every day.`,Xo],[`I stayed close behind the older kids.`,Xo],[`They threw cupcake and candy wrappers right on the sidewalk.`,Xo],[`I picked them up.`,Xo],[`The one watching wasn't someone I knew.`,Xo],[`I listened to his stories.`,Xo]]],[Jn,[[`When he kissed you, it wasn't the same.`,Jo],()=>{Yo(100),Kt(H(6,6,3,`harm`))}]],[Xn,[()=>{Fo=[],Ko.splice(0,Ko.length-1),Go=Date.now(),qo=!0}]]];{const e=No.length+4;for(let t=-1;++t<e;){const[e,n]=No.shift();Ko.push(((e,t,n)=>e(25,n,()=>kt.Y.push(...t)))(e,n,[60*t-550,0|700+300*Math.random()])),e===Jn&&++t}}const Qo=[[wo,50],[ko,50],[xo,10],[Ao,500],[Co,300]],Zo=()=>J(Z(i([0,1],2*Math.random()*F),Lo*Math.random()),Oo),_o=e=>xt(e,Oo,Lo)&&!!ln.find(({te:t})=>t(e)),ei=e=>_o(e)&&!Ko.find(({le:t})=>t(e)),ti=E(...Qo.map(([,e])=>e));for(let e=-1;++e<ti;)for(const[t,n]of Qo)e<n&&Fo.push(t((()=>{let e=Zo();for(;!ei(e);)e=Zo();return e})(),0));`#69D2E7`,`#fff`,`#90b4ec`;Yo(5);const ni=()=>{$e("#90b4ec",[0,0],2*Ge,2*Ue,0),Re("#69D2E7",[0,0],Po);const e=1.2-B(Date.now()%7200/3600-1)/10;if(ln.forEach(({ee:t})=>Te({style:"#fff",F:4},[0,0],t(e))),ln.forEach(({ee:t})=>Se(`#fafac8`,[0,0],t(e))),ln.forEach(({_:e})=>Se(`#00c864`,[0,0],e())),qo){const e=Date.now()-Go;if(3e3<e)return void Kt(Bo);Ko.push(Xn(25+e/3e3*175,[350,900]))}for(const e of Ko)e.X(),e.test(kt.position);Fo.map(e=>[...on(e),e[2],e[3],e[4]]).sort((e,t)=>t[2]-e[2]).forEach(([e,t,n,o,i,a])=>Ye({font:`${0|12*a*(1-2*(n-10994)/8248748)}px monospace`},[e,t-o],i))},oi=()=>at.$?6:3,ii=(e,t)=>{const n=K(kt.position,e);ee(n)>t&&J(e,ne(n,oi()))},ai=lt(1);var ri=()=>{let e;const t=oi(),n=ai();if(.5<_(n)&&(kt.target=null),null!==kt.target){const n=K(kt.target,kt.position);3>_(n)&&(kt.target=null),e=ne(n,t)}else e=ne(n,t);const o=X(kt.position,e);_o(o)&&o[0]<kt.q&&!kt.Y.length&&a(kt.position,...o),a(Ro,...kt.position),ii(So,20+Date.now()%300/30),ii($o,45+Date.now()%300/30),ii(To,70+Date.now()%300/30),ii(zo,90+Date.now()%300/30);const i=kt.position[0]-nn[0];B(i)>.2*Ge&&(nn[0]+=i-G(i)*Ge*.2),a(nn,...X(kt.position,[0,-100]))},si={init:()=>{Vt.push(tn),kt.I=(e=>{ri(),ni(),at.click&&!kt.Y.length&&(kt.target=rn(at.t))})},B:()=>{}};const ci=()=>{Kt(si)},li={textBaseline:`middle`,style:dt,font:"24px Arial Black, Gadget, sans-serif",P:!0},di={V:he([0,0],0,Ge,Ue),X(){(1===at.$||1===at.T)&&ci(),$e(`#00f`,[0,0],Ge,Ue,0),Ye(li,[0,0],`A L T E R`),Ye(li,[0,-24],tt),Ye({style:dt,font:ut},[-28,51],`new game`),400<Date.now()%600&&Re(`white`,[-42,48],[-5,3,5,0,-5,-3])},J:{K:ci}};let fi=0,ui=0;const yi=()=>{const e=pe.getImageData(0,0,Ge,Ue),t=e.data;for(let e=-1;++e<t.length;)t[e]=75*(0|t[e]/75);pe.putImageData(e,0,0)};Kt({init:()=>{Vt.push(di),kt.I=null},B:()=>{}}),(e=>{let t=!0;requestAnimationFrame(function n(){fi=I(16,Date.now()-ui),t&&e(fi),ui=Date.now(),requestAnimationFrame(n)})})(e=>{De(),kt.I&&kt.I(),Xt(e),st(),yi()})}();

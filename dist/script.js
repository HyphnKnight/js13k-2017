(function(){'use strict';function a(a,b=8){const c=j(10,b);return Math.round(a*c)/c}function b(b,d){const e=g(d),h=f(d);return[a(b[0]*h-b[1]*e),a(b[0]*e+b[1]*h)]}var c=Math.max,d=Math.floor,e=Math.abs,f=Math.cos,g=Math.sin,h=Math.sqrt,j=Math.pow,k=Math.min;let l=0,m=0;const n=document.querySelector(`canvas`),o=n.getContext(`2d`),p=160,q=192;let r=n.offsetWidth,s=n.offsetHeight,t=1,u=1;n.width=p,n.height=q;const v=()=>{const{top:a,left:b,width:c,height:d}=n.getBoundingClientRect();r=b,s=a,t=p/c,u=q/d};v(),window.addEventListener(`resize`,v);const w=(...a)=>{let b=0;for(let c=a.length-1;0<=c;--c)b+=a[c];return b},x=(a)=>0<a?1:0>a?-1:0,y=(a)=>a*a,z=(a,b)=>(a[0]+=b[0],a[1]+=b[1],a),A=(a,b)=>[a[0]-b[0],a[1]-b[1]],B=(a,b)=>(a[0]-=b[0],a[1]-=b[1],a),C=(a,b)=>(a[0]*=b,a[1]*=b,a),D=(a)=>y(a[0])+y(a[1]),E=(a)=>h(D(a)),F=(a)=>0===a[0]&&0===a[1]?[0,0]:C(a,1/E(a)),G=(a,b)=>C(F(a),b),H=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2){const[e,f]=b([a[d],a[d+1]]);c[d]=e,c[d+1]=f}return c},I=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]+b[0],c[d+1]=a[d+1]+b[1];return c},J=(a,b)=>{for(let c=0,d=a.length;c<d;c+=2)a[c]+=b[0],a[c+1]+=b[1];return a},K=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]-b[0],c[d+1]=a[d+1]-b[1];return c},L=(b,d)=>{const e=[],h=g(d),j=f(d);for(let c=0,f=b.length;c<f;c+=2)e[c]=a(b[c]*j-b[c+1]*h),e[c+1]=a(b[c]*h+b[c+1]*j);return e},M=(a,b,c)=>I(L(K(a,b),c),b),N=()=>Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),O=(a,b)=>[-a/2,+b/2,-a/2,-b/2,+a/2,-b/2,+a/2,+b/2],P=(a,b=0,c=1,d=1,e=``)=>({id:N(),shape:`Rectangle`,label:e,position:a,rotation:b,width:c,height:d,points:O(c,d)}),Q=[0,0],R=(b)=>(c)=>b.translate(a(c[0],0),a(c[1],0)),S=(a)=>(b)=>a.rotate(b),T=(b)=>(c,d,e)=>b.clearRect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),U=(a,b)=>()=>T(a)(Q,b.width,b.height),V=(b)=>(c)=>b.moveTo(a(c[0],0),a(c[1],0)),W=(b)=>(c)=>b.lineTo(a(c[0],0),a(c[1],0)),X=(b)=>(c,d)=>b.quadraticCurveTo(a(d[0],0),a(d[1],0),a(c[0],0),a(c[1],0)),Y=(b)=>(c,d,e,f,g)=>b.arc(a(c[0],0),a(c[1],0),d,e,f,g),Z=(b)=>(c,d,e)=>b.rect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),$=(b)=>(c)=>(d,e,f)=>b.drawImage(c,a(d[0],0),a(d[1],0),e,f),_=(b)=>(c)=>(d,e,f,g,h,i)=>b.drawImage(c,a(e[0],0),a(e[1],0),f,g,a(d[0],0),a(d[1],0),h,i),aa=(a)=>(b,c=0)=>{const d=[b[0],b[1]],e=K(b,d);a.save(),R(a)(d),S(a)(c),V(a)([0,0]);for(let d=0;d<e.length;d+=2)W(a)([e[d],e[d+1]]);a.restore()},ba=(a)=>(b,c,d=0)=>{a.save(),R(a)(b),S(a)(d),V(a)([c[c.length-2],c[c.length-1]]);for(let e=0;e<c.length;e+=2)W(a)([c[e],c[e+1]]);a.restore()},ca=(b)=>(c,d,e,f=0)=>{b.save(),R(b)(c),S(b)(f),Z(b)([-d/2,-e/2],a(d,0),a(e,0)),b.restore()},da=(a)=>(b,c,d=100,e=0,f=2*Math.PI,g=!1)=>{a.save(),R(a)(b),S(a)(c),Y(a)([0,0],d,e,f,g),a.restore()},ea=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.fillStyle=c,a(b)(...d),b.fill(),b.restore()},fa=(a)=>(b)=>(c,d,...e)=>{b.save(),b.beginPath(),b.strokeStyle=c,b.lineWidth=d,a(b)(...e),b.stroke(),b.restore()},ga=ea(ba),ha=ea(ca),ia=ea(aa),ja=ea(da),ka=fa(ba),la=fa(ca),ma=fa(aa),na=fa(da),oa=(b)=>(c,d,e)=>{b.save(),b.strokeStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.strokeText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},pa=(b)=>(c,d,e)=>{b.save(),b.fillStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.fillText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},qa=(a)=>({ctx:a,canvas:a.canvas,translate:R(a),rotate:S(a),moveTo:V(a),lineTo:W(a),quadraticCurveTo:X(a),arc:Y(a),drawLine:aa(a),drawPolygon:ba(a),drawArc:da(a),drawImage:$(a),drawSlicedImage:_(a),fillRectangle:ha(a),fillPolygon:ga(a),fillLine:ia(a),fillArc:ja(a),fillText:pa(a),strokePolygon:ka(a),strokeRectangle:la(a),strokeLine:ma(a),strokeArc:na(a),strokeText:oa(a),clearRect:T(a),clear:U(a,a.canvas)});class ra{constructor(){this.position=Q,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}apply(a){const b=[this.position[0],this.position[1]],c=this.rotation;return Object.assign(Object.create(null),a,{id:N(),position:b,rotation:c})}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(0<this.saved_positions.length){const a=this.saved_positions.pop();a&&(this.position[0]=a[0],this.position[1]=a[1]);const b=this.saved_rotations.pop();!b&&0!==b||(this.rotation=b)}}}const sa=(a,b)=>x((b[2]-b[0])*(a[1]-b[1])-(b[3]-b[1])*(a[0]-b[0])),ta=(a,b,c)=>D(A(a,b))<=y(c),ua=(a,b,c,d)=>e(a[0]-b[0])<=c/2&&e(a[1]-b[1])<=d/2,va=(a,b)=>{const c=d(b.length/2);for(let d=0;d<c;d+=2){const e=d==c-1?0:d+1;if(-1===sa(a,[b[d],b[d+1],b[e],b[e+1]]))return!0}return!1},wa=(a,b,d,e,f)=>ua(a,d,e,f)||ta(d,a,b)||y(a[0]-c(d[0],k(a[0],d[0]+e)))+y(a[1]-c(d[1],k(a[1],d[1]+f)))<y(b),xa=(a,b,c,d,f,g)=>!(e(d[0]-a[0])>b/2+f/2||e(d[1]-a[1])>c/2+g/2),ya=(a,b,d,e)=>{if(va(a,e)||va(d,b))return!0;const f=c(b.length,e.length);for(let c=0;c<f;c+=2)if(c<b.length&&va([b[c],b[c+1]],e)||c<e.length&&va([e[c],e[c+1]],b))return!0;return!1},za=new Map,Aa=new Map,Ba=new Map,Ca=P([0,0],0,window.innerWidth,window.innerHeight,`window`);window.onresize=()=>Object.assign(Ca,P([0,0],0,window.innerWidth,window.innerHeight,`window`));const Da=((a=Ca)=>(b)=>{const{geometry:c={shape:null}}=b;switch(c.shape){case`Circle`:return wa(c.position,c.radius,a.position,a.width,a.height);case`Rectangle`:return xa(c.position,c.width,c.height,a.position,a.width,a.height);case`Polygon`:return ya(c.position,J(M(c.points,[0,0],c.rotation),c.position),a.position,J(M(a.points,[0,0],a.rotation),a.position));default:return!0;}})(Ca),Ea=(a,c)=>(d)=>{const{geometry:e,children:f,render:g,interact:h}=d,{ctx:i,translate:j,rotate:k}=c;i.save(),a.save(),e&&(j(e.position),z(a.position,b(e.position,a.rotation)),k(e.rotation),a.rotation+=e.rotation),i.save(),g&&(!e||Da(a.apply(e)))&&g(c,d),i.restore(),f&&f.forEach(Ea(a,c)),h&&(h.onMouseDown?za.set(d,[d,e&&a.apply(e),h.onMouseDown]):za.delete(d),h.onMouseMove?Aa.set(d,[d,e&&a.apply(e),h.onMouseMove]):Aa.delete(d),h.onMouseUp?Ba.set(d,[d,e&&a.apply(e),h.onMouseUp]):Ba.delete(d)),i.restore(),a.restore()},Fa=`ontouchstart`in window,Ga=(a)=>{if(a.clientX)return[a.clientX,a.clientY];else{const b=a.touches[0];return[b.clientX,b.clientY]}},Ha=(a)=>(b)=>{switch(b.shape){case`Circle`:return ta(a,b.position,b.radius);case`Rectangle`:return ua(a,b.position,b.width,b.height);case`Polygon`:return va(a,J(M(b.points,[0,0],b.rotation),b.position));default:return!1;}},Ia=(a)=>(b)=>{if(a.size){const c=B(Ga(b),[r,s]);c[0]*=t,c[1]*=u;const d=Ha(c);[...a.values()].filter(([a,b])=>!b||d(b)).forEach(([a,b,d])=>d(a,c))}},Ja=`#fff`,Ka=`Arial Black, Gadget, sans-serif`,La=`"Lucida Console", Monaco, monospace`,Ma=`24px ${Ka}`,Na=`12px ${La}`,Oa={38:`up`,40:`down`,37:`left`,39:`right`,81:`q`,87:`w`,69:`e`,65:`a`,83:`s`,68:`d`,48:`0`,49:`1`,50:`2`,51:`3`,52:`4`,53:`5`,54:`6`,55:`7`,56:`8`,57:`9`,189:`-`,187:`=`,32:`space`,13:`return`,16:`shift`,17:`ctrl`,9:`tab`,18:`alt`},Pa={up:!1,down:!1,left:!1,right:!1,q:!1,w:!1,e:!1,a:!1,s:!1,d:!1,0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,"-":!1,"=":!1,space:!1,return:!1,shift:!1,ctrl:!1,tab:!1,alt:!1,click:!1},Qa=(a,b=!0)=>{const c=Oa[a];return c&&(Pa[c]=b),Pa[c]};document.body.onkeyup=({keyCode:a})=>Qa(a,!1),document.body.onkeydown=({keyCode:a})=>Qa(a,!0);let Ra=0;const Sa=(a,b,c)=>({geometry:P(c,0,140,14),render:(a,c)=>{const{fillRectangle:d,fillText:e,ctx:f}=a;f.font=Na;const{width:g}=f.measureText(b);c.geometry.width=g+10,c.geometry.points=O(c.geometry.width,c.geometry.height),e({textBaseline:`middle`,font:Na,style:Ja},[-g/2,0],b)},interact:{onMouseMove:()=>Ra=a,onMouseDown:()=>Ra=a}}),Ta={geometry:P([p/2,q/2],0,140,40),children:[Sa(0,`new game`,[0,48]),Sa(1,`continue game`,[0,72])],render:(a)=>{const{fillText:b,fillPolygon:c}=a;b({textBaseline:`middle`,style:Ja,font:Ma},[-59,0],`A L T E R`),400<Date.now()%600&&c(`white`,0===Ra?[-42,48]:[-60,72],[-5,3,5,0,-5,-3]),(Pa.up||Pa.w)&&(Ra=0),(Pa.down||Pa.s)&&(Ra=1)}},Ua=`\uD83D\uDC69\uD83C\uDFFC\u200D\uD83C\uDF3E`,Va=`\uD83D\uDC6E\uD83C\uDFFF\u200D\u2640\uFE0F`,Wa=`\uD83D\uDD75\uD83C\uDFFD`,Xa=`\uD83D\uDC69\uD83C\uDFFB\u200D\uD83C\uDFA4`,Ya=`\uD83C\uDF32`,Za=`\uD83C\uDF33`,$a=`\u2601\uFE0F`,_a=`\uD83C\uDF75`,ab=`\uD83D\uDD37`,bb={dialog:[[`yolo`,[Xa,`ya mum`]]],position:[0,0]};let cb=!1,db=null;const eb=2,fb=p-eb,gb=q/4,hb=`#fff`,ib=`#00f`,jb=12,kb=1.2*jb,lb=fb-4*eb,mb=gb-4*eb,nb=`#fff`,ob=(a,b,c)=>{const d=[];b=b.toUpperCase(),a.textBaseline=`top`,a.font=`${jb}px monospace`;const e=b.split(` `);let f=``,g=0,h=0;for(const[i,j]of e.entries()){const b=`${f+j} `,e=a.measureText(b),k=e.width;if(h+b.length>c)return k>lb?(d.push([-lb/2,-mb/2+g,f]),h+=f.length,d.push([-lb/2,-mb/2+g+kb,j.substr(0,c-h)])):d.push([-lb/2,-mb/2+g,b.substr(0,c-h)]),d;k>lb&&0<i?(d.push([-lb/2,-mb/2+g,f]),h+=f.length,f=`${j} `,g+=kb):f=b}return d.push([-lb/2,-mb/2+g,f]),d},pb={geometry:P([p/2,q-gb/2],0,fb,gb),render:(a,{geometry:b})=>{const{dialog:c}=bb,[e]=c;if(!e)return;db||(db=Date.now());const{ctx:f,fillRectangle:g,strokeRectangle:h,fillText:i}=a,j=d((Date.now()-db)/50);g(ib,[0,-eb/2],b.width,b.height),h(hb,eb,[0,-eb/2],b.width,b.height);const[k,l]=e,m=ob(f,k,j);let n=0;if(l){const[a,b]=l,{width:c}=f.measureText(b),d=c+16+4*eb,e=-fb/2+c,j=-gb/2-2*eb;g(ib,[e,j],d,kb+4*eb),h(hb,eb,[e,j],d,kb+4*eb),f.font=`${jb}px monospace`,i({style:nb},[e-6+4*eb-d/2,j-kb/2],a),i({style:nb},[e-6+4*eb-d/2+16,j-kb/2],b),n=kb/2}m.forEach(([a,b,c])=>{i({style:nb},[a,b+n],c)}),Pa.space&&!cb?(bb.dialog.shift(),db=null,cb=!0):!Pa.space&&cb&&(cb=!1)},interact:{onMouseDown:()=>{bb.dialog.shift(),db=null}}},{palette:qb,render:rb}=((a,b)=>{const c=qa(a.getContext(`2d`));return c.clear(),a.addEventListener(Fa?`ontouchstart`:`mousedown`,Ia(za)),a.addEventListener(Fa?`ontouchmove`:`mousemove`,Ia(Aa)),a.addEventListener(Fa?`ontouchend`:`mouseup`,Ia(Ba)),{palette:c,render:()=>Ea(new ra,c)(b)}})(n,{geometry:P([0,0],0,window.innerWidth,window.innerHeight),children:[pb]});qb.ctx.imageSmoothingEnabled=!1;const sb=[0,120,200],tb=((a)=>([b,c])=>{const[d,e,f]=a;return[b+c*(d-b)/(c+e)-d+p/2,q-(0===e+c?0:f*c/(e+c)),h(j(e+c,2)+j(d-b,2))]})(sb),ub=[],{fillPolygon:vb,fillText:wb,ctx:xb}=qb,yb=P([0,800],0,1e4,1600),zb=P([0,0],0,2*p,2*q),Ab=xb.createLinearGradient(0,0,200,200);Ab.addColorStop(0,`#5E8C6A`),Ab.addColorStop(1,`#BFB35A`);const Bb=xb.createLinearGradient(0,0,200,200);Bb.addColorStop(0,`#69D2E7`),Bb.addColorStop(1,`#A7DBD8`);const Cb=()=>{vb(Bb,[0,0],zb.points),vb(Ab,[0,0],H(I(yb.points,yb.position),tb)),ub.map((a)=>[...tb(a),a[2],a[3],a[4]]).sort((c,a)=>a[2]-c[2]).forEach(([a,b,c,d,e])=>wb({},[a,b-d],e))},Db=(a)=>([b,c],d=0)=>[b,c,d,a],Eb=Db(Ya),Fb=Db(Za),Gb=Db(Ua),Hb=Db(Va),Ib=Db(Wa),Jb=Db(Xa),Kb=Db($a),Lb=Db(_a),Mb=Db(ab),Nb=[0,0],Ob=3;let Pb=1e3;for(;0<--Pb;)ub.push((0.5<Math.random()?Eb:Fb)([5120*Math.random()-2560,1280*Math.random()],0));for(Pb=25;0<--Pb;)ub.push(Kb([1e4*Math.random()-5e3,1e3*Math.random()+3500],30*Math.random()+10));for(Pb=5;0<--Pb;)ub.push(Lb([5120*Math.random()-2560,1280*Math.random()],0));const i=Jb([20*Math.random()-10,20*Math.random()-10],0),Qb=Gb([20*Math.random()-10,20*Math.random()-10],0),Rb=Hb([20*Math.random()-10,20*Math.random()-10],0),Sb=Ib([20*Math.random()-10,20*Math.random()-10],0),Tb=Mb([20*Math.random()-10,20*Math.random()-10],0),Ub=()=>(a,b)=>{const c=A(bb.position,a);E(c)>b&&z(a,G(c,Ob))};ub.push(i,Qb,Rb,Sb,Tb);var Vb=()=>{Nb[0]=0,Nb[1]=0,(Pa.w||Pa.up)&&(Nb[1]+=1),(Pa.s||Pa.down)&&(Nb[1]-=1),(Pa.d||Pa.right)&&(Nb[0]+=1),(Pa.a||Pa.left)&&(Nb[0]-=1),z(bb.position,G(Nb,Ob)),bb.position[1]=c(bb.position[1],5),i[0]=bb.position[0],i[1]=bb.position[1];const a=Ub(i);a(Qb,20+Date.now()%300/30),a(Rb,45+Date.now()%300/30),a(Sb,70+Date.now()%300/30),a(Tb,90+Date.now()%300/30);const b=bb.position[0]-sb[0];e(b)>0.2*p&&(sb[0]+=b-0.2*(x(b)*p))};((a)=>{let b=!0;return requestAnimationFrame(function c(){l=k(16,Date.now()-m),b&&a(l),m=Date.now(),requestAnimationFrame(c)}),()=>b=!b})((a)=>{Vb(a),qb.clear(),Cb(),rb()})})();
(function(){'use strict';function a(a,b=8){const c=l(10,b);return Math.round(a*c)/c}function b(b,d){const e=j(d),f=h(d);return[a(b[0]*f-b[1]*e),a(b[0]*e+b[1]*f)]}async function c(a,b){if(``===a)return await Zb(0.75*(1e3*b));const c=Yb.createOscillator(),d=Yb.createGain();c.connect(d),c.type=`sawtooth`,c.frequency.value=a,d.connect(Yb.destination),c.start(0),d.gain.exponentialRampToValueAtTime(1e-5,Yb.currentTime+b),await Zb(0.75*(1e3*b))}async function d(a){for(let b=-1,d=-1;++b<a.length;){const[e,f]=a[b];if(Array.isArray(e)){for(;++d<e.length-1;)c(e[d],Array.isArray(f)?f[d]:f);c(e[d],Array.isArray(f)?f[d]:f),await Zb(0.75*(1e3*(Array.isArray(f)?m(...f):f))),d=-1}else await c(e,f)}return await!0}var e=Math.max,f=Math.floor,g=Math.abs,h=Math.cos,j=Math.sin,k=Math.sqrt,l=Math.pow,m=Math.min;let n=0,o=0;const p=document.querySelector(`canvas`),q=p.getContext(`2d`),r=160,s=192;let t=p.offsetWidth,u=p.offsetHeight,v=1,w=1;p.width=r,p.height=s;const x=()=>{const{top:a,left:b,width:c,height:d}=p.getBoundingClientRect();t=b,u=a,v=r/c,w=s/d};x(),window.addEventListener(`resize`,x);const y=(...a)=>{let b=0;for(let c=a.length-1;0<=c;--c)b+=a[c];return b},z=(a)=>0<a?1:0>a?-1:0,A=(a)=>a*a,B=(a,b)=>(a[0]+=b[0],a[1]+=b[1],a),C=(a,b)=>[a[0]-b[0],a[1]-b[1]],D=(a,b)=>(a[0]-=b[0],a[1]-=b[1],a),E=(a,b)=>(a[0]*=b,a[1]*=b,a),F=(a)=>A(a[0])+A(a[1]),G=(a)=>k(F(a)),H=(a)=>0===a[0]&&0===a[1]?[0,0]:E(a,1/G(a)),I=(a,b)=>E(H(a),b),J=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2){const[e,f]=b([a[d],a[d+1]]);c[d]=e,c[d+1]=f}return c},K=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]+b[0],c[d+1]=a[d+1]+b[1];return c},L=(a,b)=>{for(let c=0,d=a.length;c<d;c+=2)a[c]+=b[0],a[c+1]+=b[1];return a},M=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]-b[0],c[d+1]=a[d+1]-b[1];return c},N=(b,d)=>{const e=[],f=j(d),g=h(d);for(let c=0,h=b.length;c<h;c+=2)e[c]=a(b[c]*g-b[c+1]*f),e[c+1]=a(b[c]*f+b[c+1]*g);return e},O=(a,b,c)=>K(N(M(a,b),c),b),P=()=>Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),Q=(a,b)=>[-a/2,+b/2,-a/2,-b/2,+a/2,-b/2,+a/2,+b/2],R=(a,b=0,c=1,d=1,e=``)=>({id:P(),shape:`Rectangle`,label:e,position:a,rotation:b,width:c,height:d,points:Q(c,d)}),S=[0,0],T=(b)=>(c)=>b.translate(a(c[0],0),a(c[1],0)),U=(a)=>(b)=>a.rotate(b),V=(b)=>(c,d,e)=>b.clearRect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),W=(a,b)=>()=>V(a)(S,b.width,b.height),X=(b)=>(c)=>b.moveTo(a(c[0],0),a(c[1],0)),Y=(b)=>(c)=>b.lineTo(a(c[0],0),a(c[1],0)),Z=(b)=>(c,d)=>b.quadraticCurveTo(a(d[0],0),a(d[1],0),a(c[0],0),a(c[1],0)),$=(b)=>(c,d,e,f,g)=>b.arc(a(c[0],0),a(c[1],0),d,e,f,g),_=(b)=>(c,d,e)=>b.rect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),aa=(b)=>(c)=>(d,e,f)=>b.drawImage(c,a(d[0],0),a(d[1],0),e,f),ba=(b)=>(c)=>(d,e,f,g,h,i)=>b.drawImage(c,a(e[0],0),a(e[1],0),f,g,a(d[0],0),a(d[1],0),h,i),ca=(a)=>(b,c=0)=>{const d=[b[0],b[1]],e=M(b,d);a.save(),T(a)(d),U(a)(c),X(a)([0,0]);for(let d=0;d<e.length;d+=2)Y(a)([e[d],e[d+1]]);a.restore()},da=(a)=>(b,c,d=0)=>{a.save(),T(a)(b),U(a)(d),X(a)([c[c.length-2],c[c.length-1]]);for(let e=0;e<c.length;e+=2)Y(a)([c[e],c[e+1]]);a.restore()},ea=(b)=>(c,d,e,f=0)=>{b.save(),T(b)(c),U(b)(f),_(b)([-d/2,-e/2],a(d,0),a(e,0)),b.restore()},fa=(a)=>(b,c,d=100,e=0,f=2*Math.PI,g=!1)=>{a.save(),T(a)(b),U(a)(c),$(a)([0,0],d,e,f,g),a.restore()},ga=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.fillStyle=c,a(b)(...d),b.fill(),b.restore()},ha=(a)=>(b)=>(c,d,...e)=>{b.save(),b.beginPath(),b.strokeStyle=c,b.lineWidth=d,a(b)(...e),b.stroke(),b.restore()},ia=ga(da),ja=ga(ea),ka=ga(ca),la=ga(fa),ma=ha(da),na=ha(ea),oa=ha(ca),pa=ha(fa),qa=(b)=>(c,d,e)=>{b.save(),b.strokeStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.strokeText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},ra=(b)=>(c,d,e)=>{b.save(),b.fillStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.fillText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},sa=(a)=>({ctx:a,canvas:a.canvas,translate:T(a),rotate:U(a),moveTo:X(a),lineTo:Y(a),quadraticCurveTo:Z(a),arc:$(a),drawLine:ca(a),drawPolygon:da(a),drawArc:fa(a),drawImage:aa(a),drawSlicedImage:ba(a),fillRectangle:ja(a),fillPolygon:ia(a),fillLine:ka(a),fillArc:la(a),fillText:ra(a),strokePolygon:ma(a),strokeRectangle:na(a),strokeLine:oa(a),strokeArc:pa(a),strokeText:qa(a),clearRect:V(a),clear:W(a,a.canvas)});class ta{constructor(){this.position=S,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}apply(a){const b=[this.position[0],this.position[1]],c=this.rotation;return Object.assign(Object.create(null),a,{id:P(),position:b,rotation:c})}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(0<this.saved_positions.length){const a=this.saved_positions.pop();a&&(this.position[0]=a[0],this.position[1]=a[1]);const b=this.saved_rotations.pop();!b&&0!==b||(this.rotation=b)}}}const ua=(a,b)=>z((b[2]-b[0])*(a[1]-b[1])-(b[3]-b[1])*(a[0]-b[0])),va=(a,b,c)=>F(C(a,b))<=A(c),wa=(a,b,c,d)=>g(a[0]-b[0])<=c/2&&g(a[1]-b[1])<=d/2,xa=(a,b)=>{const c=f(b.length/2);for(let d=0;d<c;d+=2){const e=d==c-1?0:d+1;if(-1===ua(a,[b[d],b[d+1],b[e],b[e+1]]))return!0}return!1},ya=(a,b,c,d,f)=>wa(a,c,d,f)||va(c,a,b)||A(a[0]-e(c[0],m(a[0],c[0]+d)))+A(a[1]-e(c[1],m(a[1],c[1]+f)))<A(b),za=(a,b,c,d,e,f)=>!(g(d[0]-a[0])>b/2+e/2||g(d[1]-a[1])>c/2+f/2),Aa=(a,b,c,d)=>{if(xa(a,d)||xa(c,b))return!0;const f=e(b.length,d.length);for(let e=0;e<f;e+=2)if(e<b.length&&xa([b[e],b[e+1]],d)||e<d.length&&xa([d[e],d[e+1]],b))return!0;return!1},Ba=new Map,Ca=new Map,Da=new Map,Ea=R([0,0],0,window.innerWidth,window.innerHeight,`window`);window.onresize=()=>Object.assign(Ea,R([0,0],0,window.innerWidth,window.innerHeight,`window`));const Fa=((a=Ea)=>(b)=>{const{geometry:c={shape:null}}=b;switch(c.shape){case`Circle`:return ya(c.position,c.radius,a.position,a.width,a.height);case`Rectangle`:return za(c.position,c.width,c.height,a.position,a.width,a.height);case`Polygon`:return Aa(c.position,L(O(c.points,[0,0],c.rotation),c.position),a.position,L(O(a.points,[0,0],a.rotation),a.position));default:return!0;}})(Ea),Ga=(a,c)=>(d)=>{const{geometry:e,children:f,render:g,interact:h}=d,{ctx:i,translate:j,rotate:k}=c;i.save(),a.save(),e&&(j(e.position),B(a.position,b(e.position,a.rotation)),k(e.rotation),a.rotation+=e.rotation),i.save(),g&&(!e||Fa(a.apply(e)))&&g(c,d),i.restore(),f&&f.forEach(Ga(a,c)),h&&(h.onMouseDown?Ba.set(d,[d,e&&a.apply(e),h.onMouseDown]):Ba.delete(d),h.onMouseMove?Ca.set(d,[d,e&&a.apply(e),h.onMouseMove]):Ca.delete(d),h.onMouseUp?Da.set(d,[d,e&&a.apply(e),h.onMouseUp]):Da.delete(d)),i.restore(),a.restore()},Ha=`ontouchstart`in window,Ia=(a)=>{if(a.clientX)return[a.clientX,a.clientY];else{const b=a.touches[0];return[b.clientX,b.clientY]}},Ja=(a)=>(b)=>{switch(b.shape){case`Circle`:return va(a,b.position,b.radius);case`Rectangle`:return wa(a,b.position,b.width,b.height);case`Polygon`:return xa(a,L(O(b.points,[0,0],b.rotation),b.position));default:return!1;}},Ka=(a)=>(b)=>{if(a.size){const c=D(Ia(b),[t,u]);c[0]*=v,c[1]*=w;const d=Ja(c);[...a.values()].filter(([a,b])=>!b||d(b)).forEach(([a,b,d])=>d(a,c))}},La=`#fff`,Ma=`Arial Black, Gadget, sans-serif`,Na=`"Lucida Console", Monaco, monospace`,Oa=`24px ${Ma}`,Pa=`12px ${Na}`,Qa={38:`up`,40:`down`,37:`left`,39:`right`,81:`q`,87:`w`,69:`e`,65:`a`,83:`s`,68:`d`,48:`0`,49:`1`,50:`2`,51:`3`,52:`4`,53:`5`,54:`6`,55:`7`,56:`8`,57:`9`,189:`-`,187:`=`,32:`space`,13:`return`,16:`shift`,17:`ctrl`,9:`tab`,18:`alt`},Ra={up:!1,down:!1,left:!1,right:!1,q:!1,w:!1,e:!1,a:!1,s:!1,d:!1,0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,"-":!1,"=":!1,space:!1,return:!1,shift:!1,ctrl:!1,tab:!1,alt:!1,click:!1},Sa=(a,b=!0)=>{const c=Qa[a];return c&&(Ra[c]=b),Ra[c]};document.body.onkeyup=({keyCode:a})=>Sa(a,!1),document.body.onkeydown=({keyCode:a})=>Sa(a,!0);let Ta=0;const Ua=(a,b,c)=>({geometry:R(c,0,140,14),render:(a,c)=>{const{fillRectangle:d,fillText:e,ctx:f}=a;f.font=Pa;const{width:g}=f.measureText(b);c.geometry.width=g+10,c.geometry.points=Q(c.geometry.width,c.geometry.height),e({textBaseline:`middle`,font:Pa,style:La},[-g/2,0],b)},interact:{onMouseMove:()=>Ta=a,onMouseDown:()=>Ta=a}}),Va={geometry:R([r/2,s/2],0,140,40),children:[Ua(0,`new game`,[0,48]),Ua(1,`continue game`,[0,72])],render:(a)=>{const{fillText:b,fillPolygon:c}=a;b({textBaseline:`middle`,style:La,font:Oa},[-59,0],`A L T E R`),400<Date.now()%600&&c(`white`,0===Ta?[-42,48]:[-60,72],[-5,3,5,0,-5,-3]),(Ra.up||Ra.w)&&(Ta=0),(Ra.down||Ra.s)&&(Ta=1)}},Wa=`\uD83D\uDC69\uD83C\uDFFC\u200D\uD83C\uDF3E`,Xa=`\uD83D\uDC6E\uD83C\uDFFF\u200D\u2640\uFE0F`,Ya=`\uD83D\uDD75\uD83C\uDFFD`,Za=`\uD83D\uDC69\uD83C\uDFFB\u200D\uD83C\uDFA4`,$a=`\uD83C\uDF32`,_a=`\uD83C\uDF33`,ab=`\u2601\uFE0F`,bb=`\uD83C\uDF75`,cb=`\uD83D\uDD37`,db={dialog:[[`yolo`,[Za,`ya mum`]]],position:[0,0]};let eb=!1,fb=null;const gb=2,hb=r-gb,ib=s/4,jb=`#fff`,kb=`#00f`,lb=12,mb=1.2*lb,nb=hb-4*gb,ob=ib-4*gb,pb=`#fff`,qb=(a,b,c)=>{const d=[];b=b.toUpperCase(),a.textBaseline=`top`,a.font=`${lb}px monospace`;const e=b.split(` `);let f=``,g=0,h=0;for(const[i,j]of e.entries()){const b=`${f+j} `,e=a.measureText(b),k=e.width;if(h+b.length>c)return k>nb?(d.push([-nb/2,-ob/2+g,f]),h+=f.length,d.push([-nb/2,-ob/2+g+mb,j.substr(0,c-h)])):d.push([-nb/2,-ob/2+g,b.substr(0,c-h)]),d;k>nb&&0<i?(d.push([-nb/2,-ob/2+g,f]),h+=f.length,f=`${j} `,g+=mb):f=b}return d.push([-nb/2,-ob/2+g,f]),d},rb={geometry:R([r/2,s-ib/2],0,hb,ib),render:(a,{geometry:b})=>{const{dialog:c}=db,[d]=c;if(!d)return;fb||(fb=Date.now());const{ctx:e,fillRectangle:g,strokeRectangle:h,fillText:i}=a,j=f((Date.now()-fb)/50);g(kb,[0,-gb/2],b.width,b.height),h(jb,gb,[0,-gb/2],b.width,b.height);const[k,l]=d,m=qb(e,k,j);let n=0;if(l){const[a,b]=l,{width:c}=e.measureText(b),d=c+16+4*gb,f=-hb/2+c,j=-ib/2-2*gb;g(kb,[f,j],d,mb+4*gb),h(jb,gb,[f,j],d,mb+4*gb),e.font=`${lb}px monospace`,i({style:pb},[f-6+4*gb-d/2,j-mb/2],a),i({style:pb},[f-6+4*gb-d/2+16,j-mb/2],b),n=mb/2}m.forEach(([a,b,c])=>{i({style:pb},[a,b+n],c)}),Ra.space&&!eb?(db.dialog.shift(),fb=null,eb=!0):!Ra.space&&eb&&(eb=!1)},interact:{onMouseDown:()=>{db.dialog.shift(),fb=null}}},{palette:sb,render:tb}=((a,b)=>{const c=sa(a.getContext(`2d`));return c.clear(),a.addEventListener(Ha?`ontouchstart`:`mousedown`,Ka(Ba)),a.addEventListener(Ha?`ontouchmove`:`mousemove`,Ka(Ca)),a.addEventListener(Ha?`ontouchend`:`mouseup`,Ka(Da)),{palette:c,render:()=>Ga(new ta,c)(b)}})(p,{geometry:R([0,0],0,window.innerWidth,window.innerHeight),children:[rb]});sb.ctx.imageSmoothingEnabled=!1;const ub=[0,120,200],vb=((a)=>([b,c])=>{const[d,e,f]=a;return[b+c*(d-b)/(c+e)-d+r/2,s-(0===e+c?0:f*c/(e+c)),k(l(e+c,2)+l(d-b,2))]})(ub),wb=[],{fillPolygon:xb,fillText:yb,ctx:zb}=sb,Ab=R([0,800],0,1e4,1600),Bb=R([0,0],0,2*r,2*s),Cb=zb.createLinearGradient(0,0,200,200);Cb.addColorStop(0,`#5E8C6A`),Cb.addColorStop(1,`#BFB35A`);const Db=zb.createLinearGradient(0,0,200,200);Db.addColorStop(0,`#69D2E7`),Db.addColorStop(1,`#A7DBD8`);const Eb=()=>{xb(Db,[0,0],Bb.points),xb(Cb,[0,0],J(K(Ab.points,Ab.position),vb)),wb.map((a)=>[...vb(a),a[2],a[3],a[4]]).sort((c,a)=>a[2]-c[2]).forEach(([a,b,c,d,e])=>yb({},[a,b-d],e))},Fb=(a)=>([b,c],d=0)=>[b,c,d,a],Gb=Fb($a),Hb=Fb(_a),Ib=Fb(Wa),Jb=Fb(Xa),Kb=Fb(Ya),Lb=Fb(Za),Mb=Fb(ab),Nb=Fb(bb),Ob=Fb(cb),Pb=[0,0],Qb=3;let Rb=1e3;for(;0<--Rb;)wb.push((0.5<Math.random()?Gb:Hb)([5120*Math.random()-2560,1280*Math.random()],0));for(Rb=25;0<--Rb;)wb.push(Mb([1e4*Math.random()-5e3,1e3*Math.random()+3500],30*Math.random()+10));for(Rb=5;0<--Rb;)wb.push(Nb([5120*Math.random()-2560,1280*Math.random()],0));const i=Lb([20*Math.random()-10,20*Math.random()-10],0),Sb=Ib([20*Math.random()-10,20*Math.random()-10],0),Tb=Jb([20*Math.random()-10,20*Math.random()-10],0),Ub=Kb([20*Math.random()-10,20*Math.random()-10],0),Vb=Ob([20*Math.random()-10,20*Math.random()-10],0),Wb=()=>(a,b)=>{const c=C(db.position,a);G(c)>b&&B(a,I(c,Qb))};wb.push(i,Sb,Tb,Ub,Vb);var Xb=()=>{Pb[0]=0,Pb[1]=0,(Ra.w||Ra.up)&&(Pb[1]+=1),(Ra.s||Ra.down)&&(Pb[1]-=1),(Ra.d||Ra.right)&&(Pb[0]+=1),(Ra.a||Ra.left)&&(Pb[0]-=1),B(db.position,I(Pb,Qb)),db.position[1]=e(db.position[1],5),i[0]=db.position[0],i[1]=db.position[1];const a=Wb(i);a(Sb,20+Date.now()%300/30),a(Tb,45+Date.now()%300/30),a(Ub,70+Date.now()%300/30),a(Vb,90+Date.now()%300/30);const b=db.position[0]-ub[0];g(b)>0.2*r&&(ub[0]+=b-0.2*(z(b)*r))};const Yb=new AudioContext,Zb=(a)=>new Promise((b)=>setTimeout(b,a)),$b=261.63,_b=329.63,ac=349.23,bc=392,cc=440,dc=493.88,ec=523.25,fc=587.33,gc=659.26,hc=698.46,ic=783.99,jc=880,kc=987.77,lc=1046.5,mc=1174.66,nc=1318.51,oc=1396.91,pc=1567.98;(async()=>await d([[[gc,ec],1],[[fc,bc],1],[[ec,cc],1],[[dc,_b],1],[[cc,ac],1],[[bc,$b],1],[[cc,ac],1],[[dc,bc],1],[[nc,ic,ec],1],[[mc,kc,bc],1],[[lc,cc],1],[[kc,ic,_b],1],[[jc,ec,ac],1],[[ic,gc,$b],1],[[jc,hc,ac],1],[[kc,fc,bc],1],[[lc,ec,gc],[0.5,1,1]],[lc,0.5],[[mc,fc,bc],[0.5,1,1]],[kc,0.5],[[lc,gc,jc],[0.5,1,1]],[nc,0.5],[[pc,_b],[0.5,1,1]],[ic,0.5],[[jc,cc,ac],[0.5,1,1]],[hc,0.5],[[gc,$b],[0.5,1,1]],[ic,0.5],[[hc,cc,ac],[0.5,1,1]],[lc,0.5],[[kc,dc,bc],[0.5,1,1]],[ic,0.5],[[lc,gc,ec],[0.5,1,1]],[nc,0.25],[pc,0.25],[[pc,bc],[0.25,1,1]],[1760,0.25],[pc,0.25],[oc,0.25],[[nc,cc,ec],[0.75,1,1]],[nc,0.25],[[nc,bc,_b],[0.25,1,1]],[oc,0.25],[nc,0.25],[mc,0.25],[[lc,cc,ac],[0.25,1,1]],[932.33,0.25],[jc,0.25],[kc,0.25],[[ic,_b,$b],[0.5,1,1]],[gc,0.5],[[ec,cc,ac],[0.5,1,1]],[hc,0.25],[gc,0.25],[[fc,dc,bc],[0.5,1,1]],[ic,0.25],[hc,0.25],[[``,gc,ec],[0.5,1,1]],[lc,0.5],[[mc,bc],[0.5,1,1]],[kc,0.5],[[lc,ec,cc],[0.5,1,1]],[gc,0.5],[[ic,dc,_b],[0.75,1,1]],[jc,0.25],[[hc,cc,ac],[0.5,1,1]],[ec,0.5],[[gc,bc,$b],[0.5,1,1]],[ic,0.5],[[hc,cc,ac],[0.5,1,1]],[gc,0.5],[[fc,dc,bc],[0.5,1,1]],[ic,0.5],[[gc,ec,$b],[2,2,2]]]))(),((a)=>{let b=!0;return requestAnimationFrame(function c(){n=m(16,Date.now()-o),b&&a(n),o=Date.now(),requestAnimationFrame(c)}),()=>b=!b})((a)=>{Xb(a),sb.clear(),Eb(),tb()})})();
(function(){'use strict';function a(a,b=8){const c=k(10,b);return Math.round(a*c)/c}function b(b,d){const e=h(d),f=g(d);return[a(b[0]*f-b[1]*e),a(b[0]*e+b[1]*f)]}var c=Math.max,d=Math.min,e=Math.floor,f=Math.abs,g=Math.cos,h=Math.sin,j=Math.sqrt,k=Math.pow;const l=(...a)=>{let b=0;for(let c=a.length-1;0<=c;--c)b+=a[c];return b},m=(a)=>0<a?1:0>a?-1:0,n=(a)=>a*a,o=(a,b)=>(a[0]+=b[0],a[1]+=b[1],a),p=(a,b)=>[a[0]-b[0],a[1]-b[1]],q=(a,b)=>(a[0]-=b[0],a[1]-=b[1],a),r=(a,b)=>(a[0]*=b,a[1]*=b,a),s=(a)=>n(a[0])+n(a[1]),u=(a)=>j(s(a)),v=(a)=>0===a[0]&&0===a[1]?[0,0]:r(a,1/u(a)),w=(a,b)=>r(v(a),b),x=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2){const[e,f]=b([a[d],a[d+1]]);c[d]=e,c[d+1]=f}return c},y=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]+b[0],c[d+1]=a[d+1]+b[1];return c},z=(a,b)=>{for(let c=0,d=a.length;c<d;c+=2)a[c]+=b[0],a[c+1]+=b[1];return a},A=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]-b[0],c[d+1]=a[d+1]-b[1];return c},B=(b,d)=>{const e=[],f=h(d),j=g(d);for(let c=0,g=b.length;c<g;c+=2)e[c]=a(b[c]*j-b[c+1]*f),e[c+1]=a(b[c]*f+b[c+1]*j);return e},C=(a,b,c)=>y(B(A(a,b),c),b),D=()=>Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),E=(a,b)=>[-a/2,+b/2,-a/2,-b/2,+a/2,-b/2,+a/2,+b/2],F=(a,b=0,c=1,d=1,e=``)=>({id:D(),shape:`Rectangle`,label:e,position:a,rotation:b,width:c,height:d,points:E(c,d)}),G=document.querySelector(`canvas`),H=G.getContext(`2d`),I=160,J=192;let K=G.offsetWidth,L=G.offsetHeight,M=1,N=1;G.width=I,G.height=J;const O=()=>{const{top:a,left:b,width:c,height:d}=G.getBoundingClientRect();K=b,L=a,M=I/c,N=J/d};O(),window.addEventListener(`resize`,O);const P=[0,0],Q=(b)=>(c)=>b.translate(a(c[0],0),a(c[1],0)),R=(a)=>(b)=>a.rotate(b),S=(b)=>(c,d,e)=>b.clearRect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),T=(a,b)=>()=>S(a)(P,b.width,b.height),U=(b)=>(c)=>b.moveTo(a(c[0],0),a(c[1],0)),V=(b)=>(c)=>b.lineTo(a(c[0],0),a(c[1],0)),W=(b)=>(c,d)=>b.quadraticCurveTo(a(d[0],0),a(d[1],0),a(c[0],0),a(c[1],0)),X=(b)=>(c,d,e,f,g)=>b.arc(a(c[0],0),a(c[1],0),d,e,f,g),Y=(b)=>(c,d,e)=>b.rect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),Z=(b)=>(c)=>(d,e,f)=>b.drawImage(c,a(d[0],0),a(d[1],0),e,f),$=(b)=>(c)=>(d,e,f,g,h,i)=>b.drawImage(c,a(e[0],0),a(e[1],0),f,g,a(d[0],0),a(d[1],0),h,i),_=(a)=>(b,c=0)=>{const d=[b[0],b[1]],e=A(b,d);a.save(),Q(a)(d),R(a)(c),U(a)([0,0]);for(let d=0;d<e.length;d+=2)V(a)([e[d],e[d+1]]);a.restore()},aa=(a)=>(b,c,d=0)=>{a.save(),Q(a)(b),R(a)(d),U(a)([c[c.length-2],c[c.length-1]]);for(let e=0;e<c.length;e+=2)V(a)([c[e],c[e+1]]);a.restore()},ba=(b)=>(c,d,e,f=0)=>{b.save(),Q(b)(c),R(b)(f),Y(b)([-d/2,-e/2],a(d,0),a(e,0)),b.restore()},ca=(a)=>(b,c,d=100,e=0,f=2*Math.PI,g=!1)=>{a.save(),Q(a)(b),R(a)(c),X(a)([0,0],d,e,f,g),a.restore()},da=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.fillStyle=c,a(b)(...d),b.fill(),b.restore()},ea=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.strokeStyle=c,a(b)(...d),b.stroke(),b.restore()},fa=da(aa),ga=da(ba),ha=da(_),ia=da(ca),ja=ea(aa),ka=ea(ba),la=ea(_),ma=ea(ca),na=(b)=>(c,d,e)=>{b.save(),b.strokeStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.strokeText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},oa=(b)=>(c,d,e)=>{b.save(),b.fillStyle=c.style||``,b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.fillText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},pa=(a)=>({ctx:a,canvas:a.canvas,translate:Q(a),rotate:R(a),moveTo:U(a),lineTo:V(a),quadraticCurveTo:W(a),arc:X(a),drawLine:_(a),drawPolygon:aa(a),drawArc:ca(a),drawImage:Z(a),drawSlicedImage:$(a),fillRectangle:ga(a),fillPolygon:fa(a),fillLine:ha(a),fillArc:ia(a),fillText:oa(a),strokePolygon:ja(a),strokeRectangle:ka(a),strokeLine:la(a),strokeArc:ma(a),strokeText:na(a),clearRect:S(a),clear:T(a,a.canvas)});class qa{constructor(){this.position=P,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}apply(a){const b=[this.position[0],this.position[1]],c=this.rotation;return Object.assign(Object.create(null),a,{id:D(),position:b,rotation:c})}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(0<this.saved_positions.length){const a=this.saved_positions.pop();a&&(this.position[0]=a[0],this.position[1]=a[1]);const b=this.saved_rotations.pop();!b&&0!==b||(this.rotation=b)}}}const ra=(a,b)=>m((b[2]-b[0])*(a[1]-b[1])-(b[3]-b[1])*(a[0]-b[0])),sa=(a,b,c)=>s(p(a,b))<=n(c),ta=(a,b,c,d)=>f(a[0]-b[0])<=c/2&&f(a[1]-b[1])<=d/2,ua=(a,b)=>{const c=e(b.length/2);for(let d=0;d<c;d+=2){const e=d==c-1?0:d+1;if(-1===ra(a,[b[d],b[d+1],b[e],b[e+1]]))return!0}return!1},va=(a,b,e,f,g)=>ta(a,e,f,g)||sa(e,a,b)||n(a[0]-c(e[0],d(a[0],e[0]+f)))+n(a[1]-c(e[1],d(a[1],e[1]+g)))<n(b),wa=(a,b,c,d,e,g)=>!(f(d[0]-a[0])>b/2+e/2||f(d[1]-a[1])>c/2+g/2),xa=(a,b,d,e)=>{if(ua(a,e)||ua(d,b))return!0;const f=c(b.length,e.length);for(let c=0;c<f;c+=2)if(c<b.length&&ua([b[c],b[c+1]],e)||c<e.length&&ua([e[c],e[c+1]],b))return!0;return!1},ya=new Map,za=new Map,Aa=new Map,Ba=F([0,0],0,window.innerWidth,window.innerHeight,`window`);window.onresize=()=>Object.assign(Ba,F([0,0],0,window.innerWidth,window.innerHeight,`window`));const Ca=((a=Ba)=>(b)=>{const{geometry:c={shape:null}}=b;switch(c.shape){case`Circle`:return va(c.position,c.radius,a.position,a.width,a.height);case`Rectangle`:return wa(c.position,c.width,c.height,a.position,a.width,a.height);case`Polygon`:return xa(c.position,z(C(c.points,[0,0],c.rotation),c.position),a.position,z(C(a.points,[0,0],a.rotation),a.position));default:return!0;}})(Ba),Da=(a,c)=>(d)=>{const{geometry:e,children:f,render:g,interact:h}=d,{ctx:i,translate:j,rotate:k}=c;i.save(),a.save(),e&&(j(e.position),o(a.position,b(e.position,a.rotation)),k(e.rotation),a.rotation+=e.rotation),i.save(),g&&(!e||Ca(a.apply(e)))&&g(c,d),i.restore(),f&&f.forEach(Da(a,c)),h&&(h.onMouseDown?ya.set(d,[d,e&&a.apply(e),h.onMouseDown]):ya.delete(d),h.onMouseMove?za.set(d,[d,e&&a.apply(e),h.onMouseMove]):za.delete(d),h.onMouseUp?Aa.set(d,[d,e&&a.apply(e),h.onMouseUp]):Aa.delete(d)),i.restore(),a.restore()},Ea=`ontouchstart`in window,Fa=(a)=>{if(a.clientX)return[a.clientX,a.clientY];else{const b=a.touches[0];return[b.clientX,b.clientY]}},Ga=(a)=>(b)=>{switch(b.shape){case`Circle`:return sa(a,b.position,b.radius);case`Rectangle`:return ta(a,b.position,b.width,b.height);case`Polygon`:return ua(a,z(C(b.points,[0,0],b.rotation),b.position));default:return!1;}},Ha=(a)=>(b)=>{if(a.size){const c=q(Fa(b),[K,L]);c[0]*=M,c[1]*=N;const d=Ga(c);[...a.values()].filter(([a,b])=>!b||d(b)).forEach(([a,b,d])=>d(a,c))}},Ia=`#fff`,Ja=`Arial Black, Gadget, sans-serif`,Ka=`"Lucida Console", Monaco, monospace`,La=`24px ${Ja}`,Ma=`12px ${Ka}`,Na={38:`up`,40:`down`,37:`left`,39:`right`,81:`q`,87:`w`,69:`e`,65:`a`,83:`s`,68:`d`,48:`0`,49:`1`,50:`2`,51:`3`,52:`4`,53:`5`,54:`6`,55:`7`,56:`8`,57:`9`,189:`-`,187:`=`,32:`space`,13:`return`,16:`shift`,17:`ctrl`,9:`tab`,18:`alt`},Oa={up:!1,down:!1,left:!1,right:!1,q:!1,w:!1,e:!1,a:!1,s:!1,d:!1,0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,"-":!1,"=":!1,space:!1,return:!1,shift:!1,ctrl:!1,tab:!1,alt:!1,click:!1},Pa=(a,b=!0)=>{const c=Na[a];return c&&(Oa[c]=b),Oa[c]};document.body.onkeyup=({keyCode:a})=>Pa(a,!1),document.body.onkeydown=({keyCode:a})=>Pa(a,!0);let Qa=0;const Ra=(a,b,c)=>({geometry:F(c,0,140,14),render:(a,c)=>{const{fillRectangle:d,fillText:e,ctx:f}=a;f.font=Ma;const{width:g}=f.measureText(b);c.geometry.width=g+10,c.geometry.points=E(c.geometry.width,c.geometry.height),e({textBaseline:`middle`,font:Ma,style:Ia},[-g/2,0],b)},interact:{onMouseMove:()=>Qa=a,onMouseDown:()=>Qa=a}}),Sa={geometry:F([I/2,J/2],0,140,40),children:[Ra(0,`new game`,[0,48]),Ra(1,`continue game`,[0,72])],render:(a)=>{const{fillText:b,fillPolygon:c}=a;b({textBaseline:`middle`,style:Ia,font:La},[-59,0],`A L T E R`),400<Date.now()%600&&c(`white`,0===Qa?[-42,48]:[-60,72],[-5,3,5,0,-5,-3]),(Oa.up||Oa.w)&&(Qa=0),(Oa.down||Oa.s)&&(Qa=1)}},Ta={dialog:[],position:[0,0]};let Ua=!1,Va=null;const Wa=2,Xa=I-Wa,Ya=J/4,Za=`#fff`,$a=`#00f`,_a=12,ab=1.2*_a,bb=Xa-4*Wa,cb=Ya-4*Wa,db=`#fff`,eb=(a,b,c)=>{const d=[];b=b.toUpperCase(),a.textBaseline=`top`,a.font=`${_a}px monospace`;const e=b.split(` `);let f=``,g=0,h=0;for(const[i,j]of e.entries()){const b=`${f+j} `,e=a.measureText(b),k=e.width;if(h+b.length>c)return k>bb?(d.push([-bb/2,-cb/2+g,f]),h+=f.length,d.push([-bb/2,-cb/2+g+ab,j.substr(0,c-h)])):d.push([-bb/2,-cb/2+g,b.substr(0,c-h)]),d;k>bb&&0<i?(d.push([-bb/2,-cb/2+g,f]),h+=f.length,f=`${j} `,g+=ab):f=b}return d.push([-bb/2,-cb/2+g,f]),d},fb={geometry:F([I/2,J-Ya/2],0,Xa,Ya),render:(a,{geometry:b})=>{const{dialog:c}=Ta,[d]=c;if(!d)return;Va||(Va=Date.now());const{ctx:f,fillRectangle:g,strokeRectangle:h,fillText:i}=a,j=e((Date.now()-Va)/50);g($a,[0,0],b.width,b.height),h(Za,[0,0],b.width,b.height);const[k,l]=d,m=eb(f,k,j);let n=0;if(l){const[a,b]=l,{width:c}=f.measureText(b),d=c+16+4*Wa,e=-Xa/2+c,j=-Ya/2-2*Wa;g($a,[e,j],d,ab+4*Wa),h(Za,[e,j],d,ab+4*Wa),f.font=`${_a}px monospace`,i({style:db},[e-6+4*Wa-d/2,j-ab/2],a),i({style:db},[e-6+4*Wa-d/2+16,j-ab/2],b),n=ab/2}m.forEach(([a,b,c])=>{i({style:db},[a,b+n],c)}),j>=k.length&&Oa.space&&!Ua?(Ta.dialog.shift(),Va=null,Ua=!0):!Oa.space&&Ua&&(Ua=!1)},interact:{onMouseDown:()=>{maxChar>=text.length&&(Ta.dialog.shift(),Va=null)}}},{palette:gb,render:hb}=((a,b)=>{const c=pa(a.getContext(`2d`));return c.clear(),a.addEventListener(Ea?`ontouchstart`:`mousedown`,Ha(ya)),a.addEventListener(Ea?`ontouchmove`:`mousemove`,Ha(za)),a.addEventListener(Ea?`ontouchend`:`mouseup`,Ha(Aa)),{palette:c,render:()=>Da(new qa,c)(b)}})(G,{geometry:F([0,0],0,window.innerWidth,window.innerHeight),children:[fb]});gb.ctx.imageSmoothingEnabled=!1;const ib=([a,b,c])=>([d,e])=>[d+e*(a-d)/(e+b)-a+I/2,J-(0===b+e?0:c*e/(b+e)),j(k(b+e,2)+k(a-d,2))],jb=`\uD83D\uDC69\uD83C\uDFFC\u200D\uD83C\uDF3E`,kb=`\uD83D\uDC6E\uD83C\uDFFF\u200D\u2640\uFE0F`,lb=`\uD83D\uDD75\uD83C\uDFFD`,mb=`\uD83D\uDC69\uD83C\uDFFB\u200D\uD83C\uDFA4`,nb=`\uD83C\uDF32`,ob=`\uD83C\uDF33`,pb=`\u2601\uFE0F`,qb=`\uD83C\uDF75`,rb=`\uD83D\uDD37`,sb=(a)=>([b,c],d=0)=>[b,c,d,a],tb=sb(nb),ub=sb(ob),vb=sb(jb),wb=sb(kb),xb=sb(lb),yb=sb(mb),zb=sb(pb),Ab=sb(qb),Bb=sb(rb),Cb=[0,120,200];let Db=0,Eb=0;const t=F([0,800],0,1e4,1600),Fb=F([0,0],0,2*I,2*J),{fillText:Gb,fillPolygon:Hb,strokePolygon:Ib,fillArc:Jb}=gb,Kb=gb.ctx.createLinearGradient(0,0,200,200);Kb.addColorStop(0,`#5E8C6A`),Kb.addColorStop(1,`#BFB35A`);const Lb=gb.ctx.createLinearGradient(0,0,200,200);Lb.addColorStop(0,`#69D2E7`),Lb.addColorStop(1,`#A7DBD8`);const Mb=[];let Nb=1e3;for(;0<--Nb;)Mb.push((0.5<Math.random()?tb:ub)([5120*Math.random()-2560,1280*Math.random()],0));for(Nb=25;0<--Nb;)Mb.push(zb([1e4*Math.random()-5e3,1e3*Math.random()+3500],30*Math.random()+10));for(Nb=5;0<--Nb;)Mb.push(Ab([5120*Math.random()-2560,1280*Math.random()],0));const i=3,Ob=[0,0],Pb=yb([20*Math.random()-10,20*Math.random()-10],0),Qb=vb([20*Math.random()-10,20*Math.random()-10],0),Rb=wb([20*Math.random()-10,20*Math.random()-10],0),Sb=xb([20*Math.random()-10,20*Math.random()-10],0),Tb=Bb([20*Math.random()-10,20*Math.random()-10],0),Ub=()=>(a,b)=>{const c=p(Ta.position,a);u(c)>b&&o(a,w(c,i))};Mb.push(Pb,Qb,Rb,Sb,Tb),requestAnimationFrame(function a(){Db=d(16,Date.now()-Eb),Cb[2]=40+120*(Date.now()%3e3/3e3),Ob[0]=0,Ob[1]=0,(Oa.w||Oa.up)&&(Ob[1]+=1),(Oa.s||Oa.down)&&(Ob[1]-=1),(Oa.d||Oa.right)&&(Ob[0]+=1),(Oa.a||Oa.left)&&(Ob[0]-=1),o(Ta.position,w(Ob,i)),Ta.position[1]=c(Ta.position[1],5),Pb[0]=Ta.position[0],Pb[1]=Ta.position[1];const b=Ub(Pb);b(Qb,20+Date.now()%300/30),b(Rb,45+Date.now()%300/30),b(Sb,70+Date.now()%300/30),b(Tb,90+Date.now()%300/30);const e=Ta.position[0]-Cb[0];f(e)>0.2*I&&(Cb[0]+=e-0.2*(m(e)*I)),gb.clear();const g=ib(Cb);Hb(Lb,[0,0],Fb.points),Hb(Kb,[0,0],x(y(t.points,t.position),g)),[...Mb].map((a)=>[...g(a),a[2],a[3],a[4]]).sort((c,a)=>a[2]-c[2]).forEach(([a,b,c,d,e])=>Gb({},[a,b-d],e)),hb(),Eb=Date.now(),requestAnimationFrame(a)})})();
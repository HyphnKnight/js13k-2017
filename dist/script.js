(function(){'use strict';function a(a,b=8){const c=Math.pow(10,b);return Math.round(a*c)/c}function b(b,d){const e=i(d),f=g(d);return[a(b[0]*f-b[1]*e),a(b[0]*e+b[1]*f)]}var d=Math.max,e=Math.min,f=Math.abs,g=Math.cos,i=Math.sin;const j=(...a)=>{let b=0;for(let c=a.length-1;0<=c;--c)b+=a[c];return b},k=(a)=>0<a?1:0>a?-1:0,l=(a)=>a*a,m=(a,b)=>(a[0]+=b[0],a[1]+=b[1],a),n=(a,b)=>[a[0]-b[0],a[1]-b[1]],o=(a)=>l(a[0])+l(a[1]),p=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]+b[0],c[d+1]=a[d+1]+b[1];return c},q=(a,b)=>{for(let c=0,d=a.length;c<d;c+=2)a[c]+=b[0],a[c+1]+=b[1];return a},r=(a,b)=>{const c=[];for(let d=0,e=a.length;d<e;d+=2)c[d]=a[d]-b[0],c[d+1]=a[d+1]-b[1];return c},s=(b,d)=>{const e=[],f=i(d),h=g(d);for(let c=0,g=b.length;c<g;c+=2)e[c]=a(b[c]*h-b[c+1]*f),e[c+1]=a(b[c]*f+b[c+1]*h);return e},t=(a,b,c)=>p(s(r(a,b),c),b),u=()=>Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),v=(a,b)=>[-a/2,+b/2,-a/2,-b/2,+a/2,-b/2,+a/2,+b/2],z=(a,b=0,c=1,d=1,e=``)=>({id:u(),shape:`Rectangle`,label:e,position:a,rotation:b,width:c,height:d,points:v(c,d)}),A=[0,0],B=(b)=>(c)=>b.translate(a(c[0],0),a(c[1],0)),C=(a)=>(b)=>a.rotate(b),D=(b)=>(c,d,e)=>b.clearRect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),E=(a,b)=>()=>D(a)(A,b.width,b.height),F=(b)=>(c)=>b.moveTo(a(c[0],0),a(c[1],0)),G=(b)=>(c)=>b.lineTo(a(c[0],0),a(c[1],0)),H=(b)=>(c,d)=>b.quadraticCurveTo(a(d[0],0),a(d[1],0),a(c[0],0),a(c[1],0)),I=(b)=>(c,d,e,f,g)=>b.arc(a(c[0],0),a(c[1],0),d,e,f,g),J=(b)=>(c,d,e)=>b.rect(a(c[0],0),a(c[1],0),a(d,0),a(e,0)),K=(b)=>(c)=>(d,e,f)=>b.drawImage(c,a(d[0],0),a(d[1],0),e,f),L=(b)=>(c)=>(d,e,f,g,h,i)=>b.drawImage(c,a(e[0],0),a(e[1],0),f,g,a(d[0],0),a(d[1],0),h,i),M=(a)=>(b,c=0)=>{const d=[b[0],b[1]],e=r(b,d);a.save(),B(a)(d),C(a)(c),F(a)([0,0]);for(let d=0;d<e.length;d+=2)G(a)([e[d],e[d+1]]);a.restore()},N=(a)=>(b,c,d=0)=>{a.save(),B(a)(b),C(a)(d),F(a)([c[c.length-2],c[c.length-1]]);for(let e=0;e<c.length;e+=2)G(a)([c[e],c[e+1]]);a.restore()},O=(b)=>(c,d,e,f=0)=>{b.save(),B(b)(c),C(b)(f),J(b)([-d/2,-e/2],a(d,0),a(e,0)),b.restore()},P=(a)=>(b,c,d=100,e=0,f=2*Math.PI,g=!1)=>{a.save(),B(a)(b),C(a)(c),I(a)(A,d,e,f,g),a.restore()},Q=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.fillStyle=c,a(b)(...d),b.fill(),b.restore()},R=(a)=>(b)=>(c,...d)=>{b.save(),b.beginPath(),b.strokeStyle=c,a(b)(...d),b.stroke(),b.restore()},S=Q(N),T=Q(O),U=Q(M),V=Q(P),W=R(N),X=R(O),Y=R(M),Z=R(P),$=(b)=>(c,d,e)=>{b.save(),b.strokeStyle=c.style||'',b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.strokeText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},_=(b)=>(c,d,e)=>{b.save(),b.fillStyle=c.style||'',b.font=c.font||b.font,b.textAlign=c.textAlign||b.textAlign,b.textBaseline=c.textBaseline||b.textBaseline,b.fillText(e,a(d[0],0),a(d[1],0),c.maxWidth),b.restore()},aa=(a)=>({ctx:a,canvas:a.canvas,translate:B(a),rotate:C(a),moveTo:F(a),lineTo:G(a),quadraticCurveTo:H(a),arc:I(a),drawLine:M(a),drawPolygon:N(a),drawArc:P(a),drawImage:K(a),drawSlicedImage:L(a),fillRectangle:T(a),fillPolygon:S(a),fillLine:U(a),fillArc:V(a),fillText:_(a),strokePolygon:W(a),strokeRectangle:X(a),strokeLine:Y(a),strokeArc:Z(a),strokeText:$(a),clearRect:D(a),clear:E(a,a.canvas)});class ba{constructor(){this.position=A,this.rotation=0,this.saved_positions=[],this.saved_rotations=[]}apply(a){const b=[this.position[0],this.position[1]],c=this.rotation;return Object.assign(Object.create(null),a,{id:u(),position:b,rotation:c})}save(){this.saved_positions.push([this.position[0],this.position[1]]),this.saved_rotations.push(this.rotation)}restore(){if(0<this.saved_positions.length){const a=this.saved_positions.pop();!a||(this.position[0]=a[0],this.position[1]=a[1]);const b=this.saved_rotations.pop();!b&&0!==b||(this.rotation=b)}}}const ca=(a,b)=>k((b[2]-b[0])*(a[1]-b[1])-(b[3]-b[1])*(a[0]-b[0])),da=(a,b,c)=>o(n(a,b))<=l(c),ea=(a,b,c,d)=>f(a[0]-b[0])<=c/2&&f(a[1]-b[1])<=d/2,fa=(a,b)=>{const c=Math.floor(b.length/2);for(let d=0;d<c;d+=2){const e=d==c-1?0:d+1;if(-1===ca(a,[b[d],b[d+1],b[e],b[e+1]]))return!0}return!1},ga=(a,b,c,f,g)=>ea(a,c,f,g)||da(c,a,b)||l(a[0]-d(c[0],e(a[0],c[0]+f)))+l(a[1]-d(c[1],e(a[1],c[1]+g)))<l(b),ha=(a,b,c,d,e,g)=>!(f(d[0]-a[0])>b/2+e/2||f(d[1]-a[1])>c/2+g/2),ia=(a,b,c,e)=>{if(fa(a,e)||fa(c,b))return!0;const f=d(b.length,e.length);for(let d=0;d<f;d+=2)if(d<b.length&&fa([b[d],b[d+1]],e)||d<e.length&&fa([e[d],e[d+1]],b))return!0;return!1},ja=new Map,ka=new Map,la=new Map,ma=z([0,0],0,window.innerWidth,window.innerHeight,`window`);window.onresize=()=>Object.assign(ma,z([0,0],0,window.innerWidth,window.innerHeight,`window`));const na=((a=ma)=>(b)=>{const{geometry:c={shape:null}}=b;switch(c.shape){case`Circle`:return ga(c.position,c.radius,a.position,a.width,a.height);case`Rectangle`:return ha(c.position,c.width,c.height,a.position,a.width,a.height);case`Polygon`:return ia(c.position,q(t(c.points,[0,0],c.rotation),c.position),a.position,q(t(a.points,[0,0],a.rotation),a.position));default:return!0;}})(ma),oa=(a,c)=>(d)=>{const{geometry:e,children:f,render:g,interact:h}=d,{ctx:i,translate:j,rotate:k}=c;i.save(),a.save(),e&&(j(e.position),m(a.position,b(e.position,a.rotation)),k(e.rotation),a.rotation+=e.rotation),i.save(),g&&(!e||na(a.apply(e)))&&g(c,d),i.restore(),f&&f.forEach(oa(a,c)),h&&(h.onMouseDown?ja.set(d,[d,e&&a.apply(e),h.onMouseDown]):ja.delete(d),h.onMouseMove?ka.set(d,[d,e&&a.apply(e),h.onMouseMove]):ka.delete(d),h.onMouseUp?la.set(d,[d,e&&a.apply(e),h.onMouseUp]):la.delete(d)),i.restore(),a.restore()},pa=`ontouchstart`in window,qa=(a)=>{if(a.clientX)return[a.clientX,a.clientY];else{const b=a.touches[0];return[b.clientX,b.clientY]}},ra=(a)=>(b)=>{switch(b.shape){case`Circle`:return da(a,b.position,b.radius);case`Rectangle`:return ea(a,b.position,b.width,b.height);case`Polygon`:return fa(a,q(t(b.points,[0,0],b.rotation),b.position));default:return!1;}},sa=(a)=>(b)=>{if(a.size){const c=qa(b),d=ra(c);[...a.values()].filter(([a,b])=>!b||d(b)).forEach(([a,b,d])=>d(a,c))}},ta=(a,b)=>{const c=aa(a.getContext(`2d`));return c.clear(),a.addEventListener(pa?`ontouchstart`:`mousedown`,sa(ja)),a.addEventListener(pa?`ontouchmove`:`mousemove`,sa(ka)),a.addEventListener(pa?`ontouchend`:`mouseup`,sa(la)),{palette:c,render:()=>oa(new ba,c)(b)}},ua=document.querySelector(`canvas`),c=ua.getContext(`2d`),va=160,w=192;let h=ua.offsetWidth,wa=ua.offsetHeight;window.addEventListener(`resize`,()=>{h=ua.offsetWidth,wa=ua.offsetHeight});const xa={38:`up`,40:`down`,37:`left`,39:`right`,81:`q`,87:`w`,69:`e`,65:`a`,83:`s`,68:`d`,48:`0`,49:`1`,50:`2`,51:`3`,52:`4`,53:`5`,54:`6`,55:`7`,56:`8`,57:`9`,189:`-`,187:`=`,32:`space`,13:`return`,16:`shift`,17:`ctrl`,9:`tab`,18:`alt`},ya={up:!1,down:!1,left:!1,right:!1,q:!1,w:!1,e:!1,a:!1,s:!1,d:!1,0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,"-":!1,"=":!1,space:!1,return:!1,shift:!1,ctrl:!1,tab:!1,alt:!1,click:!1},za=(a,b=!0)=>{const c=xa[a];return c&&(ya[c]=b),ya[c]};document.body.onkeyup=({keyCode:a})=>za(a,!1),document.body.onkeydown=({keyCode:a})=>za(a,!0);const Aa=2,Ba=va-Aa,Ca=w/2,Da=Ba/2+Aa/2,x=w-Ca/2-2*Aa,y=`#fff`,Ea=`#00f`,Fa=12,Ga=Ba-4*Aa,Ha=0+2.5*Aa,Ia=x-Ca/2+Aa,Ja=`#fff`;((a)=>{const b=function*(b){for(let c of a){b.textBaseline=`top`,b.font=`${Fa}px monospace`,b.fillStyle=Ja,c=c.toUpperCase();const a=c.split(` `);let d=``,e=Ia;for(const[c,f]of a.entries()){const a=`${d+f} `,g=b.measureText(a),h=g.width;h>Ga&&0<c?(b.fillText(d,Ha,e),d=`${f} `,e+=1.2*Fa):d=a}b.fillText(d,Ha,e),yield c,b.fillStyle=Ea,b.fillRect(Ha-1,Ia-1,Ga+2,Ca-4*Aa+2)}}(c),{palette:d,render:e}=ta(ua,{geometry:z([0,0],0,va,w),render:(a)=>{const{ctx:c,fillRectangle:d,strokeRectangle:e,fillText:f}=a;c.lineWidth=Aa,d(Ea,[Da,x],Ba,Ca),e(y,[Da,x],Ba,Ca),b.next();const g=()=>b.next().done&&a.clear()&&document.body.removeEventListener(g);document.body.addEventListener(`mousedown`,g)}});e()})([`I am the very model of a modern major general!`,`I have the information: animal, vegetable, mineral!`,`It's 2AM and I need to sleep.`,`Fuh`,`Wuh tuh fuhhh`,`My cat's breth smels liek cat food`,`Hi rafe`])})();